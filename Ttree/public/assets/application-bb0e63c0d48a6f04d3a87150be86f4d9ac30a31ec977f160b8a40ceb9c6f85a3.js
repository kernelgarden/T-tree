!function(e){"function"==typeof define&&define.amd?define("jquery-typeahead",["jquery"],function(t){return e(t)}):"object"==typeof module&&module.exports?module.exports=function(t,n){return void 0===t&&(t="undefined"!=typeof window?require("jquery"):require("jquery")(n)),e(t)}:e(jQuery)}(function(e){"use strict";window.Typeahead={version:"2.6.1"};var t={input:null,minLength:2,maxItem:8,dynamic:!1,delay:300,order:null,offset:!1,hint:!1,accent:!1,highlight:!0,group:!1,groupOrder:null,maxItemPerGroup:null,dropdownFilter:!1,dynamicFilter:null,backdrop:!1,backdropOnFocus:!1,cache:!1,ttl:36e5,compression:!1,suggestion:!1,searchOnFocus:!1,resultContainer:null,generateOnLoad:null,mustSelectItem:!1,href:null,display:["display"],template:null,groupTemplate:null,correlativeTemplate:!1,emptyTemplate:!1,cancelButton:!0,loadingAnimation:!0,filter:!0,matcher:null,source:null,callback:{onInit:null,onReady:null,onShowLayout:null,onHideLayout:null,onSearch:null,onResult:null,onLayoutBuiltBefore:null,onLayoutBuiltAfter:null,onNavigateBefore:null,onNavigateAfter:null,onMouseEnter:null,onMouseLeave:null,onClickBefore:null,onClickAfter:null,onSendRequest:null,onReceiveRequest:null,onPopulateSource:null,onCacheSave:null,onSubmit:null},selector:{container:"typeahead__container",result:"typeahead__result",list:"typeahead__list",group:"typeahead__group",item:"typeahead__item",empty:"typeahead__empty",display:"typeahead__display",query:"typeahead__query",filter:"typeahead__filter",filterButton:"typeahead__filter-button",dropdown:"typeahead__dropdown",dropdownItem:"typeahead__dropdown-item",button:"typeahead__button",backdrop:"typeahead__backdrop",hint:"typeahead__hint",cancelButton:"typeahead__cancel-button"},debug:!1},n=".typeahead",i={from:"\xe3\xe0\xe1\xe4\xe2\u1ebd\xe8\xe9\xeb\xea\xec\xed\xef\xee\xf5\xf2\xf3\xf6\xf4\xf9\xfa\xfc\xfb\xf1\xe7",to:"aaaaaeeeeeiiiiooooouuuunc"},r=~window.navigator.appVersion.indexOf("MSIE 9."),s=function(e,t){this.rawQuery=e.val()||"",this.query=e.val()||"",this.namespace="."+e.selector+n,this.tmpSource={},this.source={},this.isGenerated=null,this.generatedGroupCount=0,this.groupCount=0,this.groupBy="group",this.groups=[],this.result={},this.groupTemplate="",this.resultHtml=null,this.resultCount=0,this.resultCountPerGroup={},this.options=t,this.node=e,this.container=null,this.resultContainer=null,this.item=null,this.xhr={},this.hintIndex=null,this.filters={dropdown:{},dynamic:{}},this.dropdownFilter={"static":[],dynamic:[]},this.dropdownFilterAll=null,this.requests={},this.backdrop={},this.hint={},this.hasDragged=!1,this.focusOnly=!1,this.__construct()};s.prototype={extendOptions:function(){if(this.options.dynamic&&(this.options.cache=!1,this.options.compression=!1),this.options.cache&&(this.options.cache=function(e){var t,n=["localStorage","sessionStorage"];if(e===!0)e="localStorage";else if("string"==typeof e&&!~n.indexOf(e))return!1;t="undefined"!=typeof window[e];try{window[e].setItem("typeahead","typeahead"),window[e].removeItem("typeahead")}catch(e){t=!1}return t&&e||!1}.call(this,this.options.cache)),this.options.compression&&("object"==typeof LZString&&this.options.cache||(this.options.compression=!1)),"undefined"==typeof this.options.maxItem||/^\d+$/.test(this.options.maxItem)&&0!==this.options.maxItem||(this.options.maxItem=1/0),this.options.maxItemPerGroup&&!/^\d+$/.test(this.options.maxItemPerGroup)&&(this.options.maxItemPerGroup=null),this.options.display&&!Array.isArray(this.options.display)&&(this.options.display=[this.options.display]),this.options.group&&(Array.isArray(this.options.group)||("string"==typeof this.options.group?this.options.group={key:this.options.group}:"boolean"==typeof this.options.group&&(this.options.group={key:"group"}),this.options.group.key=this.options.group.key||"group")),this.options.highlight&&!~["any",!0].indexOf(this.options.highlight)&&(this.options.highlight=!1),this.options.dropdownFilter&&this.options.dropdownFilter instanceof Object){Array.isArray(this.options.dropdownFilter)||(this.options.dropdownFilter=[this.options.dropdownFilter]);for(var n=0,r=this.options.dropdownFilter.length;r>n;++n)this.dropdownFilter[this.options.dropdownFilter[n].value?"static":"dynamic"].push(this.options.dropdownFilter[n])}this.options.dynamicFilter&&!Array.isArray(this.options.dynamicFilter)&&(this.options.dynamicFilter=[this.options.dynamicFilter]),this.options.accent&&("object"==typeof this.options.accent?this.options.accent.from&&this.options.accent.to&&this.options.accent.from.length===this.options.accent.to.length:this.options.accent=i),this.options.groupTemplate&&(this.groupTemplate=this.options.groupTemplate),this.options.resultContainer&&("string"==typeof this.options.resultContainer&&(this.options.resultContainer=e(this.options.resultContainer)),this.options.resultContainer instanceof e&&this.options.resultContainer[0]&&(this.resultContainer=this.options.resultContainer)),this.options.maxItemPerGroup&&this.options.group&&this.options.group.key&&(this.groupBy=this.options.group.key),this.options.callback&&this.options.callback.onClick&&(this.options.callback.onClickBefore=this.options.callback.onClick,delete this.options.callback.onClick),this.options.callback&&this.options.callback.onNavigate&&(this.options.callback.onNavigateBefore=this.options.callback.onNavigate,delete this.options.callback.onNavigate),this.options=e.extend(!0,{},t,this.options)},unifySourceFormat:function(){if(this.groupCount=0,Array.isArray(this.options.source))return this.options.source={group:{data:this.options.source}},this.groupCount=1,!0;"string"==typeof this.options.source&&(this.options.source={group:{ajax:{url:this.options.source}}}),this.options.source.ajax&&(this.options.source={group:{ajax:this.options.source.ajax}}),(this.options.source.url||this.options.source.data)&&(this.options.source={group:this.options.source});var e,t,n;for(e in this.options.source)if(this.options.source.hasOwnProperty(e)){if(t=this.options.source[e],"string"==typeof t&&(t={ajax:{url:t}}),n=t.url||t.ajax,Array.isArray(n)?(t.ajax="string"==typeof n[0]?{url:n[0]}:n[0],t.ajax.path=t.ajax.path||n[1]||null,delete t.url):("object"==typeof t.url?t.ajax=t.url:"string"==typeof t.url&&(t.ajax={url:t.url}),delete t.url),!t.data&&!t.ajax)return!1;t.display&&!Array.isArray(t.display)&&(t.display=[t.display]),this.options.source[e]=t,this.groupCount++}return!0},init:function(){this.helper.executeCallback.call(this,this.options.callback.onInit,[this.node]),this.container=this.node.closest("."+this.options.selector.container)},delegateEvents:function(){var t=this,n=["focus"+this.namespace,"input"+this.namespace,"propertychange"+this.namespace,"keydown"+this.namespace,"keyup"+this.namespace,"dynamic"+this.namespace,"generate"+this.namespace];e("html").on("touchmove",function(){t.hasDragged=!0}).on("touchstart",function(){t.hasDragged=!1}),this.node.closest("form").on("submit",function(e){return t.options.mustSelectItem&&t.helper.isEmpty(t.item)?void e.preventDefault():(t.options.backdropOnFocus||t.hideLayout(),t.options.callback.onSubmit?t.helper.executeCallback.call(t,t.options.callback.onSubmit,[t.node,this,t.item,e]):void 0)});var i=!1;this.node.off(this.namespace).on(n.join(" "),function(e){switch(e.type){case"generate":t.isGenerated=null,t.generateSource();break;case"focus":if(t.focusOnly){t.focusOnly=!1;break}t.options.backdropOnFocus&&(t.buildBackdropLayout(),t.showLayout()),t.options.searchOnFocus&&t.query.length>=t.options.minLength&&(t.isGenerated?t.showLayout():null===t.isGenerated&&t.generateSource());case"keydown":e.keyCode&&~[9,13,27,38,39,40].indexOf(e.keyCode)&&(i=!0,t.navigate(e));break;case"keyup":null!==t.isGenerated||t.options.dynamic||t.generateSource(),r&&t.node[0].value.replace(/^\s+/,"").toString().length<t.query.length&&t.node.trigger("input"+t.namespace);break;case"propertychange":if(i){i=!1;break}case"input":if(t.rawQuery=t.node[0].value.toString(),t.query=t.rawQuery.replace(/^\s+/,""),t.options.cancelButton&&t.toggleCancelButton(),t.options.hint&&t.hint.container&&""!==t.hint.container.val()&&0!==t.hint.container.val().indexOf(t.rawQuery)&&t.hint.container.val(""),t.options.dynamic)return t.isGenerated=null,void t.helper.typeWatch(function(){t.query.length>=t.options.minLength?t.generateSource():t.hideLayout()},t.options.delay);case"dynamic":if(!t.isGenerated)break;t.searchResult(),t.buildLayout(),(t.result.length>0||t.options.emptyTemplate)&&t.query.length>=t.options.minLength?t.showLayout():t.hideLayout()}}),this.options.generateOnLoad&&this.node.trigger("generate"+this.namespace)},generateSource:function(){if(!this.isGenerated||this.options.dynamic){if(this.generatedGroupCount=0,this.isGenerated=!1,this.options.loadingAnimation&&this.container.addClass("loading"),!this.helper.isEmpty(this.xhr)){for(var t in this.xhr)this.xhr.hasOwnProperty(t)&&this.xhr[t].abort();this.xhr={}}var n,i,r,s;for(n in this.options.source)if(this.options.source.hasOwnProperty(n)){if(i=this.options.source[n],this.options.cache&&(r=window[this.options.cache].getItem("TYPEAHEAD_"+this.node.selector+":"+n))){this.options.compression&&(r=LZString.decompressFromUTF16(r)),s=!1;try{r=JSON.parse(r+""),r.data&&r.ttl>(new Date).getTime()?(this.populateSource(r.data,n),s=!0):window[this.options.cache].removeItem("TYPEAHEAD_"+this.node.selector+":"+n)}catch(e){}if(s)continue}!i.data||i.ajax?i.ajax&&(this.requests[n]||(this.requests[n]=this.generateRequestObject(n))):this.populateSource(e.extend(!0,[],i.data),n)}this.handleRequests()}},generateRequestObject:function(e){var t=this,n=this.options.source[e],i={request:{url:n.ajax.url||null,dataType:"json",beforeSend:function(i){t.xhr[e]=i;var r=t.requests[e].callback.beforeSend||n.ajax.beforeSend;"function"==typeof r&&r.apply(null,arguments)}},callback:{beforeSend:null,done:null,fail:null,then:null,always:null},extra:{path:n.ajax.path||null,group:e},validForGroup:[e]};if("function"!=typeof n.ajax&&(n.ajax instanceof Object&&(i=this.extendXhrObject(i,n.ajax)),Object.keys(this.options.source).length>1))for(var r in this.requests)this.requests.hasOwnProperty(r)&&(this.requests[r].isDuplicated||i.request.url&&i.request.url===this.requests[r].request.url&&(this.requests[r].validForGroup.push(e),i.isDuplicated=!0,delete i.validForGroup));return i},extendXhrObject:function(t,n){return"object"==typeof n.callback&&(t.callback=n.callback,delete n.callback),"function"==typeof n.beforeSend&&(t.callback.beforeSend=n.beforeSend,delete n.beforeSend),t.request=e.extend(!0,t.request,n),"jsonp"!==t.request.dataType.toLowerCase()||t.request.jsonpCallback||(t.request.jsonpCallback="callback_"+t.extra.group),t},handleRequests:function(){var t=this,n=Object.keys(this.requests).length;if(this.helper.executeCallback.call(this,this.options.callback.onSendRequest,[this.node,this.query])===!1)return void(this.isGenerated=null);for(var i in this.requests)this.requests.hasOwnProperty(i)&&(this.requests[i].isDuplicated||!function(i,r){if("function"==typeof t.options.source[i].ajax){var s=t.options.source[i].ajax.call(t,t.query);if(r=t.extendXhrObject(r,s),"object"!=typeof r.request||!r.request.url)return}var a,o=!1;if(~r.request.url.indexOf("{{query}}")&&(o||(r=e.extend(!0,{},r),o=!0),r.request.url=r.request.url.replace("{{query}}",t.query)),r.request.data)for(var l in r.request.data)if(r.request.data.hasOwnProperty(l)&&~String(r.request.data[l]).indexOf("{{query}}")){o||(r=e.extend(!0,{},r),o=!0),r.request.data[l]=r.request.data[l].replace("{{query}}",t.query);break}e.ajax(r.request).done(function(e,i,s){for(var o,l=0,d=r.validForGroup.length;d>l;l++)a=t.requests[r.validForGroup[l]],a.callback.done instanceof Function&&(o=a.callback.done(e,i,s),e=Array.isArray(o)&&o||e),t.populateSource(e,a.extra.group,a.extra.path||a.request.path),n-=1,0===n&&t.helper.executeCallback.call(t,t.options.callback.onReceiveRequest,[t.node,t.query])}).fail(function(e,n,i){for(var s=0,o=r.validForGroup.length;o>s;s++)a=t.requests[r.validForGroup[s]],a.callback.fail instanceof Function&&a.callback.fail(e,n,i)}).always(function(e,n,i){for(var s=0,o=r.validForGroup.length;o>s;s++)a=t.requests[r.validForGroup[s]],a.callback.always instanceof Function&&a.callback.always(e,n,i)}).then(function(e,n){for(var i=0,s=r.validForGroup.length;s>i;i++)a=t.requests[r.validForGroup[i]],a.callback.then instanceof Function&&a.callback.then(e,n)})}(i,this.requests[i]))},populateSource:function(e,t,n){var i=this,r=this.options.source[t],s=r.ajax&&r.data;e="string"==typeof n?this.helper.namespace(n,e):e,Array.isArray(e)||(e=[]),s&&("function"==typeof s&&(s=s()),Array.isArray(s)&&(e=e.concat(s)));for(var a,o=r.display?"compiled"===r.display[0]?r.display[1]:r.display[0]:"compiled"===this.options.display[0]?this.options.display[1]:this.options.display[0],l=0,d=e.length;d>l;l++)"string"==typeof e[l]&&(a={},a[o]=e[l],e[l]=a),e[l].group=t;if(!this.options.dynamic&&this.dropdownFilter.dynamic.length)for(var c,h,u={},l=0,d=e.length;d>l;l++)for(var f=0,p=this.dropdownFilter.dynamic.length;p>f;f++)c=this.dropdownFilter.dynamic[f].key,h=e[l][c],h&&(this.dropdownFilter.dynamic[f].value||(this.dropdownFilter.dynamic[f].value=[]),u[c]||(u[c]=[]),~u[c].indexOf(h.toLowerCase())||(u[c].push(h.toLowerCase()),this.dropdownFilter.dynamic[f].value.push(h)));if(this.options.correlativeTemplate){var g=r.template||this.options.template,_="";if("function"==typeof g&&(g=g()),g){if(Array.isArray(this.options.correlativeTemplate))for(var l=0,d=this.options.correlativeTemplate.length;d>l;l++)_+="{{"+this.options.correlativeTemplate[l]+"}} ";else _=g.replace(/<.+?>/g,"");for(var l=0,d=e.length;d>l;l++)e[l].compiled=_.replace(/\{\{([\w\-\.]+)(?:\|(\w+))?}}/g,function(t,n){return i.helper.namespace(n,e[l],"get","")}).trim();r.display?~r.display.indexOf("compiled")||r.display.unshift("compiled"):~this.options.display.indexOf("compiled")||this.options.display.unshift("compiled")}}if(this.options.callback.onPopulateSource&&(e=this.helper.executeCallback.call(this,this.options.callback.onPopulateSource,[this.node,e,t,n])),this.tmpSource[t]=e,this.options.cache&&!window[this.options.cache].getItem("TYPEAHEAD_"+this.node.selector+":"+t)){this.options.callback.onCacheSave&&(e=this.helper.executeCallback.call(this,this.options.callback.onCacheSave,[this.node,e,t,n]));var m=JSON.stringify({data:e,ttl:(new Date).getTime()+this.options.ttl});this.options.compression&&(m=LZString.compressToUTF16(m)),window[this.options.cache].setItem("TYPEAHEAD_"+this.node.selector+":"+t,m)}this.incrementGeneratedGroup()},incrementGeneratedGroup:function(){if(this.generatedGroupCount++,this.groupCount===this.generatedGroupCount){this.isGenerated=!0,this.xhr={};for(var e=Object.keys(this.options.source),t=0,n=e.length;n>t;t++)this.source[e[t]]=this.tmpSource[e[t]];this.tmpSource={},this.options.dynamic||this.buildDropdownItemLayout("dynamic"),this.options.loadingAnimation&&this.container.removeClass("loading"),this.node.trigger("dynamic"+this.namespace)}},navigate:function(e){if(this.helper.executeCallback.call(this,this.options.callback.onNavigateBefore,[this.node,this.query,e]),27===e.keyCode)return e.preventDefault(),void(this.query.length?(this.node.val(""),this.node.trigger("input"+this.namespace)):(this.node.blur(),this.hideLayout()));if(this.isGenerated&&this.result.length){var t=this.resultContainer.find("."+this.options.selector.item),n=t.filter(".active"),i=n[0]&&t.index(n)||null,r=null;if(13===e.keyCode)return void(n.length>0&&(e.preventDefault(),n.find("a:first")[0].click()));if(39===e.keyCode)return void(i?t.eq(i).find("a:first")[0].click():this.options.hint&&""!==this.hint.container.val()&&this.helper.getCaret(this.node[0])>=this.query.length&&t.find('a[data-index="'+this.hintIndex+'"]')[0].click());t.length>0&&n.removeClass("active"),38===e.keyCode?(e.preventDefault(),n.length>0?i-1>=0&&(r=i-1,t.eq(r).addClass("active")):(r=t.length-1,t.last().addClass("active"))):40===e.keyCode&&(e.preventDefault(),n.length>0?i+1<t.length&&(r=i+1,t.eq(r).addClass("active")):(r=0,t.first().addClass("active"))),e.preventInputChange&&~[38,40].indexOf(e.keyCode)&&this.buildHintLayout(null!==r&&r<this.result.length?[this.result[r]]:null),this.options.hint&&this.hint.container&&this.hint.container.css("color",e.preventInputChange?this.hint.css.color:null===r&&this.hint.css.color||this.hint.container.css("background-color")||"fff"),this.node.val(null===r||e.preventInputChange?this.rawQuery:this.result[r][this.result[r].matchedKey]),this.helper.executeCallback.call(this,this.options.callback.onNavigateAfter,[this.node,t,null!==r&&t.eq(r).find("a:first")||void 0,null!==r&&this.result[r]||void 0,this.query,e])}},searchResult:function(e){e||(this.item={}),this.resetLayout(),this.helper.executeCallback.call(this,this.options.callback.onSearch,[this.node,this.query])!==!1&&(this.query.length>=this.options.minLength&&this.searchResultData(),this.helper.executeCallback.call(this,this.options.callback.onResult,[this.node,this.query,this.result,this.resultCount,this.resultCountPerGroup]))},searchResultData:function(){var e,t,n,i,r,s,a,o,l,d,c,h,u,f=this,p=this.groupBy,g=null,_=this.query.toLowerCase(),m=this.options.maxItemPerGroup,y=this.filters.dynamic&&!this.helper.isEmpty(this.filters.dynamic),v="function"==typeof this.options.matcher&&this.options.matcher;this.options.accent&&(_=this.helper.removeAccent.call(this,_));for(e in this.source)if(this.source.hasOwnProperty(e)&&(!this.filters.dropdown||"group"!==this.filters.dropdown.key||this.filters.dropdown.value===e)){a="undefined"!=typeof this.options.source[e].filter?this.options.source[e].filter:this.options.filter,l="function"==typeof this.options.source[e].matcher&&this.options.source[e].matcher||v;for(var x=0,b=this.source[e].length;b>x&&(!(this.result.length>=this.options.maxItem)||this.options.callback.onResult);x++)if((!y||this.dynamicFilter.validate.apply(this,[this.source[e][x]]))&&(t=this.source[e][x],!this.filters.dropdown||(t[this.filters.dropdown.key]||"").toLowerCase()===(this.filters.dropdown.value||"").toLowerCase())){if(g="group"===p?e:t[p],g&&!this.result[g]&&(this.result[g]=[],this.resultCountPerGroup[g]=0),m&&"group"===p&&this.result[g].length>=m&&!this.options.callback.onResult)break;r=this.options.source[e].display||this.options.display;for(var k=0,j=r.length;j>k;k++)if(s=/\./.test(r[k])?this.helper.namespace(r[k],t):t[r[k]],"undefined"!=typeof s&&""!==s){if(s=this.helper.cleanStringFromScript(s),"function"==typeof a){if(o=a.call(this,t,s),void 0===o)break;if(!o)continue;"object"==typeof o&&(t=o)}if(~[void 0,!0].indexOf(a)){if(i=s,i=i.toString().toLowerCase(),this.options.accent&&(i=this.helper.removeAccent.call(this,i)),n=i.indexOf(_),this.options.correlativeTemplate&&"compiled"===r[k]&&0>n&&/\s/.test(_)){c=!0,h=_.split(" "),u=i;for(var w=0,C=h.length;C>w;w++)if(""!==h[w]){if(!~u.indexOf(h[w])){c=!1;break}u=u.replace(h[w],"")}}if(0>n&&!c)continue;if(this.options.offset&&0!==n)continue;if(l){if(d=l.call(this,t,s),void 0===d)break;if(!d)continue;"object"==typeof d&&(t=d)}}if(this.resultCount++,this.resultCountPerGroup[g]++,this.resultItemCount<this.options.maxItem){if(m&&this.result[g].length>=m)break;t.matchedKey=r[k],this.result[g].push(t),this.resultItemCount++}break}if(!this.options.callback.onResult){if(this.resultItemCount>=this.options.maxItem)break;if(m&&this.result[g].length>=m&&"group"===p)break}}}if(this.options.order){var S,r=[];for(var e in this.result)if(this.result.hasOwnProperty(e)){for(var k=0,j=this.result[e].length;j>k;k++)S=this.options.source[this.result[e][k].group].display||this.options.display,~r.indexOf(S[0])||r.push(S[0]);this.result[e].sort(f.helper.sort(r,"asc"===f.options.order,function(e){return e.toString().toUpperCase()}))}}var A,T=[];A="function"==typeof this.options.groupOrder?this.options.groupOrder.apply(this,[this.node,this.query,this.result,this.resultCount,this.resultCountPerGroup]):Array.isArray(this.options.groupOrder)?this.options.groupOrder:"string"==typeof this.options.groupOrder&&~["asc","desc"].indexOf(this.options.groupOrder)?Object.keys(this.result).sort(f.helper.sort([],"asc"===f.options.groupOrder,function(e){return e.toString().toUpperCase()})):Object.keys(this.result),this.groups=A;for(var k=0,j=A.length;j>k;k++)T=T.concat(this.result[A[k]]||[]);this.result=T},buildLayout:function(){if(this.buildHtmlLayout(),this.buildBackdropLayout(),this.buildHintLayout(),this.options.callback.onLayoutBuiltBefore){var t=this.helper.executeCallback.call(this,this.options.callback.onLayoutBuiltBefore,[this.node,this.query,this.result,this.resultHtml]);t instanceof e&&(this.resultHtml=t)}this.resultHtml&&this.resultContainer.html(this.resultHtml),this.options.callback.onLayoutBuiltAfter&&this.helper.executeCallback.call(this,this.options.callback.onLayoutBuiltAfter,[this.node,this.query,this.result])},buildHtmlLayout:function(){if(this.options.resultContainer!==!1){this.resultContainer||(this.resultContainer=e("<div/>",{"class":this.options.selector.result}),this.container.append(this.resultContainer));var t;if(!this.result.length){if(!this.options.emptyTemplate)return;t="function"==typeof this.options.emptyTemplate?this.options.emptyTemplate.call(this,this.query):this.options.emptyTemplate.replace(/\{\{query}}/gi,this.helper.cleanStringFromScript(this.query))}var n=this.query.toLowerCase();this.options.accent&&(n=this.helper.removeAccent.call(this,n));var i=this,r=this.groupTemplate||"<ul></ul>",s=!1;this.groupTemplate?r=e(r.replace(/<([^>]+)>\{\{(.+?)}}<\/[^>]+>/g,function(e,n,r){var a="",o="group"===r?i.groups:[r];if(!i.result.length)return s===!0?"":(s=!0,"<"+n+' class="'+i.options.selector.empty+'"><a href="javascript:;">'+t+"</a></"+n+">");for(var l=0,d=o.length;d>l;++l)a+="<"+n+' data-group-template="'+o[l]+'"><ul></ul></'+n+">";return a})):(r=e(r),this.result.length||r.append(t instanceof e?t:'<li class="'+i.options.selector.empty+'"><a href="javascript:;">'+t+"</a></li>")),r.addClass(this.options.selector.list+(this.helper.isEmpty(this.result)?" empty":""));for(var a,o,l,d,c,h,u,f,p,g,_,m=this.groupTemplate&&this.result.length&&i.groups||[],y=0,v=this.result.length;v>y;++y)l=this.result[y],a=l.group,d=this.options.source[l.group].href||this.options.href,f=[],p=this.options.source[l.group].display||this.options.display,this.options.group&&(a=l[this.options.group.key],this.options.group.template&&("function"==typeof this.options.group.template?o=this.options.group.template(l):"string"==typeof this.options.template&&(o=this.options.group.template.replace(/\{\{([\w\-\.]+)}}/gi,function(e,t){return i.helper.namespace(t,l,"get","")}))),r.find('[data-search-group="'+a+'"]')[0]||(this.groupTemplate?r.find('[data-group-template="'+a+'"] ul'):r).append(e("<li/>",{"class":i.options.selector.group,html:e("<a/>",{href:"javascript:;",html:o||a,tabindex:-1}),"data-search-group":a}))),this.groupTemplate&&m.length&&(_=m.indexOf(a||l.group),~_&&m.splice(_,1)),c=e("<li/>",{"class":i.options.selector.item,html:e("<a/>",{href:function(){return d&&("string"==typeof d?d=d.replace(/\{\{([^\|}]+)(?:\|([^}]+))*}}/gi,function(e,t,n){var r=i.helper.namespace(t,l,"get","");return n=n&&n.split("|")||[],~n.indexOf("slugify")&&(r=i.helper.slugify.call(i,r)),r}):"function"==typeof d&&(d=d(l)),l.href=d),d||"javascript:;"}(),"data-group":a,"data-index":y,html:function(){if(h=l.group&&i.options.source[l.group].template||i.options.template)"function"==typeof h&&(h=h.call(i,i.query,l)),u=h.replace(/\{\{([^\|}]+)(?:\|([^}]+))*}}/gi,function(e,t,r){var s=i.helper.cleanStringFromScript(String(i.helper.namespace(t,l,"get","")));return r=r&&r.split("|")||[],~r.indexOf("slugify")&&(s=i.helper.slugify.call(i,s)),~r.indexOf("raw")||i.options.highlight===!0&&n&&~p.indexOf(t)&&(s=i.helper.highlight.call(i,s,n.split(" "),i.options.accent)),s});else{for(var t=0,r=p.length;r>t;t++)g=/\./.test(p[t])?i.helper.namespace(p[t],l):l[p[t]],"undefined"!=typeof g&&""!==g&&f.push(g);u='<span class="'+i.options.selector.display+'">'+i.helper.cleanStringFromScript(String(f.join(" ")))+"</span>"}(i.options.highlight===!0&&n&&!h||"any"===i.options.highlight)&&(u=i.helper.highlight.call(i,u,n.split(" "),i.options.accent)),e(this).append(u)}})}),function(t,n,r){r.on("click",function(t){return i.options.mustSelectItem&&i.helper.isEmpty(n)?void t.preventDefault():(i.item=n,void(i.helper.executeCallback.call(i,i.options.callback.onClickBefore,[i.node,e(this),n,t])!==!1&&(t.originalEvent&&t.originalEvent.defaultPrevented||t.isDefaultPrevented()||(i.query=i.rawQuery=n[n.matchedKey].toString(),i.focusOnly=!0,i.node.val(i.query).focus(),i.searchResult(!0),i.buildLayout(),i.hideLayout(),i.helper.executeCallback.call(i,i.options.callback.onClickAfter,[i.node,e(this),n,t])))))}),r.on("mouseenter",function(t){i.helper.executeCallback.call(i,i.options.callback.onMouseEnter,[i.node,e(this),n,t])}),r.on("mouseleave",function(t){i.helper.executeCallback.call(i,i.options.callback.onMouseLeave,[i.node,e(this),n,t])})}(y,l,c),(this.groupTemplate?r.find('[data-group-template="'+a+'"] ul'):r).append(c);if(this.result.length&&m.length)for(var y=0,v=m.length;v>y;++y)r.find('[data-group-template="'+m[y]+'"]').remove();this.resultHtml=r}},buildBackdropLayout:function(){this.options.backdrop&&(this.backdrop.container||(this.backdrop.css=e.extend({opacity:.6,filter:"alpha(opacity=60)",position:"fixed",top:0,right:0,bottom:0,left:0,"z-index":1040,"background-color":"#000"},this.options.backdrop),this.backdrop.container=e("<div/>",{"class":this.options.selector.backdrop,css:this.backdrop.css}).insertAfter(this.container)),this.container.addClass("backdrop").css({"z-index":this.backdrop.css["z-index"]+1,position:"relative"}))},buildHintLayout:function(t){if(this.options.hint){if(this.node[0].scrollWidth>Math.ceil(this.node.innerWidth()))return void(this.hint.container&&this.hint.container.val(""));var n=this,i="",t=t||this.result,r=this.query.toLowerCase();if(this.options.accent&&(r=this.helper.removeAccent.call(this,r)),this.hintIndex=null,this.query.length>=this.options.minLength){if(this.hint.container||(this.hint.css=e.extend({"border-color":"transparent",position:"absolute",top:0,display:"inline","z-index":-1,"float":"none",color:"silver","box-shadow":"none",cursor:"default","-webkit-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none"},this.options.hint),this.hint.container=e("<input/>",{type:this.node.attr("type"),"class":this.node.attr("class"),readonly:!0,unselectable:"on","aria-hidden":"true",tabindex:-1,click:function(){n.node.focus()}}).addClass(this.options.selector.hint).css(this.hint.css).insertAfter(this.node),this.node.parent().css({position:"relative"})),this.hint.container.css("color",this.hint.css.color),r)for(var s,a,o,l=0,d=t.length;d>l;l++){a=t[l].group,s=this.options.source[a].display||this.options.display;for(var c=0,h=s.length;h>c;c++)if(o=String(t[l][s[c]]).toLowerCase(),this.options.accent&&(o=this.helper.removeAccent.call(this,o)),0===o.indexOf(r)){i=String(t[l][s[c]]),this.hintIndex=l;break}if(null!==this.hintIndex)break}this.hint.container.val(i.length>0&&this.rawQuery+i.substring(this.query.length)||"")}}},buildDropdownLayout:function(){if(this.options.dropdownFilter){var t=this;e("<span/>",{"class":this.options.selector.filter,html:function(){e(this).append(e("<button/>",{type:"button","class":t.options.selector.filterButton,style:"display: none;",click:function(n){n.stopPropagation(),t.container.toggleClass("filter");var i=t.namespace+"-dropdown-filter";e("html").off(i),t.container.hasClass("filter")&&e("html").on("click"+i+" touchend"+i,function(n){e(n.target).closest("."+t.options.selector.filter)[0]||t.hasDragged||t.container.removeClass("filter")})}})),e(this).append(e("<ul/>",{"class":t.options.selector.dropdown}))}}).insertAfter(t.container.find("."+t.options.selector.query))}},buildDropdownItemLayout:function(t){function n(e){"*"===e.value?delete this.filters.dropdown:this.filters.dropdown=e,this.container.removeClass("filter").find("."+this.options.selector.filterButton).html(e.template),this.node.trigger("dynamic"+this.namespace),this.node.focus()}var i,r,s=this,a="string"==typeof this.options.dropdownFilter&&this.options.dropdownFilter||"All",o=this.container.find("."+this.options.selector.dropdown);("static"===t&&this.options.dropdownFilter===!0||"string"==typeof this.options.dropdownFilter)&&this.dropdownFilter["static"].push({key:"group",template:"{{group}}",all:a,value:Object.keys(this.options.source)});for(var l=0,d=this.dropdownFilter[t].length;d>l;l++){r=this.dropdownFilter[t][l],Array.isArray(r.value)||(r.value=[r.value]),r.all&&(this.dropdownFilterAll=r.all);for(var c=0,h=r.value.length;h>=c;c++)(c!==h||l===d-1)&&(c===h&&l===d-1&&"static"===t&&this.dropdownFilter.dynamic.length||(i=this.dropdownFilterAll||a,r.value[c]?i=r.template?r.template.replace(new RegExp("{{"+r.key+"}}","gi"),r.value[c]):r.value[c]:this.container.find("."+s.options.selector.filterButton).html(i),function(t,i,r){o.append(e("<li/>",{"class":s.options.selector.dropdownItem+" "+s.helper.slugify.call(s,i.key+"-"+(i.value[t]||a)),html:e("<a/>",{href:"javascript:;",html:r,click:function(e){e.preventDefault(),n.call(s,{key:i.key,value:i.value[t]||"*",template:r})}})}))}(c,r,i)))}this.dropdownFilter[t].length&&this.container.find("."+s.options.selector.filterButton).removeAttr("style")},dynamicFilter:{isEnabled:!1,init:function(){this.options.dynamicFilter&&(this.dynamicFilter.bind.call(this),this.dynamicFilter.isEnabled=!0)},validate:function(e){var t,n,i=null,r=null;for(var s in this.filters.dynamic)if(this.filters.dynamic.hasOwnProperty(s)&&(n=~s.indexOf(".")?this.helper.namespace(s,e,"get"):e[s],"|"!==this.filters.dynamic[s].modifier||i||(i=n==this.filters.dynamic[s].value||!1),"&"===this.filters.dynamic[s].modifier)){if(n!=this.filters.dynamic[s].value){r=!1;break}r=!0}return t=i,null!==r&&(t=r,r===!0&&null!==i&&(t=i)),!!t},set:function(e,t){var n=e.match(/^([|&])?(.+)/);t?this.filters.dynamic[n[2]]={modifier:n[1]||"|",value:t}:delete this.filters.dynamic[n[2]],this.dynamicFilter.isEnabled&&(this.searchResult(),this.buildLayout())},bind:function(){for(var t,n=this,i=0,r=this.options.dynamicFilter.length;r>i;i++)t=this.options.dynamicFilter[i],"string"==typeof t.selector&&(t.selector=e(t.selector)),t.selector instanceof e&&t.selector[0]&&t.key&&!function(e){e.selector.off(n.namespace).on("change"+n.namespace,function(){n.dynamicFilter.set.apply(n,[e.key,n.dynamicFilter.getValue(this)])}).trigger("change"+n.namespace)}(t)},getValue:function(e){var t;return"SELECT"===e.tagName?t=e.value:"INPUT"===e.tagName&&("checkbox"===e.type?t=e.checked&&e.getAttribute("value")||e.checked||null:"radio"===e.type&&e.checked&&(t=e.value)),t}},showLayout:function(){if(!this.container.hasClass("result")&&(this.result.length||this.options.emptyTemplate||this.options.backdropOnFocus)){var t=this;e("html").off(this.namespace).on("click"+this.namespace+" touchend"+this.namespace,function(n){e(n.target).closest(t.container)[0]||t.hasDragged||t.hideLayout()}),this.container.addClass([this.result.length||this.options.emptyTemplate&&this.query.length>=this.options.minLength?"result ":"",this.options.hint&&this.query.length>=this.options.minLength?"hint":"",this.options.backdrop||this.options.backdropOnFocus?"backdrop":""].join(" ")),this.helper.executeCallback.call(this,this.options.callback.onShowLayout,[this.node,this.query])}},hideLayout:function(){(this.container.hasClass("result")||this.container.hasClass("backdrop"))&&(this.container.removeClass("result hint filter"+(this.options.backdropOnFocus&&e(this.node).is(":focus")?"":" backdrop")),this.options.backdropOnFocus&&this.container.hasClass("backdrop")||(e("html").off(this.namespace),this.helper.executeCallback.call(this,this.options.callback.onHideLayout,[this.node,this.query])))},resetLayout:function(){this.result={},this.resultCount=0,this.resultCountPerGroup={},this.resultItemCount=0,this.resultHtml=null,this.options.hint&&this.hint.container&&this.hint.container.val("")},buildCancelButtonLayout:function(){if(this.options.cancelButton){var t=this;e("<span/>",{"class":this.options.selector.cancelButton,mousedown:function(e){e.stopImmediatePropagation(),e.preventDefault(),t.node.val(""),t.node.trigger("input"+t.namespace)}}).insertBefore(this.node)}},toggleCancelButton:function(){this.container.toggleClass("cancel",!!this.query.length)},__construct:function(){this.extendOptions(),this.unifySourceFormat()&&(this.dynamicFilter.init.apply(this),this.init(),this.delegateEvents(),this.buildCancelButtonLayout(),this.buildDropdownLayout(),this.buildDropdownItemLayout("static"),this.helper.executeCallback.call(this,this.options.callback.onReady,[this.node]))},helper:{isEmpty:function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},removeAccent:function(e){
if("string"==typeof e){var t=this.options.accent||i;return e=e.toLowerCase().replace(new RegExp("["+t.from+"]","g"),function(e){return t.to[t.from.indexOf(e)]})}},slugify:function(e){return e=String(e),""!==e&&(e=this.helper.removeAccent.call(this,e),e=e.replace(/[^-a-z0-9]+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")),e},sort:function(e,t,n){var i=function(t){for(var i=0,r=e.length;r>i;i++)if("undefined"!=typeof t[e[i]])return n(t[e[i]]);return t};return t=[-1,1][+!!t],function(e,n){return e=i(e),n=i(n),t*((e>n)-(n>e))}},replaceAt:function(e,t,n,i){return e.substring(0,t)+i+e.substring(t+n)},highlight:function(e,t,n){e=String(e);var i=n&&this.helper.removeAccent.call(this,e)||e,r=[];Array.isArray(t)||(t=[t]),t.sort(function(e,t){return t.length-e.length});for(var s=t.length-1;s>=0;s--)""!==t[s].trim()?t[s]=t[s].replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"):t.splice(s,1);i.replace(new RegExp("(?:"+t.join("|")+")(?!([^<]+)?>)","gi"),function(e,t,n){r.push({offset:n,length:e.length})});for(var s=r.length-1;s>=0;s--)e=this.helper.replaceAt(e,r[s].offset,r[s].length,"<strong>"+e.substr(r[s].offset,r[s].length)+"</strong>");return e},getCaret:function(e){if(e.selectionStart)return e.selectionStart;if(document.selection){e.focus();var t=document.selection.createRange();if(null==t)return 0;var n=e.createTextRange(),i=n.duplicate();return n.moveToBookmark(t.getBookmark()),i.setEndPoint("EndToStart",n),i.text.length}return 0},cleanStringFromScript:function(e){return"string"==typeof e&&e.replace(/<\/?(?:script|iframe)\b[^>]*>/gm,"")||e},executeCallback:function(e,t){if(e){var n;if("function"==typeof e)n=e;else if(("string"==typeof e||Array.isArray(e))&&("string"==typeof e&&(e=[e,[]]),n=this.helper.namespace(e[0],window),"function"!=typeof n))return;return n.apply(this,(e[1]||[]).concat(t?t:[]))}},namespace:function(e,t,n,i){if("string"!=typeof e||""===e)return!1;for(var r=e.split("."),s=t||window,n=n||"get",a=i||{},o="",l=0,d=r.length;d>l;l++){if(o=r[l],"undefined"==typeof s[o]){if(~["get","delete"].indexOf(n))return"undefined"!=typeof i?i:void 0;s[o]={}}if(~["set","create","delete"].indexOf(n)&&l===d-1){if("set"!==n&&"create"!==n)return delete s[o],!0;s[o]=a}s=s[o]}return s},typeWatch:function(){var e=0;return function(t,n){clearTimeout(e),e=setTimeout(t,n)}}()}},e.fn.typeahead=e.typeahead=function(e){return a.typeahead(this,e)};var a={typeahead:function(t,n){if(n&&n.source&&"object"==typeof n.source){if("function"==typeof t){if(!n.input)return;t=e(n.input)}if(t.length&&"INPUT"===t[0].nodeName)return window.Typeahead[n.input||t.selector]=new s(t,n)}}};return window.console=window.console||{log:function(){}},Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),"trim"in String.prototype||(String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")}),"indexOf"in Array.prototype||(Array.prototype.indexOf=function(e,t){void 0===t&&(t=0),0>t&&(t+=this.length),0>t&&(t=0);for(var n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1}),Object.keys||(Object.keys=function(e){var t,n=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&n.push(t);return n}),s}),function(e){var t,n,i="0.4.2",r="hasOwnProperty",s=/[\.\/]/,a=/\s*,\s*/,o="*",l=function(e,t){return e-t},d={n:{}},c=function(){for(var e=0,t=this.length;e<t;e++)if("undefined"!=typeof this[e])return this[e]},h=function(){for(var e=this.length;--e;)if("undefined"!=typeof this[e])return this[e]},u=function(e,i){e=String(e);var r,s=n,a=Array.prototype.slice.call(arguments,2),o=u.listeners(e),d=0,f=[],p={},g=[],_=t;g.firstDefined=c,g.lastDefined=h,t=e,n=0;for(var m=0,y=o.length;m<y;m++)"zIndex"in o[m]&&(f.push(o[m].zIndex),o[m].zIndex<0&&(p[o[m].zIndex]=o[m]));for(f.sort(l);f[d]<0;)if(r=p[f[d++]],g.push(r.apply(i,a)),n)return n=s,g;for(m=0;m<y;m++)if(r=o[m],"zIndex"in r)if(r.zIndex==f[d]){if(g.push(r.apply(i,a)),n)break;do if(d++,r=p[f[d]],r&&g.push(r.apply(i,a)),n)break;while(r)}else p[r.zIndex]=r;else if(g.push(r.apply(i,a)),n)break;return n=s,t=_,g};u._events=d,u.listeners=function(e){var t,n,i,r,a,l,c,h,u=e.split(s),f=d,p=[f],g=[];for(r=0,a=u.length;r<a;r++){for(h=[],l=0,c=p.length;l<c;l++)for(f=p[l].n,n=[f[u[r]],f[o]],i=2;i--;)t=n[i],t&&(h.push(t),g=g.concat(t.f||[]));p=h}return g},u.on=function(e,t){if(e=String(e),"function"!=typeof t)return function(){};for(var n=e.split(a),i=0,r=n.length;i<r;i++)!function(e){for(var n,i=e.split(s),r=d,a=0,o=i.length;a<o;a++)r=r.n,r=r.hasOwnProperty(i[a])&&r[i[a]]||(r[i[a]]={n:{}});for(r.f=r.f||[],a=0,o=r.f.length;a<o;a++)if(r.f[a]==t){n=!0;break}!n&&r.f.push(t)}(n[i]);return function(e){+e==+e&&(t.zIndex=+e)}},u.f=function(e){var t=[].slice.call(arguments,1);return function(){u.apply(null,[e,null].concat(t).concat([].slice.call(arguments,0)))}},u.stop=function(){n=1},u.nt=function(e){return e?new RegExp("(?:\\.|\\/|^)"+e+"(?:\\.|\\/|$)").test(t):t},u.nts=function(){return t.split(s)},u.off=u.unbind=function(e,t){if(!e)return void(u._events=d={n:{}});var n=e.split(a);if(n.length>1)for(var i=0,l=n.length;i<l;i++)u.off(n[i],t);else{n=e.split(s);var c,h,f,i,l,p,g,_=[d];for(i=0,l=n.length;i<l;i++)for(p=0;p<_.length;p+=f.length-2){if(f=[p,1],c=_[p].n,n[i]!=o)c[n[i]]&&f.push(c[n[i]]);else for(h in c)c[r](h)&&f.push(c[h]);_.splice.apply(_,f)}for(i=0,l=_.length;i<l;i++)for(c=_[i];c.n;){if(t){if(c.f){for(p=0,g=c.f.length;p<g;p++)if(c.f[p]==t){c.f.splice(p,1);break}!c.f.length&&delete c.f}for(h in c.n)if(c.n[r](h)&&c.n[h].f){var m=c.n[h].f;for(p=0,g=m.length;p<g;p++)if(m[p]==t){m.splice(p,1);break}!m.length&&delete c.n[h].f}}else{delete c.f;for(h in c.n)c.n[r](h)&&c.n[h].f&&delete c.n[h].f}c=c.n}}},u.once=function(e,t){var n=function(){return u.unbind(e,n),t.apply(this,arguments)};return u.on(e,n)},u.version=i,u.toString=function(){return"You are running Eve "+i},"undefined"!=typeof module&&module.exports?module.exports=u:"function"==typeof define&&define.amd?define("eve",[],function(){return u}):e.eve=u}(this),function(e,t){if("function"==typeof define&&define.amd)define(["eve"],function(n){return t(e,n)});else if("undefined"!=typeof exports){var n=require("eve");module.exports=t(e,n)}else t(e,e.eve)}(window||this,function(e,t){var n=function(t){var n={},i=e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame||e.msRequestAnimationFrame||function(e){setTimeout(e,16)},r=Array.isArray||function(e){return e instanceof Array||"[object Array]"==Object.prototype.toString.call(e)},s=0,a="M"+(+new Date).toString(36),o=function(){return a+(s++).toString(36)},l=Date.now||function(){return+new Date},d=function(e){var t=this;if(null==e)return t.s;var n=t.s-e;t.b+=t.dur*n,t.B+=t.dur*n,t.s=e},c=function(e){var t=this;return null==e?t.spd:void(t.spd=e)},h=function(e){var t=this;return null==e?t.dur:(t.s=t.s*e/t.dur,void(t.dur=e))},u=function(){var e=this;delete n[e.id],e.update(),t("mina.stop."+e.id,e)},f=function(){var e=this;e.pdif||(delete n[e.id],e.update(),e.pdif=e.get()-e.b)},p=function(){var e=this;e.pdif&&(e.b=e.get()-e.pdif,delete e.pdif,n[e.id]=e)},g=function(){var e,t=this;if(r(t.start)){e=[];for(var n=0,i=t.start.length;n<i;n++)e[n]=+t.start[n]+(t.end[n]-t.start[n])*t.easing(t.s)}else e=+t.start+(t.end-t.start)*t.easing(t.s);t.set(e)},_=function(){var e=0;for(var r in n)if(n.hasOwnProperty(r)){var s=n[r],a=s.get();e++,s.s=(a-s.b)/(s.dur/s.spd),s.s>=1&&(delete n[r],s.s=1,e--,function(e){setTimeout(function(){t("mina.finish."+e.id,e)})}(s)),s.update()}e&&i(_)},m=function(e,t,r,s,a,l,y){var v={id:o(),start:e,end:t,b:r,s:0,dur:s-r,spd:1,get:a,set:l,easing:y||m.linear,status:d,speed:c,duration:h,stop:u,pause:f,resume:p,update:g};n[v.id]=v;var x,b=0;for(x in n)if(n.hasOwnProperty(x)&&(b++,2==b))break;return 1==b&&i(_),v};return m.time=l,m.getById=function(e){return n[e]||null},m.linear=function(e){return e},m.easeout=function(e){return Math.pow(e,1.7)},m.easein=function(e){return Math.pow(e,.48)},m.easeinout=function(e){if(1==e)return 1;if(0==e)return 0;var t=.48-e/1.04,n=Math.sqrt(.1734+t*t),i=n-t,r=Math.pow(Math.abs(i),1/3)*(i<0?-1:1),s=-n-t,a=Math.pow(Math.abs(s),1/3)*(s<0?-1:1),o=r+a+.5;return 3*(1-o)*o*o+o*o*o},m.backin=function(e){if(1==e)return 1;var t=1.70158;return e*e*((t+1)*e-t)},m.backout=function(e){if(0==e)return 0;e-=1;var t=1.70158;return e*e*((t+1)*e+t)+1},m.elastic=function(e){return e==!!e?e:Math.pow(2,-10*e)*Math.sin((e-.075)*(2*Math.PI)/.3)+1},m.bounce=function(e){var t,n=7.5625,i=2.75;return e<1/i?t=n*e*e:e<2/i?(e-=1.5/i,t=n*e*e+.75):e<2.5/i?(e-=2.25/i,t=n*e*e+.9375):(e-=2.625/i,t=n*e*e+.984375),t},e.mina=m,m}("undefined"==typeof t?function(){}:t),i=function(e){function n(e,t){if(e){if(e.nodeType)return k(e);if(r(e,"array")&&n.set)return n.set.apply(n,e);if(e instanceof y)return e;if(null==t)return e=w.doc.querySelector(String(e)),k(e)}return e=null==e?"100%":e,t=null==t?"100%":t,new b(e,t)}function i(e,t){if(t){if("#text"==e&&(e=w.doc.createTextNode(t.text||t["#text"]||"")),"#comment"==e&&(e=w.doc.createComment(t.text||t["#text"]||"")),"string"==typeof e&&(e=i(e)),"string"==typeof t)return 1==e.nodeType?"xlink:"==t.substring(0,6)?e.getAttributeNS($,t.substring(6)):"xml:"==t.substring(0,4)?e.getAttributeNS(V,t.substring(4)):e.getAttribute(t):"text"==t?e.nodeValue:null;if(1==e.nodeType){for(var n in t)if(t[C](n)){var r=S(t[n]);r?"xlink:"==n.substring(0,6)?e.setAttributeNS($,n.substring(6),r):"xml:"==n.substring(0,4)?e.setAttributeNS(V,n.substring(4),r):e.setAttribute(n,r):e.removeAttribute(n)}}else"text"in t&&(e.nodeValue=t.text)}else e=w.doc.createElementNS(V,e);return e}function r(e,t){return t=S.prototype.toLowerCase.call(t),"finite"==t?isFinite(e):!("array"!=t||!(e instanceof Array||Array.isArray&&Array.isArray(e)))||("null"==t&&null===e||t==typeof e&&null!==e||"object"==t&&e===Object(e)||E.call(e).slice(8,-1).toLowerCase()==t)}function s(e){if("function"==typeof e||Object(e)!==e)return e;var t=new e.constructor;for(var n in e)e[C](n)&&(t[n]=s(e[n]));return t}function a(e,t){for(var n=0,i=e.length;n<i;n++)if(e[n]===t)return e.push(e.splice(n,1)[0])}function o(e,t,n){function i(){var r=Array.prototype.slice.call(arguments,0),s=r.join("\u2400"),o=i.cache=i.cache||{},l=i.count=i.count||[];return o[C](s)?(a(l,s),n?n(o[s]):o[s]):(l.length>=1e3&&delete o[l.shift()],l.push(s),o[s]=e.apply(t,r),n?n(o[s]):o[s])}return i}function l(e,t,n,i,r,s){if(null==r){var a=e-n,o=t-i;return a||o?(180+180*O.atan2(-o,-a)/L+360)%360:0}return l(e,t,r,s)-l(n,i,r,s)}function d(e){return e%360*L/180}function c(e){return 180*e/L%360}function h(e){var t=[];return e=e.replace(/(?:^|\s)(\w+)\(([^)]+)\)/g,function(e,n,i){return i=i.split(/\s*,\s*|\s+/),"rotate"==n&&1==i.length&&i.push(0,0),"scale"==n&&(i.length>2?i=i.slice(0,2):2==i.length&&i.push(0,0),1==i.length&&i.push(i[0],0,0)),"skewX"==n?t.push(["m",1,0,O.tan(d(i[0])),1,0,0]):"skewY"==n?t.push(["m",1,O.tan(d(i[0])),0,1,0,0]):t.push([n.charAt(0)].concat(i)),e}),t}function u(e,t){var i=ee(e),r=new n.Matrix;if(i)for(var s=0,a=i.length;s<a;s++){var o,l,d,c,h,u=i[s],f=u.length,p=S(u[0]).toLowerCase(),g=u[0]!=p,_=g?r.invert():0;"t"==p&&2==f?r.translate(u[1],0):"t"==p&&3==f?g?(o=_.x(0,0),l=_.y(0,0),d=_.x(u[1],u[2]),c=_.y(u[1],u[2]),r.translate(d-o,c-l)):r.translate(u[1],u[2]):"r"==p?2==f?(h=h||t,r.rotate(u[1],h.x+h.width/2,h.y+h.height/2)):4==f&&(g?(d=_.x(u[2],u[3]),c=_.y(u[2],u[3]),r.rotate(u[1],d,c)):r.rotate(u[1],u[2],u[3])):"s"==p?2==f||3==f?(h=h||t,r.scale(u[1],u[f-1],h.x+h.width/2,h.y+h.height/2)):4==f?g?(d=_.x(u[2],u[3]),c=_.y(u[2],u[3]),r.scale(u[1],u[1],d,c)):r.scale(u[1],u[1],u[2],u[3]):5==f&&(g?(d=_.x(u[3],u[4]),c=_.y(u[3],u[4]),r.scale(u[1],u[2],d,c)):r.scale(u[1],u[2],u[3],u[4])):"m"==p&&7==f&&r.add(u[1],u[2],u[3],u[4],u[5],u[6])}return r}function f(e){var t=e.node.ownerSVGElement&&k(e.node.ownerSVGElement)||e.node.parentNode&&k(e.node.parentNode)||n.select("svg")||n(0,0),i=t.select("defs"),r=null!=i&&i.node;return r||(r=x("defs",t.node).node),r}function p(e){return e.node.ownerSVGElement&&k(e.node.ownerSVGElement)||n.select("svg")}function _(e,t,n){function r(e){if(null==e)return P;if(e==+e)return e;i(d,{width:e});try{return d.getBBox().width}catch(e){return 0}}function s(e){if(null==e)return P;if(e==+e)return e;i(d,{height:e});try{return d.getBBox().height}catch(e){return 0}}function a(i,r){null==t?l[i]=r(e.attr(i)||0):i==t&&(l=r(null==n?e.attr(i)||0:n))}var o=p(e).node,l={},d=o.querySelector(".svg---mgr");switch(d||(d=i("rect"),i(d,{x:-9e9,y:-9e9,width:10,height:10,"class":"svg---mgr",fill:"none"}),o.appendChild(d)),e.type){case"rect":a("rx",r),a("ry",s);case"image":a("width",r),a("height",s);case"text":a("x",r),a("y",s);break;case"circle":a("cx",r),a("cy",s),a("r",r);break;case"ellipse":a("cx",r),a("cy",s),a("rx",r),a("ry",s);break;case"line":a("x1",r),a("x2",r),a("y1",s),a("y2",s);break;case"marker":a("refX",r),a("markerWidth",r),a("refY",s),a("markerHeight",s);break;case"radialGradient":a("fx",r),a("fy",s);break;case"tspan":a("dx",r),a("dy",s);break;default:a(t,r)}return o.removeChild(d),l}function m(e){r(e,"array")||(e=Array.prototype.slice.call(arguments,0));for(var t=0,n=0,i=this.node;this[t];)delete this[t++];for(t=0;t<e.length;t++)"set"==e[t].type?e[t].forEach(function(e){i.appendChild(e.node)}):i.appendChild(e[t].node);var s=i.childNodes;for(t=0;t<s.length;t++)this[n++]=k(s[t]);return this}function y(e){if(e.snap in X)return X[e.snap];var t;try{t=e.ownerSVGElement}catch(e){}this.node=e,t&&(this.paper=new b(t)),this.type=e.tagName||e.nodeName;var n=this.id=K(this);if(this.anims={},this._={transform:[]},e.snap=n,X[n]=this,"g"==this.type&&(this.add=m),this.type in{g:1,mask:1,pattern:1,symbol:1})for(var i in b.prototype)b.prototype[C](i)&&(this[i]=b.prototype[i])}function v(e){this.node=e}function x(e,t){var n=i(e);t.appendChild(n);var r=k(n);return r}function b(e,t){var n,r,s,a=b.prototype;if(e&&"svg"==e.tagName){if(e.snap in X)return X[e.snap];var o=e.ownerDocument;n=new y(e),r=e.getElementsByTagName("desc")[0],s=e.getElementsByTagName("defs")[0],r||(r=i("desc"),r.appendChild(o.createTextNode("Created with Snap")),n.node.appendChild(r)),s||(s=i("defs"),n.node.appendChild(s)),n.defs=s;for(var l in a)a[C](l)&&(n[l]=a[l]);n.paper=n.root=n}else n=x("svg",w.doc.body),i(n.node,{height:t,version:1.1,width:e,xmlns:V});return n}function k(e){return e?e instanceof y||e instanceof v?e:e.tagName&&"svg"==e.tagName.toLowerCase()?new b(e):e.tagName&&"object"==e.tagName.toLowerCase()&&"image/svg+xml"==e.type?new b(e.contentDocument.getElementsByTagName("svg")[0]):new y(e):e}function j(e,t){for(var n=0,i=e.length;n<i;n++){var r={type:e[n].type,attr:e[n].attr()},s=e[n].children();t.push(r),s.length&&j(s,r.childNodes=[])}}n.version="0.4.0",n.toString=function(){return"Snap v"+this.version},n._={};var w={win:e.window,doc:e.window.document};n._.glob=w;var C="hasOwnProperty",S=String,A=parseFloat,T=parseInt,O=Math,N=O.max,q=O.min,F=O.abs,L=(O.pow,O.PI),P=(O.round,""),E=Object.prototype.toString,B=/^\s*((#[a-f\d]{6})|(#[a-f\d]{3})|rgba?\(\s*([\d\.]+%?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+%?(?:\s*,\s*[\d\.]+%?)?)\s*\)|hsba?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?%?)\s*\)|hsla?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?%?)\s*\))\s*$/i,M=(n._.separator=/[,\s]+/,/[\s]*,[\s]*/),I={hs:1,rg:1},D=/([a-z])[\s,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\s]*,?[\s]*)+)/gi,G=/([rstm])[\s,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\s]*,?[\s]*)+)/gi,R=/(-?\d*\.?\d*(?:e[\-+]?\\d+)?)[\s]*,?[\s]*/gi,z=0,H="S"+(+new Date).toString(36),K=function(e){return(e&&e.type?e.type:P)+H+(z++).toString(36)},$="http://www.w3.org/1999/xlink",V="http://www.w3.org/2000/svg",X={};n.url=function(e){return"url('#"+e+"')"};n._.$=i,n._.id=K,n.format=function(){var e=/\{([^\}]+)\}/g,t=/(?:(?:^|\.)(.+?)(?=\[|\.|$|\()|\[('|")(.+?)\2\])(\(\))?/g,n=function(e,n,i){var r=i;return n.replace(t,function(e,t,n,i,s){t=t||i,r&&(t in r&&(r=r[t]),"function"==typeof r&&s&&(r=r()))}),r=(null==r||r==i?e:r)+""};return function(t,i){return S(t).replace(e,function(e,t){return n(e,t,i)})}}(),n._.clone=s,n._.cacher=o,n.rad=d,n.deg=c,n.sin=function(e){return O.sin(n.rad(e))},n.tan=function(e){return O.tan(n.rad(e))},n.cos=function(e){return O.cos(n.rad(e))},n.asin=function(e){return n.deg(O.asin(e))},n.acos=function(e){return n.deg(O.acos(e))},n.atan=function(e){return n.deg(O.atan(e))},n.atan2=function(e){return n.deg(O.atan2(e))},n.angle=l,n.len=function(e,t,i,r){return Math.sqrt(n.len2(e,t,i,r))},n.len2=function(e,t,n,i){return(e-n)*(e-n)+(t-i)*(t-i)},n.closestPoint=function(e,t,n){function i(e){var i=e.x-t,r=e.y-n;return i*i+r*r}for(var r,s,a,o,l=e.node,d=l.getTotalLength(),c=d/l.pathSegList.numberOfItems*.125,h=1/0,u=0;u<=d;u+=c)(o=i(a=l.getPointAtLength(u)))<h&&(r=a,s=u,h=o);for(c*=.5;c>.5;){var f,p,g,_,m,y;(g=s-c)>=0&&(m=i(f=l.getPointAtLength(g)))<h?(r=f,s=g,h=m):(_=s+c)<=d&&(y=i(p=l.getPointAtLength(_)))<h?(r=p,s=_,h=y):c*=.5}return r={x:r.x,y:r.y,length:s,distance:Math.sqrt(h)}},n.is=r,n.snapTo=function(e,t,n){if(n=r(n,"finite")?n:10,r(e,"array")){for(var i=e.length;i--;)if(F(e[i]-t)<=n)return e[i]}else{e=+e;var s=t%e;if(s<n)return t-s;if(s>e-n)return t-s+e}return t},n.getRGB=o(function(e){if(!e||(e=S(e)).indexOf("-")+1)return{r:-1,g:-1,b:-1,hex:"none",error:1,toString:W};if("none"==e)return{r:-1,g:-1,b:-1,hex:"none",toString:W};if(!(I[C](e.toLowerCase().substring(0,2))||"#"==e.charAt())&&(e=U(e)),!e)return{r:-1,g:-1,b:-1,hex:"none",error:1,toString:W};var t,i,s,a,o,l,d=e.match(B);return d?(d[2]&&(s=T(d[2].substring(5),16),i=T(d[2].substring(3,5),16),t=T(d[2].substring(1,3),16)),d[3]&&(s=T((o=d[3].charAt(3))+o,16),i=T((o=d[3].charAt(2))+o,16),t=T((o=d[3].charAt(1))+o,16)),d[4]&&(l=d[4].split(M),t=A(l[0]),"%"==l[0].slice(-1)&&(t*=2.55),i=A(l[1]),"%"==l[1].slice(-1)&&(i*=2.55),s=A(l[2]),"%"==l[2].slice(-1)&&(s*=2.55),"rgba"==d[1].toLowerCase().slice(0,4)&&(a=A(l[3])),l[3]&&"%"==l[3].slice(-1)&&(a/=100)),d[5]?(l=d[5].split(M),t=A(l[0]),"%"==l[0].slice(-1)&&(t/=100),i=A(l[1]),"%"==l[1].slice(-1)&&(i/=100),s=A(l[2]),"%"==l[2].slice(-1)&&(s/=100),("deg"==l[0].slice(-3)||"\xb0"==l[0].slice(-1))&&(t/=360),"hsba"==d[1].toLowerCase().slice(0,4)&&(a=A(l[3])),l[3]&&"%"==l[3].slice(-1)&&(a/=100),n.hsb2rgb(t,i,s,a)):d[6]?(l=d[6].split(M),t=A(l[0]),"%"==l[0].slice(-1)&&(t/=100),i=A(l[1]),"%"==l[1].slice(-1)&&(i/=100),s=A(l[2]),"%"==l[2].slice(-1)&&(s/=100),("deg"==l[0].slice(-3)||"\xb0"==l[0].slice(-1))&&(t/=360),"hsla"==d[1].toLowerCase().slice(0,4)&&(a=A(l[3])),l[3]&&"%"==l[3].slice(-1)&&(a/=100),n.hsl2rgb(t,i,s,a)):(t=q(O.round(t),255),i=q(O.round(i),255),s=q(O.round(s),255),a=q(N(a,0),1),d={r:t,g:i,b:s,toString:W},d.hex="#"+(16777216|s|i<<8|t<<16).toString(16).slice(1),d.opacity=r(a,"finite")?a:1,d)):{r:-1,g:-1,b:-1,hex:"none",error:1,toString:W}},n),n.hsb=o(function(e,t,i){return n.hsb2rgb(e,t,i).hex}),n.hsl=o(function(e,t,i){return n.hsl2rgb(e,t,i).hex}),n.rgb=o(function(e,t,n,i){if(r(i,"finite")){var s=O.round;return"rgba("+[s(e),s(t),s(n),+i.toFixed(2)]+")"}return"#"+(16777216|n|t<<8|e<<16).toString(16).slice(1)});var U=function(e){var t=w.doc.getElementsByTagName("head")[0]||w.doc.getElementsByTagName("svg")[0],n="rgb(255, 0, 0)";return(U=o(function(e){if("red"==e.toLowerCase())return n;t.style.color=n,t.style.color=e;var i=w.doc.defaultView.getComputedStyle(t,P).getPropertyValue("color");return i==n?null:i}))(e)},Y=function(){return"hsb("+[this.h,this.s,this.b]+")"},J=function(){return"hsl("+[this.h,this.s,this.l]+")"},W=function(){return 1==this.opacity||null==this.opacity?this.hex:"rgba("+[this.r,this.g,this.b,this.opacity]+")"},Q=function(e,t,i){if(null==t&&r(e,"object")&&"r"in e&&"g"in e&&"b"in e&&(i=e.b,t=e.g,e=e.r),null==t&&r(e,string)){var s=n.getRGB(e);e=s.r,t=s.g,i=s.b}return(e>1||t>1||i>1)&&(e/=255,t/=255,i/=255),[e,t,i]},Z=function(e,t,i,s){e=O.round(255*e),t=O.round(255*t),i=O.round(255*i);var a={r:e,g:t,b:i,opacity:r(s,"finite")?s:1,hex:n.rgb(e,t,i),toString:W};return r(s,"finite")&&(a.opacity=s),a};n.color=function(e){var t;return r(e,"object")&&"h"in e&&"s"in e&&"b"in e?(t=n.hsb2rgb(e),e.r=t.r,e.g=t.g,e.b=t.b,e.opacity=1,e.hex=t.hex):r(e,"object")&&"h"in e&&"s"in e&&"l"in e?(t=n.hsl2rgb(e),e.r=t.r,e.g=t.g,e.b=t.b,e.opacity=1,e.hex=t.hex):(r(e,"string")&&(e=n.getRGB(e)),r(e,"object")&&"r"in e&&"g"in e&&"b"in e&&!("error"in e)?(t=n.rgb2hsl(e),e.h=t.h,e.s=t.s,e.l=t.l,t=n.rgb2hsb(e),e.v=t.b):(e={hex:"none"},e.r=e.g=e.b=e.h=e.s=e.v=e.l=-1,e.error=1)),e.toString=W,e},n.hsb2rgb=function(e,t,n,i){r(e,"object")&&"h"in e&&"s"in e&&"b"in e&&(n=e.b,t=e.s,i=e.o,e=e.h),e*=360;var s,a,o,l,d;return e=e%360/60,d=n*t,l=d*(1-F(e%2-1)),s=a=o=n-d,e=~~e,s+=[d,l,0,0,l,d][e],a+=[l,d,d,l,0,0][e],o+=[0,0,l,d,d,l][e],Z(s,a,o,i)},n.hsl2rgb=function(e,t,n,i){r(e,"object")&&"h"in e&&"s"in e&&"l"in e&&(n=e.l,t=e.s,e=e.h),(e>1||t>1||n>1)&&(e/=360,t/=100,n/=100),e*=360;var s,a,o,l,d;return e=e%360/60,d=2*t*(n<.5?n:1-n),l=d*(1-F(e%2-1)),s=a=o=n-d/2,e=~~e,s+=[d,l,0,0,l,d][e],a+=[l,d,d,l,0,0][e],o+=[0,0,l,d,d,l][e],Z(s,a,o,i)},n.rgb2hsb=function(e,t,n){n=Q(e,t,n),e=n[0],t=n[1],n=n[2];var i,r,s,a;return s=N(e,t,n),a=s-q(e,t,n),i=0==a?null:s==e?(t-n)/a:s==t?(n-e)/a+2:(e-t)/a+4,i=(i+360)%6*60/360,r=0==a?0:a/s,{h:i,s:r,b:s,toString:Y}},n.rgb2hsl=function(e,t,n){n=Q(e,t,n),e=n[0],t=n[1],n=n[2];var i,r,s,a,o,l;return a=N(e,t,n),o=q(e,t,n),l=a-o,i=0==l?null:a==e?(t-n)/l:a==t?(n-e)/l+2:(e-t)/l+4,i=(i+360)%6*60/360,s=(a+o)/2,r=0==l?0:s<.5?l/(2*s):l/(2-2*s),{h:i,s:r,l:s,toString:J}},n.parsePathString=function(e){if(!e)return null;var t=n.path(e);if(t.arr)return n.path.clone(t.arr);var i={a:7,c:6,o:2,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,u:3,z:0},s=[];return r(e,"array")&&r(e[0],"array")&&(s=n.path.clone(e)),s.length||S(e).replace(D,function(e,t,n){var r=[],a=t.toLowerCase();if(n.replace(R,function(e,t){t&&r.push(+t)}),"m"==a&&r.length>2&&(s.push([t].concat(r.splice(0,2))),a="l",t="m"==t?"l":"L"),"o"==a&&1==r.length&&s.push([t,r[0]]),"r"==a)s.push([t].concat(r));else for(;r.length>=i[a]&&(s.push([t].concat(r.splice(0,i[a]))),i[a]););}),s.toString=n.path.toString,t.arr=n.path.clone(s),s};var ee=n.parseTransformString=function(e){if(!e)return null;var t=[];return r(e,"array")&&r(e[0],"array")&&(t=n.path.clone(e)),t.length||S(e).replace(G,function(e,n,i){var r=[];n.toLowerCase();i.replace(R,function(e,t){t&&r.push(+t)}),t.push([n].concat(r))}),t.toString=n.path.toString,t};n._.svgTransform2string=h,n._.rgTransform=/^[a-z][\s]*-?\.?\d/i,n._.transform2matrix=u,n._unit2px=_;w.doc.contains||w.doc.compareDocumentPosition?function(e,t){var n=9==e.nodeType?e.documentElement:e,i=t&&t.parentNode;return e==i||!(!i||1!=i.nodeType||!(n.contains?n.contains(i):e.compareDocumentPosition&&16&e.compareDocumentPosition(i)))}:function(e,t){if(t)for(;t;)if(t=t.parentNode,t==e)return!0;return!1};n._.getSomeDefs=f,n._.getSomeSVG=p,n.select=function(e){return e=S(e).replace(/([^\\]):/g,"$1\\:"),k(w.doc.querySelector(e))},n.selectAll=function(e){for(var t=w.doc.querySelectorAll(e),i=(n.set||Array)(),r=0;r<t.length;r++)i.push(k(t[r]));return i},setInterval(function(){for(var e in X)if(X[C](e)){var t=X[e],n=t.node;("svg"!=t.type&&!n.ownerSVGElement||"svg"==t.type&&(!n.parentNode||"ownerSVGElement"in n.parentNode&&!n.ownerSVGElement))&&delete X[e]}},1e4),y.prototype.attr=function(e,n){var i=this,s=i.node;if(!e){if(1!=s.nodeType)return{text:s.nodeValue};for(var a=s.attributes,o={},l=0,d=a.length;l<d;l++)o[a[l].nodeName]=a[l].nodeValue;return o}if(r(e,"string")){if(!(arguments.length>1))return t("snap.util.getattr."+e,i).firstDefined();var c={};c[e]=n,e=c}for(var h in e)e[C](h)&&t("snap.util.attr."+h,i,e[h]);return i},n.parse=function(e){var t=w.doc.createDocumentFragment(),n=!0,i=w.doc.createElement("div");if(e=S(e),e.match(/^\s*<\s*svg(?:\s|>)/)||(e="<svg>"+e+"</svg>",n=!1),i.innerHTML=e,e=i.getElementsByTagName("svg")[0])if(n)t=e;else for(;e.firstChild;)t.appendChild(e.firstChild);return new v(t)},n.fragment=function(){for(var e=Array.prototype.slice.call(arguments,0),t=w.doc.createDocumentFragment(),i=0,r=e.length;i<r;i++){var s=e[i];s.node&&s.node.nodeType&&t.appendChild(s.node),s.nodeType&&t.appendChild(s),"string"==typeof s&&t.appendChild(n.parse(s).node)}return new v(t)},n._.make=x,n._.wrap=k,b.prototype.el=function(e,t){var n=x(e,this.node);return t&&n.attr(t),n},y.prototype.children=function(){for(var e=[],t=this.node.childNodes,i=0,r=t.length;i<r;i++)e[i]=n(t[i]);return e},y.prototype.toJSON=function(){var e=[];return j([this],e),e[0]},t.on("snap.util.getattr",function(){var e=t.nt();e=e.substring(e.lastIndexOf(".")+1);var n=e.replace(/[A-Z]/g,function(e){return"-"+e.toLowerCase()});return te[C](n)?this.node.ownerDocument.defaultView.getComputedStyle(this.node,null).getPropertyValue(n):i(this.node,e)});var te={"alignment-baseline":0,"baseline-shift":0,clip:0,"clip-path":0,"clip-rule":0,color:0,"color-interpolation":0,"color-interpolation-filters":0,"color-profile":0,"color-rendering":0,cursor:0,direction:0,display:0,"dominant-baseline":0,"enable-background":0,fill:0,"fill-opacity":0,"fill-rule":0,filter:0,"flood-color":0,"flood-opacity":0,font:0,"font-family":0,"font-size":0,"font-size-adjust":0,"font-stretch":0,"font-style":0,"font-variant":0,"font-weight":0,"glyph-orientation-horizontal":0,"glyph-orientation-vertical":0,"image-rendering":0,kerning:0,"letter-spacing":0,"lighting-color":0,marker:0,"marker-end":0,"marker-mid":0,"marker-start":0,mask:0,opacity:0,overflow:0,"pointer-events":0,"shape-rendering":0,"stop-color":0,"stop-opacity":0,stroke:0,"stroke-dasharray":0,"stroke-dashoffset":0,"stroke-linecap":0,"stroke-linejoin":0,"stroke-miterlimit":0,"stroke-opacity":0,"stroke-width":0,"text-anchor":0,"text-decoration":0,"text-rendering":0,"unicode-bidi":0,visibility:0,"word-spacing":0,"writing-mode":0};t.on("snap.util.attr",function(e){var n=t.nt(),r={};n=n.substring(n.lastIndexOf(".")+1),r[n]=e;var s=n.replace(/-(\w)/gi,function(e,t){return t.toUpperCase()}),a=n.replace(/[A-Z]/g,function(e){return"-"+e.toLowerCase()});te[C](a)?this.node.style[s]=null==e?P:e:i(this.node,r)}),function(){}(b.prototype),n.ajax=function(e,n,i,s){var a=new XMLHttpRequest,o=K();if(a){if(r(n,"function"))s=i,i=n,n=null;else if(r(n,"object")){var l=[];for(var d in n)n.hasOwnProperty(d)&&l.push(encodeURIComponent(d)+"="+encodeURIComponent(n[d]));n=l.join("&")}return a.open(n?"POST":"GET",e,!0),n&&(a.setRequestHeader("X-Requested-With","XMLHttpRequest"),a.setRequestHeader("Content-type","application/x-www-form-urlencoded")),i&&(t.once("snap.ajax."+o+".0",i),t.once("snap.ajax."+o+".200",i),t.once("snap.ajax."+o+".304",i)),a.onreadystatechange=function(){4==a.readyState&&t("snap.ajax."+o+"."+a.status,s,a)},4==a.readyState?a:(a.send(n),a)}},n.load=function(e,t,i){n.ajax(e,function(e){var r=n.parse(e.responseText);i?t.call(i,r):t(r)})};var ne=function(e){var t=e.getBoundingClientRect(),n=e.ownerDocument,i=n.body,r=n.documentElement,s=r.clientTop||i.clientTop||0,a=r.clientLeft||i.clientLeft||0,o=t.top+(g.win.pageYOffset||r.scrollTop||i.scrollTop)-s,l=t.left+(g.win.pageXOffset||r.scrollLeft||i.scrollLeft)-a;return{y:o,x:l}};return n.getElementByPoint=function(e,t){var n=this,i=(n.canvas,w.doc.elementFromPoint(e,t));if(w.win.opera&&"svg"==i.tagName){var r=ne(i),s=i.createSVGRect();s.x=e-r.x,s.y=t-r.y,s.width=s.height=1;var a=i.getIntersectionList(s,null);a.length&&(i=a[a.length-1])}return i?k(i):null},n.plugin=function(e){e(n,y,b,w,v)},w.win.Snap=n,n}(e||this);return i.plugin(function(i,r,s,a,o){function l(e,t){if(null==t){var n=!0;if(t="linearGradient"==e.type||"radialGradient"==e.type?e.node.getAttribute("gradientTransform"):"pattern"==e.type?e.node.getAttribute("patternTransform"):e.node.getAttribute("transform"),!t)return new i.Matrix;t=i._.svgTransform2string(t)}else t=i._.rgTransform.test(t)?p(t).replace(/\.{3}|\u2026/g,e._.transform||""):i._.svgTransform2string(t),f(t,"array")&&(t=i.path?i.path.toString.call(t):p(t)),e._.transform=t;var r=i._.transform2matrix(t,e.getBBox(1));return n?r:void(e.matrix=r)}function d(e){function t(e,t){var n=_(e.node,t);n=n&&n.match(s),n=n&&n[2],n&&"#"==n.charAt()&&(n=n.substring(1),n&&(o[n]=(o[n]||[]).concat(function(n){var i={};i[t]=URL(n),_(e.node,i)})))}function n(e){var t=_(e.node,"xlink:href");t&&"#"==t.charAt()&&(t=t.substring(1),t&&(o[t]=(o[t]||[]).concat(function(t){e.attr("xlink:href","#"+t)})))}for(var i,r=e.selectAll("*"),s=/^\s*url\(("|'|)(.*)\1\)\s*$/,a=[],o={},l=0,d=r.length;l<d;l++){i=r[l],t(i,"fill"),t(i,"stroke"),t(i,"filter"),t(i,"mask"),t(i,"clip-path"),n(i);var c=_(i.node,"id");c&&(_(i.node,{id:i.id}),a.push({old:c,id:i.id}))}for(l=0,d=a.length;l<d;l++){var h=o[a[l].old];if(h)for(var u=0,f=h.length;u<f;u++)h[u](a[l].id)}}function c(e,t,n){return function(i){var r=i.slice(e,t);return 1==r.length&&(r=r[0]),n?n(r):r}}function h(e){return function(){var t=e?"<"+this.type:"",n=this.node.attributes,i=this.node.childNodes;if(e)for(var r=0,s=n.length;r<s;r++)t+=" "+n[r].name+'="'+n[r].value.replace(/"/g,'\\"')+'"';if(i.length){for(e&&(t+=">"),r=0,s=i.length;r<s;r++)3==i[r].nodeType?t+=i[r].nodeValue:1==i[r].nodeType&&(t+=x(i[r]).toString());e&&(t+="</"+this.type+">")}else e&&(t+="/>");return t}}var u=r.prototype,f=i.is,p=String,g=i._unit2px,_=i._.$,m=i._.make,y=i._.getSomeDefs,v="hasOwnProperty",x=i._.wrap;u.getBBox=function(e){if(!i.Matrix||!i.path)return this.node.getBBox();var t=this,n=new i.Matrix;if(t.removed)return i._.box();for(;"use"==t.type;)if(e||(n=n.add(t.transform().localMatrix.translate(t.attr("x")||0,t.attr("y")||0))),t.original)t=t.original;else{var r=t.attr("xlink:href");t=t.original=t.node.ownerDocument.getElementById(r.substring(r.indexOf("#")+1))}var s=t._,a=i.path.get[t.type]||i.path.get.deflt;try{return e?(s.bboxwt=a?i.path.getBBox(t.realPath=a(t)):i._.box(t.node.getBBox()),i._.box(s.bboxwt)):(t.realPath=a(t),t.matrix=t.transform().localMatrix,s.bbox=i.path.getBBox(i.path.map(t.realPath,n.add(t.matrix))),i._.box(s.bbox))}catch(e){return i._.box()}};var b=function(){return this.string};u.transform=function(e){var t=this._;if(null==e){for(var n,r=this,s=new i.Matrix(this.node.getCTM()),a=l(this),o=[a],d=new i.Matrix,c=a.toTransformString(),h=p(a)==p(this.matrix)?p(t.transform):c;"svg"!=r.type&&(r=r.parent());)o.push(l(r));for(n=o.length;n--;)d.add(o[n]);return{string:h,globalMatrix:s,totalMatrix:d,localMatrix:a,diffMatrix:s.clone().add(a.invert()),global:s.toTransformString(),total:d.toTransformString(),local:c,toString:b}}return e instanceof i.Matrix?(this.matrix=e,this._.transform=e.toTransformString()):l(this,e),this.node&&("linearGradient"==this.type||"radialGradient"==this.type?_(this.node,{gradientTransform:this.matrix}):"pattern"==this.type?_(this.node,{patternTransform:this.matrix}):_(this.node,{transform:this.matrix})),this},u.parent=function(){return x(this.node.parentNode)},u.append=u.add=function(e){if(e){if("set"==e.type){var t=this;return e.forEach(function(e){t.add(e)}),this}e=x(e),this.node.appendChild(e.node),e.paper=this.paper}return this},u.appendTo=function(e){return e&&(e=x(e),e.append(this)),this},u.prepend=function(e){if(e){if("set"==e.type){var t,n=this;return e.forEach(function(e){t?t.after(e):n.prepend(e),t=e}),this}e=x(e);var i=e.parent();this.node.insertBefore(e.node,this.node.firstChild),this.add&&this.add(),e.paper=this.paper,this.parent()&&this.parent().add(),i&&i.add()}return this},u.prependTo=function(e){return e=x(e),e.prepend(this),this},u.before=function(e){if("set"==e.type){var t=this;return e.forEach(function(e){var n=e.parent();t.node.parentNode.insertBefore(e.node,t.node),n&&n.add()}),this.parent().add(),this}e=x(e);var n=e.parent();return this.node.parentNode.insertBefore(e.node,this.node),this.parent()&&this.parent().add(),n&&n.add(),e.paper=this.paper,this},u.after=function(e){e=x(e);var t=e.parent();return this.node.nextSibling?this.node.parentNode.insertBefore(e.node,this.node.nextSibling):this.node.parentNode.appendChild(e.node),this.parent()&&this.parent().add(),t&&t.add(),e.paper=this.paper,this},u.insertBefore=function(e){e=x(e);var t=this.parent();return e.node.parentNode.insertBefore(this.node,e.node),this.paper=e.paper,t&&t.add(),e.parent()&&e.parent().add(),this},u.insertAfter=function(e){e=x(e);var t=this.parent();return e.node.parentNode.insertBefore(this.node,e.node.nextSibling),this.paper=e.paper,t&&t.add(),e.parent()&&e.parent().add(),this},u.remove=function(){var e=this.parent();return this.node.parentNode&&this.node.parentNode.removeChild(this.node),delete this.paper,this.removed=!0,e&&e.add(),this},u.select=function(e){return x(this.node.querySelector(e))},u.selectAll=function(e){for(var t=this.node.querySelectorAll(e),n=(i.set||Array)(),r=0;r<t.length;r++)n.push(x(t[r]));return n},u.asPX=function(e,t){return null==t&&(t=this.attr(e)),+g(this,e,t)},u.use=function(){var e,t=this.node.id;return t||(t=this.id,_(this.node,{id:t})),e="linearGradient"==this.type||"radialGradient"==this.type||"pattern"==this.type?m(this.type,this.node.parentNode):m("use",this.node.parentNode),
_(e.node,{"xlink:href":"#"+t}),e.original=this,e},u.clone=function(){var e=x(this.node.cloneNode(!0));return _(e.node,"id")&&_(e.node,{id:e.id}),d(e),e.insertAfter(this),e},u.toDefs=function(){var e=y(this);return e.appendChild(this.node),this},u.pattern=u.toPattern=function(e,t,n,i){var r=m("pattern",y(this));return null==e&&(e=this.getBBox()),f(e,"object")&&"x"in e&&(t=e.y,n=e.width,i=e.height,e=e.x),_(r.node,{x:e,y:t,width:n,height:i,patternUnits:"userSpaceOnUse",id:r.id,viewBox:[e,t,n,i].join(" ")}),r.node.appendChild(this.node),r},u.marker=function(e,t,n,i,r,s){var a=m("marker",y(this));return null==e&&(e=this.getBBox()),f(e,"object")&&"x"in e&&(t=e.y,n=e.width,i=e.height,r=e.refX||e.cx,s=e.refY||e.cy,e=e.x),_(a.node,{viewBox:[e,t,n,i].join(" "),markerWidth:n,markerHeight:i,orient:"auto",refX:r||0,refY:s||0,id:a.id}),a.node.appendChild(this.node),a};var k=function(e,t,i,r){"function"!=typeof i||i.length||(r=i,i=n.linear),this.attr=e,this.dur=t,i&&(this.easing=i),r&&(this.callback=r)};i._.Animation=k,i.animation=function(e,t,n,i){return new k(e,t,n,i)},u.inAnim=function(){var e=this,t=[];for(var n in e.anims)e.anims[v](n)&&!function(e){t.push({anim:new k(e._attrs,e.dur,e.easing,e._callback),mina:e,curStatus:e.status(),status:function(t){return e.status(t)},stop:function(){e.stop()}})}(e.anims[n]);return t},i.animate=function(e,i,r,s,a,o){"function"!=typeof a||a.length||(o=a,a=n.linear);var l=n.time(),d=n(e,i,l,l+s,n.time,r,a);return o&&t.once("mina.finish."+d.id,o),d},u.stop=function(){for(var e=this.inAnim(),t=0,n=e.length;t<n;t++)e[t].stop();return this},u.animate=function(e,i,r,s){"function"!=typeof r||r.length||(s=r,r=n.linear),e instanceof k&&(s=e.callback,r=e.easing,i=e.dur,e=e.attr);var a,o,l,d,h=[],u=[],g={},_=this;for(var m in e)if(e[v](m)){_.equal?(d=_.equal(m,p(e[m])),a=d.from,o=d.to,l=d.f):(a=+_.attr(m),o=+e[m]);var y=f(a,"array")?a.length:1;g[m]=c(h.length,h.length+y,l),h=h.concat(a),u=u.concat(o)}var x=n.time(),b=n(h,u,x,x+i,n.time,function(e){var t={};for(var n in g)g[v](n)&&(t[n]=g[n](e));_.attr(t)},r);return _.anims[b.id]=b,b._attrs=e,b._callback=s,t("snap.animcreated."+_.id,b),t.once("mina.finish."+b.id,function(){delete _.anims[b.id],s&&s.call(_)}),t.once("mina.stop."+b.id,function(){delete _.anims[b.id]}),_};var j={};u.data=function(e,n){var r=j[this.id]=j[this.id]||{};if(0==arguments.length)return t("snap.data.get."+this.id,this,r,null),r;if(1==arguments.length){if(i.is(e,"object")){for(var s in e)e[v](s)&&this.data(s,e[s]);return this}return t("snap.data.get."+this.id,this,r[e],e),r[e]}return r[e]=n,t("snap.data.set."+this.id,this,n,e),this},u.removeData=function(e){return null==e?j[this.id]={}:j[this.id]&&delete j[this.id][e],this},u.outerSVG=u.toString=h(1),u.innerSVG=h(),u.toDataURL=function(){if(e&&e.btoa){var t=this.getBBox(),n=i.format('<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="{width}" height="{height}" viewBox="{x} {y} {width} {height}">{contents}</svg>',{x:+t.x.toFixed(3),y:+t.y.toFixed(3),width:+t.width.toFixed(3),height:+t.height.toFixed(3),contents:this.outerSVG()});return"data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(n)))}},o.prototype.select=u.select,o.prototype.selectAll=u.selectAll}),i.plugin(function(e){function t(e,t,i,r,s,a){return null==t&&"[object SVGMatrix]"==n.call(e)?(this.a=e.a,this.b=e.b,this.c=e.c,this.d=e.d,this.e=e.e,void(this.f=e.f)):void(null!=e?(this.a=+e,this.b=+t,this.c=+i,this.d=+r,this.e=+s,this.f=+a):(this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0))}var n=Object.prototype.toString,i=String,r=Math,s="";!function(n){function a(e){return e[0]*e[0]+e[1]*e[1]}function o(e){var t=r.sqrt(a(e));e[0]&&(e[0]/=t),e[1]&&(e[1]/=t)}n.add=function(e,n,i,r,s,a){var o,l,d,c,h=[[],[],[]],u=[[this.a,this.c,this.e],[this.b,this.d,this.f],[0,0,1]],f=[[e,i,s],[n,r,a],[0,0,1]];for(e&&e instanceof t&&(f=[[e.a,e.c,e.e],[e.b,e.d,e.f],[0,0,1]]),o=0;o<3;o++)for(l=0;l<3;l++){for(c=0,d=0;d<3;d++)c+=u[o][d]*f[d][l];h[o][l]=c}return this.a=h[0][0],this.b=h[1][0],this.c=h[0][1],this.d=h[1][1],this.e=h[0][2],this.f=h[1][2],this},n.invert=function(){var e=this,n=e.a*e.d-e.b*e.c;return new t(e.d/n,-e.b/n,-e.c/n,e.a/n,(e.c*e.f-e.d*e.e)/n,(e.b*e.e-e.a*e.f)/n)},n.clone=function(){return new t(this.a,this.b,this.c,this.d,this.e,this.f)},n.translate=function(e,t){return this.add(1,0,0,1,e,t)},n.scale=function(e,t,n,i){return null==t&&(t=e),(n||i)&&this.add(1,0,0,1,n,i),this.add(e,0,0,t,0,0),(n||i)&&this.add(1,0,0,1,-n,-i),this},n.rotate=function(t,n,i){t=e.rad(t),n=n||0,i=i||0;var s=+r.cos(t).toFixed(9),a=+r.sin(t).toFixed(9);return this.add(s,a,-a,s,n,i),this.add(1,0,0,1,-n,-i)},n.x=function(e,t){return e*this.a+t*this.c+this.e},n.y=function(e,t){return e*this.b+t*this.d+this.f},n.get=function(e){return+this[i.fromCharCode(97+e)].toFixed(4)},n.toString=function(){return"matrix("+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)].join()+")"},n.offset=function(){return[this.e.toFixed(4),this.f.toFixed(4)]},n.determinant=function(){return this.a*this.d-this.b*this.c},n.split=function(){var t={};t.dx=this.e,t.dy=this.f;var n=[[this.a,this.c],[this.b,this.d]];t.scalex=r.sqrt(a(n[0])),o(n[0]),t.shear=n[0][0]*n[1][0]+n[0][1]*n[1][1],n[1]=[n[1][0]-n[0][0]*t.shear,n[1][1]-n[0][1]*t.shear],t.scaley=r.sqrt(a(n[1])),o(n[1]),t.shear/=t.scaley,this.determinant()<0&&(t.scalex=-t.scalex);var i=-n[0][1],s=n[1][1];return s<0?(t.rotate=e.deg(r.acos(s)),i<0&&(t.rotate=360-t.rotate)):t.rotate=e.deg(r.asin(i)),t.isSimple=!(+t.shear.toFixed(9)||t.scalex.toFixed(9)!=t.scaley.toFixed(9)&&t.rotate),t.isSuperSimple=!+t.shear.toFixed(9)&&t.scalex.toFixed(9)==t.scaley.toFixed(9)&&!t.rotate,t.noRotation=!+t.shear.toFixed(9)&&!t.rotate,t},n.toTransformString=function(e){var t=e||this.split();return+t.shear.toFixed(9)?"m"+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)]:(t.scalex=+t.scalex.toFixed(4),t.scaley=+t.scaley.toFixed(4),t.rotate=+t.rotate.toFixed(4),(t.dx||t.dy?"t"+[+t.dx.toFixed(4),+t.dy.toFixed(4)]:s)+(1!=t.scalex||1!=t.scaley?"s"+[t.scalex,t.scaley,0,0]:s)+(t.rotate?"r"+[+t.rotate.toFixed(4),0,0]:s))}}(t.prototype),e.Matrix=t,e.matrix=function(e,n,i,r,s,a){return new t(e,n,i,r,s,a)}}),i.plugin(function(e,n,i,r,s){function a(i){return function(r){if(t.stop(),r instanceof s&&1==r.node.childNodes.length&&("radialGradient"==r.node.firstChild.tagName||"linearGradient"==r.node.firstChild.tagName||"pattern"==r.node.firstChild.tagName)&&(r=r.node.firstChild,f(this).appendChild(r),r=h(r)),r instanceof n)if("radialGradient"==r.type||"linearGradient"==r.type||"pattern"==r.type){r.node.id||g(r.node,{id:r.id});var a=_(r.node.id)}else a=r.attr(i);else if(a=e.color(r),a.error){var o=e(f(this).ownerSVGElement).gradient(r);o?(o.node.id||g(o.node,{id:o.id}),a=_(o.node.id)):a=r}else a=m(a);var l={};l[i]=a,g(this.node,l),this.node.style[i]=v}}function o(e){t.stop(),e==+e&&(e+="px"),this.node.style.fontSize=e}function l(e){for(var t=[],n=e.childNodes,i=0,r=n.length;i<r;i++){var s=n[i];3==s.nodeType&&t.push(s.nodeValue),"tspan"==s.tagName&&(1==s.childNodes.length&&3==s.firstChild.nodeType?t.push(s.firstChild.nodeValue):t.push(l(s)))}return t}function d(){return t.stop(),this.node.style.fontSize}var c=e._.make,h=e._.wrap,u=e.is,f=e._.getSomeDefs,p=/^url\(#?([^)]+)\)$/,g=e._.$,_=e.url,m=String,y=e._.separator,v="";t.on("snap.util.attr.mask",function(e){if(e instanceof n||e instanceof s){if(t.stop(),e instanceof s&&1==e.node.childNodes.length&&(e=e.node.firstChild,f(this).appendChild(e),e=h(e)),"mask"==e.type)var i=e;else i=c("mask",f(this)),i.node.appendChild(e.node);!i.node.id&&g(i.node,{id:i.id}),g(this.node,{mask:_(i.id)})}}),function(e){t.on("snap.util.attr.clip",e),t.on("snap.util.attr.clip-path",e),t.on("snap.util.attr.clipPath",e)}(function(e){if(e instanceof n||e instanceof s){if(t.stop(),"clipPath"==e.type)var i=e;else i=c("clipPath",f(this)),i.node.appendChild(e.node),!i.node.id&&g(i.node,{id:i.id});g(this.node,{"clip-path":_(i.node.id||i.id)})}}),t.on("snap.util.attr.fill",a("fill")),t.on("snap.util.attr.stroke",a("stroke"));var x=/^([lr])(?:\(([^)]*)\))?(.*)$/i;t.on("snap.util.grad.parse",function(e){e=m(e);var t=e.match(x);if(!t)return null;var n=t[1],i=t[2],r=t[3];return i=i.split(/\s*,\s*/).map(function(e){return+e==e?+e:e}),1==i.length&&0==i[0]&&(i=[]),r=r.split("-"),r=r.map(function(e){e=e.split(":");var t={color:e[0]};return e[1]&&(t.offset=parseFloat(e[1])),t}),{type:n,params:i,stops:r}}),t.on("snap.util.attr.d",function(n){t.stop(),u(n,"array")&&u(n[0],"array")&&(n=e.path.toString.call(n)),n=m(n),n.match(/[ruo]/i)&&(n=e.path.toAbsolute(n)),g(this.node,{d:n})})(-1),t.on("snap.util.attr.#text",function(e){t.stop(),e=m(e);for(var n=r.doc.createTextNode(e);this.node.firstChild;)this.node.removeChild(this.node.firstChild);this.node.appendChild(n)})(-1),t.on("snap.util.attr.path",function(e){t.stop(),this.attr({d:e})})(-1),t.on("snap.util.attr.class",function(e){t.stop(),this.node.className.baseVal=e})(-1),t.on("snap.util.attr.viewBox",function(e){var n;n=u(e,"object")&&"x"in e?[e.x,e.y,e.width,e.height].join(" "):u(e,"array")?e.join(" "):e,g(this.node,{viewBox:n}),t.stop()})(-1),t.on("snap.util.attr.transform",function(e){this.transform(e),t.stop()})(-1),t.on("snap.util.attr.r",function(e){"rect"==this.type&&(t.stop(),g(this.node,{rx:e,ry:e}))})(-1),t.on("snap.util.attr.textpath",function(e){if(t.stop(),"text"==this.type){var i,r,s;if(!e&&this.textPath){for(r=this.textPath;r.node.firstChild;)this.node.appendChild(r.node.firstChild);return r.remove(),void delete this.textPath}if(u(e,"string")){var a=f(this),o=h(a.parentNode).path(e);a.appendChild(o.node),i=o.id,o.attr({id:i})}else e=h(e),e instanceof n&&(i=e.attr("id"),i||(i=e.id,e.attr({id:i})));if(i)if(r=this.textPath,s=this.node,r)r.attr({"xlink:href":"#"+i});else{for(r=g("textPath",{"xlink:href":"#"+i});s.firstChild;)r.appendChild(s.firstChild);s.appendChild(r),this.textPath=h(r)}}})(-1),t.on("snap.util.attr.text",function(e){if("text"==this.type){for(var n=this.node,i=function(e){var t=g("tspan");if(u(e,"array"))for(var n=0;n<e.length;n++)t.appendChild(i(e[n]));else t.appendChild(r.doc.createTextNode(e));return t.normalize&&t.normalize(),t};n.firstChild;)n.removeChild(n.firstChild);for(var s=i(e);s.firstChild;)n.appendChild(s.firstChild)}t.stop()})(-1),t.on("snap.util.attr.fontSize",o)(-1),t.on("snap.util.attr.font-size",o)(-1),t.on("snap.util.getattr.transform",function(){return t.stop(),this.transform()})(-1),t.on("snap.util.getattr.textpath",function(){return t.stop(),this.textPath})(-1),function(){function n(n){return function(){t.stop();var i=r.doc.defaultView.getComputedStyle(this.node,null).getPropertyValue("marker-"+n);return"none"==i?i:e(r.doc.getElementById(i.match(p)[1]))}}function i(e){return function(n){t.stop();var i="marker"+e.charAt(0).toUpperCase()+e.substring(1);if(""==n||!n)return void(this.node.style[i]="none");if("marker"==n.type){var r=n.node.id;return r||g(n.node,{id:n.id}),void(this.node.style[i]=_(r))}}}t.on("snap.util.getattr.marker-end",n("end"))(-1),t.on("snap.util.getattr.markerEnd",n("end"))(-1),t.on("snap.util.getattr.marker-start",n("start"))(-1),t.on("snap.util.getattr.markerStart",n("start"))(-1),t.on("snap.util.getattr.marker-mid",n("mid"))(-1),t.on("snap.util.getattr.markerMid",n("mid"))(-1),t.on("snap.util.attr.marker-end",i("end"))(-1),t.on("snap.util.attr.markerEnd",i("end"))(-1),t.on("snap.util.attr.marker-start",i("start"))(-1),t.on("snap.util.attr.markerStart",i("start"))(-1),t.on("snap.util.attr.marker-mid",i("mid"))(-1),t.on("snap.util.attr.markerMid",i("mid"))(-1)}(),t.on("snap.util.getattr.r",function(){if("rect"==this.type&&g(this.node,"rx")==g(this.node,"ry"))return t.stop(),g(this.node,"rx")})(-1),t.on("snap.util.getattr.text",function(){if("text"==this.type||"tspan"==this.type){t.stop();var e=l(this.node);return 1==e.length?e[0]:e}})(-1),t.on("snap.util.getattr.#text",function(){return this.node.textContent})(-1),t.on("snap.util.getattr.viewBox",function(){t.stop();var n=g(this.node,"viewBox");return n?(n=n.split(y),e._.box(+n[0],+n[1],+n[2],+n[3])):void 0})(-1),t.on("snap.util.getattr.points",function(){var e=g(this.node,"points");return t.stop(),e?e.split(y):void 0})(-1),t.on("snap.util.getattr.path",function(){var e=g(this.node,"d");return t.stop(),e})(-1),t.on("snap.util.getattr.class",function(){return this.node.className.baseVal})(-1),t.on("snap.util.getattr.fontSize",d)(-1),t.on("snap.util.getattr.font-size",d)(-1)}),i.plugin(function(e,t){var n=/\S+/g,i=String,r=t.prototype;r.addClass=function(e){var t,r,s,a,o=i(e||"").match(n)||[],l=this.node,d=l.className.baseVal,c=d.match(n)||[];if(o.length){for(t=0;s=o[t++];)r=c.indexOf(s),~r||c.push(s);a=c.join(" "),d!=a&&(l.className.baseVal=a)}return this},r.removeClass=function(e){var t,r,s,a,o=i(e||"").match(n)||[],l=this.node,d=l.className.baseVal,c=d.match(n)||[];if(c.length){for(t=0;s=o[t++];)r=c.indexOf(s),~r&&c.splice(r,1);a=c.join(" "),d!=a&&(l.className.baseVal=a)}return this},r.hasClass=function(e){var t=this.node,i=t.className.baseVal,r=i.match(n)||[];return!!~r.indexOf(e)},r.toggleClass=function(e,t){if(null!=t)return t?this.addClass(e):this.removeClass(e);var i,r,s,a,o=(e||"").match(n)||[],l=this.node,d=l.className.baseVal,c=d.match(n)||[];for(i=0;s=o[i++];)r=c.indexOf(s),~r?c.splice(r,1):c.push(s);return a=c.join(" "),d!=a&&(l.className.baseVal=a),this}}),i.plugin(function(){function e(e){return e}function n(e){return function(t){return+t.toFixed(3)+e}}var i={"+":function(e,t){return e+t},"-":function(e,t){return e-t},"/":function(e,t){return e/t},"*":function(e,t){return e*t}},r=String,s=/[a-z]+$/i,a=/^\s*([+\-\/*])\s*=\s*([\d.eE+\-]+)\s*([^\d\s]+)?\s*$/;t.on("snap.util.attr",function(e){var n=r(e).match(a);if(n){var o=t.nt(),l=o.substring(o.lastIndexOf(".")+1),d=this.attr(l),c={};t.stop();var h=n[3]||"",u=d.match(s),f=i[n[1]];if(u&&u==h?e=f(parseFloat(d),+n[2]):(d=this.asPX(l),e=f(this.asPX(l),this.asPX(l,n[2]+h))),isNaN(d)||isNaN(e))return;c[l]=e,this.attr(c)}})(-10),t.on("snap.util.equal",function(o,l){var d=r(this.attr(o)||""),c=r(l).match(a);if(c){t.stop();var h=c[3]||"",u=d.match(s),f=i[c[1]];return u&&u==h?{from:parseFloat(d),to:f(parseFloat(d),+c[2]),f:n(u)}:(d=this.asPX(o),{from:d,to:f(d,this.asPX(o,c[2]+h)),f:e})}})(-10)}),i.plugin(function(n,i,r,s){var a=r.prototype,o=n.is;a.rect=function(e,t,n,i,r,s){var a;return null==s&&(s=r),o(e,"object")&&"[object Object]"==e?a=e:null!=e&&(a={x:e,y:t,width:n,height:i},null!=r&&(a.rx=r,a.ry=s)),this.el("rect",a)},a.circle=function(e,t,n){var i;return o(e,"object")&&"[object Object]"==e?i=e:null!=e&&(i={cx:e,cy:t,r:n}),this.el("circle",i)};var l=function(){function e(){this.parentNode.removeChild(this)}return function(t,n){var i=s.doc.createElement("img"),r=s.doc.body;i.style.cssText="position:absolute;left:-9999em;top:-9999em",i.onload=function(){n.call(i),i.onload=i.onerror=null,r.removeChild(i)},i.onerror=e,r.appendChild(i),i.src=t}}();a.image=function(e,t,i,r,s){var a=this.el("image");if(o(e,"object")&&"src"in e)a.attr(e);else if(null!=e){var d={"xlink:href":e,preserveAspectRatio:"none"};null!=t&&null!=i&&(d.x=t,d.y=i),null!=r&&null!=s?(d.width=r,d.height=s):l(e,function(){n._.$(a.node,{width:this.offsetWidth,height:this.offsetHeight})}),n._.$(a.node,d)}return a},a.ellipse=function(e,t,n,i){var r;return o(e,"object")&&"[object Object]"==e?r=e:null!=e&&(r={cx:e,cy:t,rx:n,ry:i}),this.el("ellipse",r)},a.path=function(e){var t;return o(e,"object")&&!o(e,"array")?t=e:e&&(t={d:e}),this.el("path",t)},a.group=a.g=function(e){var t=this.el("g");return 1==arguments.length&&e&&!e.type?t.attr(e):arguments.length&&t.add(Array.prototype.slice.call(arguments,0)),t},a.svg=function(e,t,n,i,r,s,a,l){var d={};return o(e,"object")&&null==t?d=e:(null!=e&&(d.x=e),null!=t&&(d.y=t),null!=n&&(d.width=n),null!=i&&(d.height=i),null!=r&&null!=s&&null!=a&&null!=l&&(d.viewBox=[r,s,a,l])),this.el("svg",d)},a.mask=function(e){var t=this.el("mask");return 1==arguments.length&&e&&!e.type?t.attr(e):arguments.length&&t.add(Array.prototype.slice.call(arguments,0)),t},a.ptrn=function(e,t,n,i,r,s,a,l){if(o(e,"object"))var d=e;else d={patternUnits:"userSpaceOnUse"},e&&(d.x=e),t&&(d.y=t),null!=n&&(d.width=n),null!=i&&(d.height=i),null!=r&&null!=s&&null!=a&&null!=l?d.viewBox=[r,s,a,l]:d.viewBox=[e||0,t||0,n||0,i||0];return this.el("pattern",d)},a.use=function(e){return null!=e?(e instanceof i&&(e.attr("id")||e.attr({id:n._.id(e)}),e=e.attr("id")),"#"==String(e).charAt()&&(e=e.substring(1)),this.el("use",{"xlink:href":"#"+e})):i.prototype.use.call(this)},a.symbol=function(e,t,n,i){var r={};return null!=e&&null!=t&&null!=n&&null!=i&&(r.viewBox=[e,t,n,i]),this.el("symbol",r)},a.text=function(e,t,n){var i={};return o(e,"object")?i=e:null!=e&&(i={x:e,y:t,text:n||""}),this.el("text",i)},a.line=function(e,t,n,i){var r={};return o(e,"object")?r=e:null!=e&&(r={x1:e,x2:n,y1:t,y2:i}),this.el("line",r)},a.polyline=function(e){arguments.length>1&&(e=Array.prototype.slice.call(arguments,0));var t={};return o(e,"object")&&!o(e,"array")?t=e:null!=e&&(t={points:e}),this.el("polyline",t)},a.polygon=function(e){arguments.length>1&&(e=Array.prototype.slice.call(arguments,0));var t={};return o(e,"object")&&!o(e,"array")?t=e:null!=e&&(t={points:e}),this.el("polygon",t)},function(){function i(){return this.selectAll("stop")}function r(e,t){var i=c("stop"),r={offset:+t+"%"};return e=n.color(e),r["stop-color"]=e.hex,e.opacity<1&&(r["stop-opacity"]=e.opacity),c(i,r),this.node.appendChild(i),this}function s(){if("linearGradient"==this.type){var e=c(this.node,"x1")||0,t=c(this.node,"x2")||1,i=c(this.node,"y1")||0,r=c(this.node,"y2")||0;return n._.box(e,i,math.abs(t-e),math.abs(r-i))}var s=this.node.cx||.5,a=this.node.cy||.5,o=this.node.r||0;return n._.box(s-o,a-o,2*o,2*o)}function o(e,n){function i(e,t){for(var n=(t-h)/(e-u),i=u;i<e;i++)a[i].offset=+(+h+n*(i-u)).toFixed(2);u=e,h=t}var r,s=t("snap.util.grad.parse",null,n).firstDefined();if(!s)return null;s.params.unshift(e),r="l"==s.type.toLowerCase()?l.apply(0,s.params):d.apply(0,s.params),s.type!=s.type.toLowerCase()&&c(r.node,{gradientUnits:"userSpaceOnUse"});var a=s.stops,o=a.length,h=0,u=0;o--;for(var f=0;f<o;f++)"offset"in a[f]&&i(f,a[f].offset);for(a[o].offset=a[o].offset||100,i(o,a[o].offset),f=0;f<=o;f++){var p=a[f];r.addStop(p.color,p.offset)}return r}function l(e,t,a,o,l){var d=n._.make("linearGradient",e);return d.stops=i,d.addStop=r,d.getBBox=s,null!=t&&c(d.node,{x1:t,y1:a,x2:o,y2:l}),d}function d(e,t,a,o,l,d){var h=n._.make("radialGradient",e);return h.stops=i,h.addStop=r,h.getBBox=s,null!=t&&c(h.node,{cx:t,cy:a,r:o}),null!=l&&null!=d&&c(h.node,{fx:l,fy:d}),h}var c=n._.$;a.gradient=function(e){return o(this.defs,e)},a.gradientLinear=function(e,t,n,i){return l(this.defs,e,t,n,i)},a.gradientRadial=function(e,t,n,i,r){return d(this.defs,e,t,n,i,r)},a.toString=function(){var e,t=this.node.ownerDocument,i=t.createDocumentFragment(),r=t.createElement("div"),s=this.node.cloneNode(!0);return i.appendChild(r),r.appendChild(s),n._.$(s,{xmlns:"http://www.w3.org/2000/svg"}),e=r.innerHTML,i.removeChild(i.firstChild),e},a.toDataURL=function(){if(e&&e.btoa)return"data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(this)))},a.clear=function(){for(var e,t=this.node.firstChild;t;)e=t.nextSibling,"defs"!=t.tagName?t.parentNode.removeChild(t):a.clear.call({node:t}),t=e}}()}),i.plugin(function(e,t){function n(e){var t=n.ps=n.ps||{};return t[e]?t[e].sleep=100:t[e]={sleep:100},setTimeout(function(){for(var n in t)t[B](n)&&n!=e&&(t[n].sleep--,!t[n].sleep&&delete t[n])}),t[e]}function i(e,t,n,i){return null==e&&(e=t=n=i=0),null==t&&(t=e.y,n=e.width,i=e.height,e=e.x),{x:e,y:t,width:n,w:n,height:i,h:i,x2:e+n,y2:t+i,cx:e+n/2,cy:t+i/2,r1:D.min(n,i)/2,r2:D.max(n,i)/2,r0:D.sqrt(n*n+i*i)/2,path:k(e,t,n,i),vb:[e,t,n,i].join(" ")}}function r(){return this.join(",").replace(M,"$1")}function s(e){var t=E(e);return t.toString=r,t}function a(e,t,n,i,r,s,a,o,d){return null==d?f(e,t,n,i,r,s,a,o):l(e,t,n,i,r,s,a,o,p(e,t,n,i,r,s,a,o,d))}function o(n,i){function r(e){return+(+e).toFixed(3)}return e._.cacher(function(e,s,o){e instanceof t&&(e=e.attr("d")),e=N(e);for(var d,c,h,u,f,p="",g={},_=0,m=0,y=e.length;m<y;m++){if(h=e[m],"M"==h[0])d=+h[1],c=+h[2];else{if(u=a(d,c,h[1],h[2],h[3],h[4],h[5],h[6]),_+u>s){if(i&&!g.start){if(f=a(d,c,h[1],h[2],h[3],h[4],h[5],h[6],s-_),p+=["C"+r(f.start.x),r(f.start.y),r(f.m.x),r(f.m.y),r(f.x),r(f.y)],o)return p;g.start=p,p=["M"+r(f.x),r(f.y)+"C"+r(f.n.x),r(f.n.y),r(f.end.x),r(f.end.y),r(h[5]),r(h[6])].join(),_+=u,d=+h[5],c=+h[6];continue}if(!n&&!i)return f=a(d,c,h[1],h[2],h[3],h[4],h[5],h[6],s-_)}_+=u,d=+h[5],c=+h[6]}p+=h.shift()+h}return g.end=p,f=n?_:i?g:l(d,c,h[0],h[1],h[2],h[3],h[4],h[5],1)},null,e._.clone)}function l(e,t,n,i,r,s,a,o,l){var d=1-l,c=H(d,3),h=H(d,2),u=l*l,f=u*l,p=c*e+3*h*l*n+3*d*l*l*r+f*a,g=c*t+3*h*l*i+3*d*l*l*s+f*o,_=e+2*l*(n-e)+u*(r-2*n+e),m=t+2*l*(i-t)+u*(s-2*i+t),y=n+2*l*(r-n)+u*(a-2*r+n),v=i+2*l*(s-i)+u*(o-2*s+i),x=d*e+l*n,b=d*t+l*i,k=d*r+l*a,j=d*s+l*o,w=90-180*D.atan2(_-y,m-v)/G;return{x:p,y:g,m:{x:_,y:m},n:{x:y,y:v},start:{x:x,y:b},end:{x:k,y:j},alpha:w}}function d(t,n,r,s,a,o,l,d){e.is(t,"array")||(t=[t,n,r,s,a,o,l,d]);var c=O.apply(null,t);return i(c.min.x,c.min.y,c.max.x-c.min.x,c.max.y-c.min.y)}function c(e,t,n){return t>=e.x&&t<=e.x+e.width&&n>=e.y&&n<=e.y+e.height}function h(e,t){return e=i(e),t=i(t),c(t,e.x,e.y)||c(t,e.x2,e.y)||c(t,e.x,e.y2)||c(t,e.x2,e.y2)||c(e,t.x,t.y)||c(e,t.x2,t.y)||c(e,t.x,t.y2)||c(e,t.x2,t.y2)||(e.x<t.x2&&e.x>t.x||t.x<e.x2&&t.x>e.x)&&(e.y<t.y2&&e.y>t.y||t.y<e.y2&&t.y>e.y)}function u(e,t,n,i,r){var s=-3*t+9*n-9*i+3*r,a=e*s+6*t-12*n+6*i;return e*a-3*t+3*n}function f(e,t,n,i,r,s,a,o,l){null==l&&(l=1),l=l>1?1:l<0?0:l;for(var d=l/2,c=12,h=[-.1252,.1252,-.3678,.3678,-.5873,.5873,-.7699,.7699,-.9041,.9041,-.9816,.9816],f=[.2491,.2491,.2335,.2335,.2032,.2032,.1601,.1601,.1069,.1069,.0472,.0472],p=0,g=0;g<c;g++){var _=d*h[g]+d,m=u(_,e,n,r,a),y=u(_,t,i,s,o),v=m*m+y*y;p+=f[g]*D.sqrt(v)}return d*p}function p(e,t,n,i,r,s,a,o,l){if(!(l<0||f(e,t,n,i,r,s,a,o)<l)){var d,c=1,h=c/2,u=c-h,p=.01;for(d=f(e,t,n,i,r,s,a,o,u);K(d-l)>p;)h/=2,u+=(d<l?1:-1)*h,d=f(e,t,n,i,r,s,a,o,u);return u}}function g(e,t,n,i,r,s,a,o){if(!(z(e,n)<R(r,a)||R(e,n)>z(r,a)||z(t,i)<R(s,o)||R(t,i)>z(s,o))){var l=(e*i-t*n)*(r-a)-(e-n)*(r*o-s*a),d=(e*i-t*n)*(s-o)-(t-i)*(r*o-s*a),c=(e-n)*(s-o)-(t-i)*(r-a);if(c){var h=l/c,u=d/c,f=+h.toFixed(2),p=+u.toFixed(2);if(!(f<+R(e,n).toFixed(2)||f>+z(e,n).toFixed(2)||f<+R(r,a).toFixed(2)||f>+z(r,a).toFixed(2)||p<+R(t,i).toFixed(2)||p>+z(t,i).toFixed(2)||p<+R(s,o).toFixed(2)||p>+z(s,o).toFixed(2)))return{x:h,y:u}}}}function _(e,t,n){var i=d(e),r=d(t);if(!h(i,r))return n?0:[];for(var s=f.apply(0,e),a=f.apply(0,t),o=~~(s/8),c=~~(a/8),u=[],p=[],_={},m=n?0:[],y=0;y<o+1;y++){var v=l.apply(0,e.concat(y/o));u.push({x:v.x,y:v.y,t:y/o})}for(y=0;y<c+1;y++)v=l.apply(0,t.concat(y/c)),p.push({x:v.x,y:v.y,t:y/c});for(y=0;y<o;y++)for(var x=0;x<c;x++){var b=u[y],k=u[y+1],j=p[x],w=p[x+1],C=K(k.x-b.x)<.001?"y":"x",S=K(w.x-j.x)<.001?"y":"x",A=g(b.x,b.y,k.x,k.y,j.x,j.y,w.x,w.y);if(A){if(_[A.x.toFixed(4)]==A.y.toFixed(4))continue;_[A.x.toFixed(4)]=A.y.toFixed(4);var T=b.t+K((A[C]-b[C])/(k[C]-b[C]))*(k.t-b.t),O=j.t+K((A[S]-j[S])/(w[S]-j[S]))*(w.t-j.t);T>=0&&T<=1&&O>=0&&O<=1&&(n?m++:m.push({x:A.x,y:A.y,t1:T,t2:O}))}}return m}function m(e,t){return v(e,t)}function y(e,t){return v(e,t,1)}function v(e,t,n){e=N(e),t=N(t);for(var i,r,s,a,o,l,d,c,h,u,f=n?0:[],p=0,g=e.length;p<g;p++){var m=e[p];if("M"==m[0])i=o=m[1],r=l=m[2];else{"C"==m[0]?(h=[i,r].concat(m.slice(1)),i=h[6],r=h[7]):(h=[i,r,i,r,o,l,o,l],i=o,r=l);for(var y=0,v=t.length;y<v;y++){var x=t[y];if("M"==x[0])s=d=x[1],a=c=x[2];else{"C"==x[0]?(u=[s,a].concat(x.slice(1)),s=u[6],a=u[7]):(u=[s,a,s,a,d,c,d,c],s=d,a=c);var b=_(h,u,n);if(n)f+=b;else{for(var k=0,j=b.length;k<j;k++)b[k].segment1=p,b[k].segment2=y,b[k].bez1=h,b[k].bez2=u;f=f.concat(b)}}}}}return f}function x(e,t,n){var i=b(e);return c(i,t,n)&&v(e,[["M",t,n],["H",i.x2+10]],1)%2==1}function b(e){var t=n(e);if(t.bbox)return E(t.bbox);if(!e)return i();e=N(e);for(var r,s=0,a=0,o=[],l=[],d=0,c=e.length;d<c;d++)if(r=e[d],"M"==r[0])s=r[1],a=r[2],o.push(s),l.push(a);else{var h=O(s,a,r[1],r[2],r[3],r[4],r[5],r[6]);o=o.concat(h.min.x,h.max.x),l=l.concat(h.min.y,h.max.y),s=r[5],a=r[6]}var u=R.apply(0,o),f=R.apply(0,l),p=z.apply(0,o),g=z.apply(0,l),_=i(u,f,p-u,g-f);return t.bbox=E(_),_}function k(e,t,n,i,s){if(s)return[["M",+e+ +s,t],["l",n-2*s,0],["a",s,s,0,0,1,s,s],["l",0,i-2*s],["a",s,s,0,0,1,-s,s],["l",2*s-n,0],["a",s,s,0,0,1,-s,-s],["l",0,2*s-i],["a",s,s,0,0,1,s,-s],["z"]];var a=[["M",e,t],["l",n,0],["l",0,i],["l",-n,0],["z"]];return a.toString=r,a}function j(e,t,n,i,s){if(null==s&&null==i&&(i=n),e=+e,t=+t,n=+n,i=+i,null!=s)var a=Math.PI/180,o=e+n*Math.cos(-i*a),l=e+n*Math.cos(-s*a),d=t+n*Math.sin(-i*a),c=t+n*Math.sin(-s*a),h=[["M",o,d],["A",n,n,0,+(s-i>180),0,l,c]];else h=[["M",e,t],["m",0,-i],["a",n,i,0,1,1,0,2*i],["a",n,i,0,1,1,0,-2*i],["z"]];return h.toString=r,h}function w(t){var i=n(t),a=String.prototype.toLowerCase;if(i.rel)return s(i.rel);e.is(t,"array")&&e.is(t&&t[0],"array")||(t=e.parsePathString(t));var o=[],l=0,d=0,c=0,h=0,u=0;"M"==t[0][0]&&(l=t[0][1],d=t[0][2],c=l,h=d,u++,o.push(["M",l,d]));for(var f=u,p=t.length;f<p;f++){var g=o[f]=[],_=t[f];if(_[0]!=a.call(_[0]))switch(g[0]=a.call(_[0]),g[0]){case"a":g[1]=_[1],g[2]=_[2],g[3]=_[3],g[4]=_[4],g[5]=_[5],g[6]=+(_[6]-l).toFixed(3),g[7]=+(_[7]-d).toFixed(3);break;case"v":g[1]=+(_[1]-d).toFixed(3);break;case"m":c=_[1],h=_[2];default:for(var m=1,y=_.length;m<y;m++)g[m]=+(_[m]-(m%2?l:d)).toFixed(3)}else{g=o[f]=[],"m"==_[0]&&(c=_[1]+l,h=_[2]+d);for(var v=0,x=_.length;v<x;v++)o[f][v]=_[v]}var b=o[f].length;switch(o[f][0]){case"z":l=c,d=h;break;case"h":l+=+o[f][b-1];break;case"v":d+=+o[f][b-1];break;default:l+=+o[f][b-2],d+=+o[f][b-1]}}return o.toString=r,i.rel=s(o),o}function C(t){var i=n(t);if(i.abs)return s(i.abs);if(P(t,"array")&&P(t&&t[0],"array")||(t=e.parsePathString(t)),!t||!t.length)return[["M",0,0]];var a,o=[],l=0,d=0,c=0,h=0,u=0;"M"==t[0][0]&&(l=+t[0][1],d=+t[0][2],c=l,h=d,u++,o[0]=["M",l,d]);for(var f,p,g=3==t.length&&"M"==t[0][0]&&"R"==t[1][0].toUpperCase()&&"Z"==t[2][0].toUpperCase(),_=u,m=t.length;_<m;_++){if(o.push(f=[]),p=t[_],a=p[0],a!=a.toUpperCase())switch(f[0]=a.toUpperCase(),f[0]){case"A":f[1]=p[1],f[2]=p[2],f[3]=p[3],f[4]=p[4],f[5]=p[5],f[6]=+p[6]+l,f[7]=+p[7]+d;break;case"V":f[1]=+p[1]+d;break;case"H":f[1]=+p[1]+l;break;case"R":for(var y=[l,d].concat(p.slice(1)),v=2,x=y.length;v<x;v++)y[v]=+y[v]+l,y[++v]=+y[v]+d;o.pop(),o=o.concat(F(y,g));break;case"O":o.pop(),y=j(l,d,p[1],p[2]),y.push(y[0]),o=o.concat(y);break;case"U":o.pop(),o=o.concat(j(l,d,p[1],p[2],p[3])),f=["U"].concat(o[o.length-1].slice(-2));break;case"M":c=+p[1]+l,h=+p[2]+d;default:for(v=1,x=p.length;v<x;v++)f[v]=+p[v]+(v%2?l:d)}else if("R"==a)y=[l,d].concat(p.slice(1)),o.pop(),o=o.concat(F(y,g)),f=["R"].concat(p.slice(-2));else if("O"==a)o.pop(),y=j(l,d,p[1],p[2]),y.push(y[0]),o=o.concat(y);else if("U"==a)o.pop(),o=o.concat(j(l,d,p[1],p[2],p[3])),f=["U"].concat(o[o.length-1].slice(-2));else for(var b=0,k=p.length;b<k;b++)f[b]=p[b];if(a=a.toUpperCase(),"O"!=a)switch(f[0]){case"Z":l=+c,d=+h;break;case"H":l=f[1];break;case"V":d=f[1];break;case"M":c=f[f.length-2],h=f[f.length-1];default:l=f[f.length-2],d=f[f.length-1]}}return o.toString=r,i.abs=s(o),o}function S(e,t,n,i){return[e,t,n,i,n,i]}function A(e,t,n,i,r,s){var a=1/3,o=2/3;return[a*e+o*n,a*t+o*i,a*r+o*n,a*s+o*i,r,s]}function T(t,n,i,r,s,a,o,l,d,c){var h,u=120*G/180,f=G/180*(+s||0),p=[],g=e._.cacher(function(e,t,n){var i=e*D.cos(n)-t*D.sin(n),r=e*D.sin(n)+t*D.cos(n);return{x:i,y:r}});if(c)w=c[0],C=c[1],k=c[2],j=c[3];else{h=g(t,n,-f),t=h.x,n=h.y,h=g(l,d,-f),l=h.x,d=h.y;var _=(D.cos(G/180*s),D.sin(G/180*s),(t-l)/2),m=(n-d)/2,y=_*_/(i*i)+m*m/(r*r);y>1&&(y=D.sqrt(y),i=y*i,r=y*r);var v=i*i,x=r*r,b=(a==o?-1:1)*D.sqrt(K((v*x-v*m*m-x*_*_)/(v*m*m+x*_*_))),k=b*i*m/r+(t+l)/2,j=b*-r*_/i+(n+d)/2,w=D.asin(((n-j)/r).toFixed(9)),C=D.asin(((d-j)/r).toFixed(9));w=t<k?G-w:w,C=l<k?G-C:C,w<0&&(w=2*G+w),C<0&&(C=2*G+C),o&&w>C&&(w-=2*G),!o&&C>w&&(C-=2*G)}var S=C-w;if(K(S)>u){var A=C,O=l,N=d;C=w+u*(o&&C>w?1:-1),l=k+i*D.cos(C),d=j+r*D.sin(C),p=T(l,d,i,r,s,0,o,O,N,[C,A,k,j])}S=C-w;var q=D.cos(w),F=D.sin(w),L=D.cos(C),P=D.sin(C),E=D.tan(S/4),B=4/3*i*E,M=4/3*r*E,I=[t,n],R=[t+B*F,n-M*q],z=[l+B*P,d-M*L],H=[l,d];if(R[0]=2*I[0]-R[0],R[1]=2*I[1]-R[1],c)return[R,z,H].concat(p);p=[R,z,H].concat(p).join().split(",");for(var $=[],V=0,X=p.length;V<X;V++)$[V]=V%2?g(p[V-1],p[V],f).y:g(p[V],p[V+1],f).x;return $}function O(e,t,n,i,r,s,a,o){for(var l,d,c,h,u,f,p,g,_=[],m=[[],[]],y=0;y<2;++y)if(0==y?(d=6*e-12*n+6*r,l=-3*e+9*n-9*r+3*a,c=3*n-3*e):(d=6*t-12*i+6*s,l=-3*t+9*i-9*s+3*o,c=3*i-3*t),K(l)<1e-12){if(K(d)<1e-12)continue;h=-c/d,0<h&&h<1&&_.push(h)}else p=d*d-4*c*l,g=D.sqrt(p),p<0||(u=(-d+g)/(2*l),0<u&&u<1&&_.push(u),f=(-d-g)/(2*l),0<f&&f<1&&_.push(f));for(var v,x=_.length,b=x;x--;)h=_[x],v=1-h,m[0][x]=v*v*v*e+3*v*v*h*n+3*v*h*h*r+h*h*h*a,m[1][x]=v*v*v*t+3*v*v*h*i+3*v*h*h*s+h*h*h*o;return m[0][b]=e,m[1][b]=t,m[0][b+1]=a,m[1][b+1]=o,m[0].length=m[1].length=b+2,{min:{x:R.apply(0,m[0]),y:R.apply(0,m[1])},max:{x:z.apply(0,m[0]),y:z.apply(0,m[1])}}}function N(e,t){var i=!t&&n(e);if(!t&&i.curve)return s(i.curve);for(var r=C(e),a=t&&C(t),o={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},l={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},d=(function(e,t,n){var i,r;if(!e)return["C",t.x,t.y,t.x,t.y,t.x,t.y];switch(!(e[0]in{T:1,Q:1})&&(t.qx=t.qy=null),e[0]){case"M":t.X=e[1],t.Y=e[2];break;case"A":e=["C"].concat(T.apply(0,[t.x,t.y].concat(e.slice(1))));break;case"S":"C"==n||"S"==n?(i=2*t.x-t.bx,r=2*t.y-t.by):(i=t.x,r=t.y),e=["C",i,r].concat(e.slice(1));break;case"T":"Q"==n||"T"==n?(t.qx=2*t.x-t.qx,t.qy=2*t.y-t.qy):(t.qx=t.x,t.qy=t.y),e=["C"].concat(A(t.x,t.y,t.qx,t.qy,e[1],e[2]));break;case"Q":t.qx=e[1],t.qy=e[2],e=["C"].concat(A(t.x,t.y,e[1],e[2],e[3],e[4]));break;case"L":e=["C"].concat(S(t.x,t.y,e[1],e[2]));break;case"H":e=["C"].concat(S(t.x,t.y,e[1],t.y));break;case"V":e=["C"].concat(S(t.x,t.y,t.x,e[1]));break;case"Z":e=["C"].concat(S(t.x,t.y,t.X,t.Y))}return e}),c=function(e,t){if(e[t].length>7){e[t].shift();for(var n=e[t];n.length;)u[t]="A",a&&(f[t]="A"),e.splice(t++,0,["C"].concat(n.splice(0,6)));e.splice(t,1),m=z(r.length,a&&a.length||0)}},h=function(e,t,n,i,s){e&&t&&"M"==e[s][0]&&"M"!=t[s][0]&&(t.splice(s,0,["M",i.x,i.y]),n.bx=0,n.by=0,n.x=e[s][1],n.y=e[s][2],m=z(r.length,a&&a.length||0))},u=[],f=[],p="",g="",_=0,m=z(r.length,a&&a.length||0);_<m;_++){r[_]&&(p=r[_][0]),"C"!=p&&(u[_]=p,_&&(g=u[_-1])),r[_]=d(r[_],o,g),"A"!=u[_]&&"C"==p&&(u[_]="C"),c(r,_),a&&(a[_]&&(p=a[_][0]),"C"!=p&&(f[_]=p,_&&(g=f[_-1])),a[_]=d(a[_],l,g),"A"!=f[_]&&"C"==p&&(f[_]="C"),c(a,_)),h(r,a,o,l,_),h(a,r,l,o,_);var y=r[_],v=a&&a[_],x=y.length,b=a&&v.length;o.x=y[x-2],o.y=y[x-1],o.bx=I(y[x-4])||o.x,o.by=I(y[x-3])||o.y,l.bx=a&&(I(v[b-4])||l.x),l.by=a&&(I(v[b-3])||l.y),l.x=a&&v[b-2],l.y=a&&v[b-1]}return a||(i.curve=s(r)),a?[r,a]:r}function q(e,t){if(!t)return e;var n,i,r,s,a,o,l;for(e=N(e),r=0,a=e.length;r<a;r++)for(l=e[r],s=1,o=l.length;s<o;s+=2)n=t.x(l[s],l[s+1]),i=t.y(l[s],l[s+1]),l[s]=n,l[s+1]=i;return e}function F(e,t){for(var n=[],i=0,r=e.length;r-2*!t>i;i+=2){var s=[{x:+e[i-2],y:+e[i-1]},{x:+e[i],y:+e[i+1]},{x:+e[i+2],y:+e[i+3]},{x:+e[i+4],y:+e[i+5]}];t?i?r-4==i?s[3]={x:+e[0],y:+e[1]}:r-2==i&&(s[2]={x:+e[0],y:+e[1]},s[3]={x:+e[2],y:+e[3]}):s[0]={x:+e[r-2],y:+e[r-1]}:r-4==i?s[3]=s[2]:i||(s[0]={x:+e[i],y:+e[i+1]}),n.push(["C",(-s[0].x+6*s[1].x+s[2].x)/6,(-s[0].y+6*s[1].y+s[2].y)/6,(s[1].x+6*s[2].x-s[3].x)/6,(s[1].y+6*s[2].y-s[3].y)/6,s[2].x,s[2].y])}return n}var L=t.prototype,P=e.is,E=e._.clone,B="hasOwnProperty",M=/,?([a-z]),?/gi,I=parseFloat,D=Math,G=D.PI,R=D.min,z=D.max,H=D.pow,K=D.abs,$=o(1),V=o(),X=o(0,1),U=e._unit2px,Y={path:function(e){return e.attr("path")},circle:function(e){var t=U(e);return j(t.cx,t.cy,t.r)},ellipse:function(e){var t=U(e);return j(t.cx||0,t.cy||0,t.rx,t.ry)},rect:function(e){var t=U(e);return k(t.x||0,t.y||0,t.width,t.height,t.rx,t.ry)},image:function(e){var t=U(e);return k(t.x||0,t.y||0,t.width,t.height)},line:function(e){return"M"+[e.attr("x1")||0,e.attr("y1")||0,e.attr("x2"),e.attr("y2")]},polyline:function(e){return"M"+e.attr("points")},polygon:function(e){return"M"+e.attr("points")+"z"},deflt:function(e){var t=e.node.getBBox();return k(t.x,t.y,t.width,t.height)}};e.path=n,e.path.getTotalLength=$,e.path.getPointAtLength=V,e.path.getSubpath=function(e,t,n){if(this.getTotalLength(e)-n<1e-6)return X(e,t).end;var i=X(e,n,1);return t?X(i,t).end:i},L.getTotalLength=function(){if(this.node.getTotalLength)return this.node.getTotalLength()},L.getPointAtLength=function(e){return V(this.attr("d"),e)},L.getSubpath=function(t,n){return e.path.getSubpath(this.attr("d"),t,n);
},e._.box=i,e.path.findDotsAtSegment=l,e.path.bezierBBox=d,e.path.isPointInsideBBox=c,e.closest=function(t,n,r,s){for(var a=100,o=i(t-a/2,n-a/2,a,a),l=[],d=r[0].hasOwnProperty("x")?function(e){return{x:r[e].x,y:r[e].y}}:function(e){return{x:r[e],y:s[e]}},h=0;a<=1e6&&!h;){for(var u=0,f=r.length;u<f;u++){var p=d(u);if(c(o,p.x,p.y)){h++,l.push(p);break}}h||(a*=2,o=i(t-a/2,n-a/2,a,a))}if(1e6!=a){var g,_=1/0;for(u=0,f=l.length;u<f;u++){var m=e.len(t,n,l[u].x,l[u].y);_>m&&(_=m,l[u].len=m,g=l[u])}return g}},e.path.isBBoxIntersect=h,e.path.intersection=m,e.path.intersectionNumber=y,e.path.isPointInside=x,e.path.getBBox=b,e.path.get=Y,e.path.toRelative=w,e.path.toAbsolute=C,e.path.toCubic=N,e.path.map=q,e.path.toString=r,e.path.clone=s}),i.plugin(function(e){var i=Math.max,r=Math.min,s=function(e){if(this.items=[],this.bindings={},this.length=0,this.type="set",e)for(var t=0,n=e.length;t<n;t++)e[t]&&(this[this.items.length]=this.items[this.items.length]=e[t],this.length++)},a=s.prototype;a.push=function(){for(var e,t,n=0,i=arguments.length;n<i;n++)e=arguments[n],e&&(t=this.items.length,this[t]=this.items[t]=e,this.length++);return this},a.pop=function(){return this.length&&delete this[this.length--],this.items.pop()},a.forEach=function(e,t){for(var n=0,i=this.items.length;n<i;n++)if(e.call(t,this.items[n],n)===!1)return this;return this},a.animate=function(i,r,s,a){"function"!=typeof s||s.length||(a=s,s=n.linear),i instanceof e._.Animation&&(a=i.callback,s=i.easing,r=s.dur,i=i.attr);var o=arguments;if(e.is(i,"array")&&e.is(o[o.length-1],"array"))var l=!0;var d,c=function(){d?this.b=d:d=this.b},h=0,u=this,f=a&&function(){++h==u.length&&a.call(this)};return this.forEach(function(e,n){t.once("snap.animcreated."+e.id,c),l?o[n]&&e.animate.apply(e,o[n]):e.animate(i,r,s,f)})},a.remove=function(){for(;this.length;)this.pop().remove();return this},a.bind=function(e,t,n){var i={};if("function"==typeof t)this.bindings[e]=t;else{var r=n||e;this.bindings[e]=function(e){i[r]=e,t.attr(i)}}return this},a.attr=function(e){var t={};for(var n in e)this.bindings[n]?this.bindings[n](e[n]):t[n]=e[n];for(var i=0,r=this.items.length;i<r;i++)this.items[i].attr(t);return this},a.clear=function(){for(;this.length;)this.pop()},a.splice=function(e,t){e=e<0?i(this.length+e,0):e,t=i(0,r(this.length-e,t));var n,a=[],o=[],l=[];for(n=2;n<arguments.length;n++)l.push(arguments[n]);for(n=0;n<t;n++)o.push(this[e+n]);for(;n<this.length-e;n++)a.push(this[e+n]);var d=l.length;for(n=0;n<d+a.length;n++)this.items[e+n]=this[e+n]=n<d?l[n]:a[n-d];for(n=this.items.length=this.length-=t-d;this[n];)delete this[n++];return new s(o)},a.exclude=function(e){for(var t=0,n=this.length;t<n;t++)if(this[t]==e)return this.splice(t,1),!0;return!1},a.insertAfter=function(e){for(var t=this.items.length;t--;)this.items[t].insertAfter(e);return this},a.getBBox=function(){for(var e=[],t=[],n=[],s=[],a=this.items.length;a--;)if(!this.items[a].removed){var o=this.items[a].getBBox();e.push(o.x),t.push(o.y),n.push(o.x+o.width),s.push(o.y+o.height)}return e=r.apply(0,e),t=r.apply(0,t),n=i.apply(0,n),s=i.apply(0,s),{x:e,y:t,x2:n,y2:s,width:n-e,height:s-t,cx:e+(n-e)/2,cy:t+(s-t)/2}},a.clone=function(e){e=new s;for(var t=0,n=this.items.length;t<n;t++)e.push(this.items[t].clone());return e},a.toString=function(){return"Snap\u2018s set"},a.type="set",e.Set=s,e.set=function(){var e=new s;return arguments.length&&e.push.apply(e,Array.prototype.slice.call(arguments,0)),e}}),i.plugin(function(e,n){function i(e){var t=e[0];switch(t.toLowerCase()){case"t":return[t,0,0];case"m":return[t,1,0,0,1,0,0];case"r":return 4==e.length?[t,0,e[2],e[3]]:[t,0];case"s":return 5==e.length?[t,1,1,e[3],e[4]]:3==e.length?[t,1,1]:[t,1]}}function r(t,n,r){n=g(n).replace(/\.{3}|\u2026/g,t),t=e.parseTransformString(t)||[],n=e.parseTransformString(n)||[];for(var s,a,o,l,h=Math.max(t.length,n.length),u=[],f=[],p=0;p<h;p++){if(o=t[p]||i(n[p]),l=n[p]||i(o),o[0]!=l[0]||"r"==o[0].toLowerCase()&&(o[2]!=l[2]||o[3]!=l[3])||"s"==o[0].toLowerCase()&&(o[3]!=l[3]||o[4]!=l[4])){t=e._.transform2matrix(t,r()),n=e._.transform2matrix(n,r()),u=[["m",t.a,t.b,t.c,t.d,t.e,t.f]],f=[["m",n.a,n.b,n.c,n.d,n.e,n.f]];break}for(u[p]=[],f[p]=[],s=0,a=Math.max(o.length,l.length);s<a;s++)s in o&&(u[p][s]=o[s]),s in l&&(f[p][s]=l[s])}return{from:c(u),to:c(f),f:d(u)}}function s(e){return e}function a(e){return function(t){return+t.toFixed(3)+e}}function o(e){return e.join(" ")}function l(t){return e.rgb(t[0],t[1],t[2])}function d(e){var t,n,i,r,s,a,o=0,l=[];for(t=0,n=e.length;t<n;t++){for(s="[",a=['"'+e[t][0]+'"'],i=1,r=e[t].length;i<r;i++)a[i]="val["+o++ +"]";s+=a+"]",l[t]=s}return Function("val","return Snap.path.toString.call(["+l+"])")}function c(e){for(var t=[],n=0,i=e.length;n<i;n++)for(var r=1,s=e[n].length;r<s;r++)t.push(e[n][r]);return t}function h(e){return isFinite(parseFloat(e))}function u(t,n){return!(!e.is(t,"array")||!e.is(n,"array"))&&t.toString()==n.toString()}var f={},p=/[a-z]+$/i,g=String;f.stroke=f.fill="colour",n.prototype.equal=function(e,n){return t("snap.util.equal",this,e,n).firstDefined()},t.on("snap.util.equal",function(t,n){var i,_,m=g(this.attr(t)||""),y=this;if(h(m)&&h(n))return{from:parseFloat(m),to:parseFloat(n),f:s};if("colour"==f[t])return i=e.color(m),_=e.color(n),{from:[i.r,i.g,i.b,i.opacity],to:[_.r,_.g,_.b,_.opacity],f:l};if("viewBox"==t)return i=this.attr(t).vb.split(" ").map(Number),_=n.split(" ").map(Number),{from:i,to:_,f:o};if("transform"==t||"gradientTransform"==t||"patternTransform"==t)return n instanceof e.Matrix&&(n=n.toTransformString()),e._.rgTransform.test(n)||(n=e._.svgTransform2string(n)),r(m,n,function(){return y.getBBox(1)});if("d"==t||"path"==t)return i=e.path.toCubic(m,n),{from:c(i[0]),to:c(i[1]),f:d(i[0])};if("points"==t)return i=g(m).split(e._.separator),_=g(n).split(e._.separator),{from:i,to:_,f:function(e){return e}};var v=m.match(p),x=g(n).match(p);return v&&u(v,x)?{from:parseFloat(m),to:parseFloat(n),f:a(v)}:{from:this.asPX(t),to:this.asPX(t,n),f:s}})}),i.plugin(function(e,n,i,r){for(var s=n.prototype,a="hasOwnProperty",o=("createTouch"in r.doc),l=["click","dblclick","mousedown","mousemove","mouseout","mouseover","mouseup","touchstart","touchmove","touchend","touchcancel"],d={mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend"},c=(function(e,t){var n="y"==e?"scrollTop":"scrollLeft",i=t&&t.node?t.node.ownerDocument:r.doc;return i[n in i.documentElement?"documentElement":"body"][n]}),h=function(){return this.originalEvent.preventDefault()},u=function(){return this.originalEvent.stopPropagation()},f=function(e,t,n,i){var r=o&&d[t]?d[t]:t,s=function(r){var s=c("y",i),l=c("x",i);if(o&&d[a](t))for(var f=0,p=r.targetTouches&&r.targetTouches.length;f<p;f++)if(r.targetTouches[f].target==e||e.contains(r.targetTouches[f].target)){var g=r;r=r.targetTouches[f],r.originalEvent=g,r.preventDefault=h,r.stopPropagation=u;break}var _=r.clientX+l,m=r.clientY+s;return n.call(i,r,_,m)};return t!==r&&e.addEventListener(t,s,!1),e.addEventListener(r,s,!1),function(){return t!==r&&e.removeEventListener(t,s,!1),e.removeEventListener(r,s,!1),!0}},p=[],g=function(e){for(var n,i=e.clientX,r=e.clientY,s=c("y"),a=c("x"),l=p.length;l--;){if(n=p[l],o){for(var d,h=e.touches&&e.touches.length;h--;)if(d=e.touches[h],d.identifier==n.el._drag.id||n.el.node.contains(d.target)){i=d.clientX,r=d.clientY,(e.originalEvent?e.originalEvent:e).preventDefault();break}}else e.preventDefault();var u=n.el.node;u.nextSibling,u.parentNode,u.style.display;i+=a,r+=s,t("snap.drag.move."+n.el.id,n.move_scope||n.el,i-n.el._drag.x,r-n.el._drag.y,i,r,e)}},_=function(n){e.unmousemove(g).unmouseup(_);for(var i,r=p.length;r--;)i=p[r],i.el._drag={},t("snap.drag.end."+i.el.id,i.end_scope||i.start_scope||i.move_scope||i.el,n),t.off("snap.drag.*."+i.el.id);p=[]},m=l.length;m--;)!function(t){e[t]=s[t]=function(n,i){if(e.is(n,"function"))this.events=this.events||[],this.events.push({name:t,f:n,unbind:f(this.node||document,t,n,i||this)});else for(var r=0,s=this.events.length;r<s;r++)if(this.events[r].name==t)try{this.events[r].f.call(this)}catch(e){}return this},e["un"+t]=s["un"+t]=function(e){for(var n=this.events||[],i=n.length;i--;)if(n[i].name==t&&(n[i].f==e||!e))return n[i].unbind(),n.splice(i,1),!n.length&&delete this.events,this;return this}}(l[m]);s.hover=function(e,t,n,i){return this.mouseover(e,n).mouseout(t,i||n)},s.unhover=function(e,t){return this.unmouseover(e).unmouseout(t)};var y=[];s.drag=function(n,i,r,s,a,o){function l(l,d,h){(l.originalEvent||l).preventDefault(),c._drag.x=d,c._drag.y=h,c._drag.id=l.identifier,!p.length&&e.mousemove(g).mouseup(_),p.push({el:c,move_scope:s,start_scope:a,end_scope:o}),i&&t.on("snap.drag.start."+c.id,i),n&&t.on("snap.drag.move."+c.id,n),r&&t.on("snap.drag.end."+c.id,r),t("snap.drag.start."+c.id,a||s||c,d,h,l)}function d(e,n,i){t("snap.draginit."+c.id,c,e,n,i)}var c=this;if(!arguments.length){var h;return c.drag(function(e,t){this.attr({transform:h+(h?"T":"t")+[e,t]})},function(){h=this.transform().local})}return t.on("snap.draginit."+c.id,l),c._drag={},y.push({el:c,start:l,init:d}),c.mousedown(d),c},s.undrag=function(){for(var n=y.length;n--;)y[n].el==this&&(this.unmousedown(y[n].init),y.splice(n,1),t.unbind("snap.drag.*."+this.id),t.unbind("snap.draginit."+this.id));return!y.length&&e.unmousemove(g).unmouseup(_),this}}),i.plugin(function(e,n,i){var r=(n.prototype,i.prototype),s=/^\s*url\((.+)\)/,a=String,o=e._.$;e.filter={},r.filter=function(t){var i=this;"svg"!=i.type&&(i=i.paper);var r=e.parse(a(t)),s=e._.id(),l=(i.node.offsetWidth,i.node.offsetHeight,o("filter"));return o(l,{id:s,filterUnits:"userSpaceOnUse"}),l.appendChild(r.node),i.defs.appendChild(l),new n(l)},t.on("snap.util.getattr.filter",function(){t.stop();var n=o(this.node,"filter");if(n){var i=a(n).match(s);return i&&e.select(i[1])}}),t.on("snap.util.attr.filter",function(i){if(i instanceof n&&"filter"==i.type){t.stop();var r=i.node.id;r||(o(i.node,{id:i.id}),r=i.id),o(this.node,{filter:e.url(r)})}i&&"none"!=i||(t.stop(),this.node.removeAttribute("filter"))}),e.filter.blur=function(t,n){null==t&&(t=2);var i=null==n?t:[t,n];return e.format('<feGaussianBlur stdDeviation="{def}"/>',{def:i})},e.filter.blur.toString=function(){return this()},e.filter.shadow=function(t,n,i,r,s){return"string"==typeof i&&(r=i,s=r,i=4),"string"!=typeof r&&(s=r,r="#000"),r=r||"#000",null==i&&(i=4),null==s&&(s=1),null==t&&(t=0,n=2),null==n&&(n=t),r=e.color(r),e.format('<feGaussianBlur in="SourceAlpha" stdDeviation="{blur}"/><feOffset dx="{dx}" dy="{dy}" result="offsetblur"/><feFlood flood-color="{color}"/><feComposite in2="offsetblur" operator="in"/><feComponentTransfer><feFuncA type="linear" slope="{opacity}"/></feComponentTransfer><feMerge><feMergeNode/><feMergeNode in="SourceGraphic"/></feMerge>',{color:r,dx:t,dy:n,blur:i,opacity:s})},e.filter.shadow.toString=function(){return this()},e.filter.grayscale=function(t){return null==t&&(t=1),e.format('<feColorMatrix type="matrix" values="{a} {b} {c} 0 0 {d} {e} {f} 0 0 {g} {b} {h} 0 0 0 0 0 1 0"/>',{a:.2126+.7874*(1-t),b:.7152-.7152*(1-t),c:.0722-.0722*(1-t),d:.2126-.2126*(1-t),e:.7152+.2848*(1-t),f:.0722-.0722*(1-t),g:.2126-.2126*(1-t),h:.0722+.9278*(1-t)})},e.filter.grayscale.toString=function(){return this()},e.filter.sepia=function(t){return null==t&&(t=1),e.format('<feColorMatrix type="matrix" values="{a} {b} {c} 0 0 {d} {e} {f} 0 0 {g} {h} {i} 0 0 0 0 0 1 0"/>',{a:.393+.607*(1-t),b:.769-.769*(1-t),c:.189-.189*(1-t),d:.349-.349*(1-t),e:.686+.314*(1-t),f:.168-.168*(1-t),g:.272-.272*(1-t),h:.534-.534*(1-t),i:.131+.869*(1-t)})},e.filter.sepia.toString=function(){return this()},e.filter.saturate=function(t){return null==t&&(t=1),e.format('<feColorMatrix type="saturate" values="{amount}"/>',{amount:1-t})},e.filter.saturate.toString=function(){return this()},e.filter.hueRotate=function(t){return t=t||0,e.format('<feColorMatrix type="hueRotate" values="{angle}"/>',{angle:t})},e.filter.hueRotate.toString=function(){return this()},e.filter.invert=function(t){return null==t&&(t=1),e.format('<feComponentTransfer><feFuncR type="table" tableValues="{amount} {amount2}"/><feFuncG type="table" tableValues="{amount} {amount2}"/><feFuncB type="table" tableValues="{amount} {amount2}"/></feComponentTransfer>',{amount:t,amount2:1-t})},e.filter.invert.toString=function(){return this()},e.filter.brightness=function(t){return null==t&&(t=1),e.format('<feComponentTransfer><feFuncR type="linear" slope="{amount}"/><feFuncG type="linear" slope="{amount}"/><feFuncB type="linear" slope="{amount}"/></feComponentTransfer>',{amount:t})},e.filter.brightness.toString=function(){return this()},e.filter.contrast=function(t){return null==t&&(t=1),e.format('<feComponentTransfer><feFuncR type="linear" slope="{amount}" intercept="{amount2}"/><feFuncG type="linear" slope="{amount}" intercept="{amount2}"/><feFuncB type="linear" slope="{amount}" intercept="{amount2}"/></feComponentTransfer>',{amount:t,amount2:.5-t/2})},e.filter.contrast.toString=function(){return this()}}),i.plugin(function(e,t){var n=e._.box,i=e.is,r=/^[^a-z]*([tbmlrc])/i,s=function(){return"T"+this.dx+","+this.dy};t.prototype.getAlign=function(e,t){null==t&&i(e,"string")&&(t=e,e=null),e=e||this.paper;var a=e.getBBox?e.getBBox():n(e),o=this.getBBox(),l={};switch(t=t&&t.match(r),t=t?t[1].toLowerCase():"c"){case"t":l.dx=0,l.dy=a.y-o.y;break;case"b":l.dx=0,l.dy=a.y2-o.y2;break;case"m":l.dx=0,l.dy=a.cy-o.cy;break;case"l":l.dx=a.x-o.x,l.dy=0;break;case"r":l.dx=a.x2-o.x2,l.dy=0;break;default:l.dx=a.cx-o.cx,l.dy=0}return l.toString=s,l},t.prototype.align=function(e,t){return this.transform("..."+this.getAlign(e,t))}}),i}),function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):"undefined"!=typeof module&&module.exports?module.exports=e(require("jquery")):e(jQuery)}(function(e,t){"use strict";if(!e.jstree){var n,i,r=0,s=!1,a=!1,o=!1,l=[],d=e("script:last").attr("src"),c=window.document,h=c.createElement("LI");h.setAttribute("role","treeitem"),n=c.createElement("I"),n.className="jstree-icon jstree-ocl",n.setAttribute("role","presentation"),h.appendChild(n),n=c.createElement("A"),n.className="jstree-anchor",n.setAttribute("href","#"),n.setAttribute("tabindex","-1"),i=c.createElement("I"),i.className="jstree-icon jstree-themeicon",i.setAttribute("role","presentation"),n.appendChild(i),h.appendChild(n),n=i=null,e.jstree={version:"3.3.2",defaults:{plugins:[]},plugins:{},path:d&&d.indexOf("/")!==-1?d.replace(/\/[^\/]+$/,""):"",idregex:/[\\:&!^|()\[\]<>@*'+~#";.,=\- \/${}%?`]/g,root:"#"},e.jstree.create=function(t,n){var i=new e.jstree.core(++r),s=n;return n=e.extend(!0,{},e.jstree.defaults,n),s&&s.plugins&&(n.plugins=s.plugins),e.each(n.plugins,function(e,t){"core"!==e&&(i=i.plugin(t,n[t]))}),e(t).data("jstree",i),i.init(t,n),i},e.jstree.destroy=function(){e(".jstree:jstree").jstree("destroy"),e(c).off(".jstree")},e.jstree.core=function(e){this._id=e,this._cnt=0,this._wrk=null,this._data={core:{themes:{name:!1,dots:!1,icons:!1},selected:[],last_error:{},working:!1,worker_queue:[],focused:null}}},e.jstree.reference=function(t){var n=null,i=null;if(!t||!t.id||t.tagName&&t.nodeType||(t=t.id),!i||!i.length)try{i=e(t)}catch(e){}if(!i||!i.length)try{i=e("#"+t.replace(e.jstree.idregex,"\\$&"))}catch(e){}return i&&i.length&&(i=i.closest(".jstree")).length&&(i=i.data("jstree"))?n=i:e(".jstree").each(function(){var i=e(this).data("jstree");if(i&&i._model.data[t])return n=i,!1}),n},e.fn.jstree=function(n){var i="string"==typeof n,r=Array.prototype.slice.call(arguments,1),s=null;return!(n===!0&&!this.length)&&(this.each(function(){var a=e.jstree.reference(this),o=i&&a?a[n]:null;if(s=i&&o?o.apply(a,r):null,a||i||n!==t&&!e.isPlainObject(n)||e.jstree.create(this,n),(a&&!i||n===!0)&&(s=a||!1),null!==s&&s!==t)return!1}),null!==s&&s!==t?s:this)},e.expr.pseudos.jstree=e.expr.createPseudo(function(){return function(n){return e(n).hasClass("jstree")&&e(n).data("jstree")!==t}}),e.jstree.defaults.core={data:!1,strings:!1,check_callback:!1,error:e.noop,animation:200,multiple:!0,themes:{name:!1,url:!1,dir:!1,dots:!0,icons:!0,stripes:!1,variant:!1,responsive:!1},expand_selected_onload:!0,worker:!0,force_text:!1,dblclick_toggle:!0},e.jstree.core.prototype={plugin:function(t,n){var i=e.jstree.plugins[t];return i?(this._data[t]={},i.prototype=this,new i(n,this)):this},init:function(t,n){this._model={data:{},changed:[],force_full_redraw:!1,redraw_timeout:!1,default_state:{loaded:!0,opened:!1,selected:!1,disabled:!1}},this._model.data[e.jstree.root]={id:e.jstree.root,parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}},this.element=e(t).addClass("jstree jstree-"+this._id),this.settings=n,this._data.core.ready=!1,this._data.core.loaded=!1,this._data.core.rtl="rtl"===this.element.css("direction"),this.element[this._data.core.rtl?"addClass":"removeClass"]("jstree-rtl"),this.element.attr("role","tree"),this.settings.core.multiple&&this.element.attr("aria-multiselectable",!0),this.element.attr("tabindex")||this.element.attr("tabindex","0"),this.bind(),this.trigger("init"),this._data.core.original_container_html=this.element.find(" > ul > li").clone(!0),this._data.core.original_container_html.find("li").addBack().contents().filter(function(){return 3===this.nodeType&&(!this.nodeValue||/^\s+$/.test(this.nodeValue))}).remove(),this.element.html("<ul class='jstree-container-ul jstree-children' role='group'><li id='j"+this._id+"_loading' class='jstree-initial-node jstree-loading jstree-leaf jstree-last' role='tree-item'><i class='jstree-icon jstree-ocl'></i><a class='jstree-anchor' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+this.get_string("Loading ...")+"</a></li></ul>"),this.element.attr("aria-activedescendant","j"+this._id+"_loading"),this._data.core.li_height=this.get_container_ul().children("li").first().height()||24,this.trigger("loading"),this.load_node(e.jstree.root)},destroy:function(e){if(this._wrk)try{window.URL.revokeObjectURL(this._wrk),this._wrk=null}catch(e){}e||this.element.empty(),this.teardown()},teardown:function(){this.unbind(),this.element.removeClass("jstree").removeData("jstree").find("[class^='jstree']").addBack().attr("class",function(){return this.className.replace(/jstree[^ ]*|$/gi,"")}),this.element=null},bind:function(){var t="",n=null,i=0;this.element.on("dblclick.jstree",function(e){if(e.target.tagName&&"input"===e.target.tagName.toLowerCase())return!0;if(c.selection&&c.selection.empty)c.selection.empty();else if(window.getSelection){var t=window.getSelection();try{t.removeAllRanges(),t.collapse()}catch(e){}}}).on("mousedown.jstree",e.proxy(function(e){e.target===this.element[0]&&(e.preventDefault(),i=+new Date)},this)).on("mousedown.jstree",".jstree-ocl",function(e){e.preventDefault()}).on("click.jstree",".jstree-ocl",e.proxy(function(e){this.toggle_node(e.target)},this)).on("dblclick.jstree",".jstree-anchor",e.proxy(function(e){return!(!e.target.tagName||"input"!==e.target.tagName.toLowerCase())||void(this.settings.core.dblclick_toggle&&this.toggle_node(e.target))},this)).on("click.jstree",".jstree-anchor",e.proxy(function(t){t.preventDefault(),t.currentTarget!==c.activeElement&&e(t.currentTarget).focus(),this.activate_node(t.currentTarget,t)},this)).on("keydown.jstree",".jstree-anchor",e.proxy(function(t){if(t.target.tagName&&"input"===t.target.tagName.toLowerCase())return!0;if(32!==t.which&&13!==t.which&&(t.shiftKey||t.ctrlKey||t.altKey||t.metaKey))return!0;var n=null;switch(this._data.core.rtl&&(37===t.which?t.which=39:39===t.which&&(t.which=37)),t.which){case 32:t.ctrlKey&&(t.type="click",e(t.currentTarget).trigger(t));break;case 13:t.type="click",e(t.currentTarget).trigger(t);break;case 37:t.preventDefault(),this.is_open(t.currentTarget)?this.close_node(t.currentTarget):(n=this.get_parent(t.currentTarget),n&&n.id!==e.jstree.root&&this.get_node(n,!0).children(".jstree-anchor").focus());break;case 38:t.preventDefault(),n=this.get_prev_dom(t.currentTarget),n&&n.length&&n.children(".jstree-anchor").focus();break;case 39:t.preventDefault(),this.is_closed(t.currentTarget)?this.open_node(t.currentTarget,function(e){this.get_node(e,!0).children(".jstree-anchor").focus()}):this.is_open(t.currentTarget)&&(n=this.get_node(t.currentTarget,!0).children(".jstree-children")[0],n&&e(this._firstChild(n)).children(".jstree-anchor").focus());break;case 40:t.preventDefault(),n=this.get_next_dom(t.currentTarget),n&&n.length&&n.children(".jstree-anchor").focus();break;case 106:this.open_all();break;case 36:t.preventDefault(),n=this._firstChild(this.get_container_ul()[0]),n&&e(n).children(".jstree-anchor").filter(":visible").focus();break;case 35:t.preventDefault(),this.element.find(".jstree-anchor").filter(":visible").last().focus();break;case 113:t.preventDefault(),this.edit(t.currentTarget)}},this)).on("load_node.jstree",e.proxy(function(t,n){n.status&&(n.node.id!==e.jstree.root||this._data.core.loaded||(this._data.core.loaded=!0,this._firstChild(this.get_container_ul()[0])&&this.element.attr("aria-activedescendant",this._firstChild(this.get_container_ul()[0]).id),this.trigger("loaded")),this._data.core.ready||setTimeout(e.proxy(function(){if(this.element&&!this.get_container_ul().find(".jstree-loading").length){if(this._data.core.ready=!0,this._data.core.selected.length){if(this.settings.core.expand_selected_onload){var t,n,i=[];for(t=0,n=this._data.core.selected.length;t<n;t++)i=i.concat(this._model.data[this._data.core.selected[t]].parents);for(i=e.vakata.array_unique(i),t=0,n=i.length;t<n;t++)this.open_node(i[t],!1,0)}this.trigger("changed",{action:"ready",selected:this._data.core.selected})}this.trigger("ready")}},this),0))},this)).on("keypress.jstree",e.proxy(function(i){if(i.target.tagName&&"input"===i.target.tagName.toLowerCase())return!0;n&&clearTimeout(n),n=setTimeout(function(){t=""},500);var r=String.fromCharCode(i.which).toLowerCase(),s=this.element.find(".jstree-anchor").filter(":visible"),a=s.index(c.activeElement)||0,o=!1;if(t+=r,t.length>1){if(s.slice(a).each(e.proxy(function(n,i){if(0===e(i).name().toLowerCase().indexOf(t))return e(i).focus(),o=!0,!1},this)),o)return;if(s.slice(0,a).each(e.proxy(function(n,i){if(0===e(i).name().toLowerCase().indexOf(t))return e(i).focus(),o=!0,!1},this)),o)return}if(new RegExp("^"+r.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")+"+$").test(t)){if(s.slice(a+1).each(e.proxy(function(t,n){if(e(n).name().toLowerCase().charAt(0)===r)return e(n).focus(),o=!0,!1},this)),o)return;if(s.slice(0,a+1).each(e.proxy(function(t,n){if(e(n).name().toLowerCase().charAt(0)===r)return e(n).focus(),o=!0,!1},this)),o)return}},this)).on("init.jstree",e.proxy(function(){var e=this.settings.core.themes;this._data.core.themes.dots=e.dots,this._data.core.themes.stripes=e.stripes,this._data.core.themes.icons=e.icons,this.set_theme(e.name||"default",e.url),this.set_theme_variant(e.variant)},this)).on("loading.jstree",e.proxy(function(){this[this._data.core.themes.dots?"show_dots":"hide_dots"](),this[this._data.core.themes.icons?"show_icons":"hide_icons"](),this[this._data.core.themes.stripes?"show_stripes":"hide_stripes"]()},this)).on("blur.jstree",".jstree-anchor",e.proxy(function(t){this._data.core.focused=null,e(t.currentTarget).filter(".jstree-hovered").mouseleave(),this.element.attr("tabindex","0")},this)).on("focus.jstree",".jstree-anchor",e.proxy(function(t){var n=this.get_node(t.currentTarget);n&&n.id&&(this._data.core.focused=n.id),this.element.find(".jstree-hovered").not(t.currentTarget).mouseleave(),e(t.currentTarget).mouseenter(),this.element.attr("tabindex","-1")},this)).on("focus.jstree",e.proxy(function(){if(+new Date-i>500&&!this._data.core.focused){i=0;var e=this.get_node(this.element.attr("aria-activedescendant"),!0);e&&e.find("> .jstree-anchor").focus()}},this)).on("mouseenter.jstree",".jstree-anchor",e.proxy(function(e){this.hover_node(e.currentTarget)},this)).on("mouseleave.jstree",".jstree-anchor",e.proxy(function(e){this.dehover_node(e.currentTarget)},this))},unbind:function(){this.element.off(".jstree"),e(c).off(".jstree-"+this._id)},trigger:function(e,t){t||(t={}),t.instance=this,this.element.triggerHandler(e.replace(".jstree","")+".jstree",t)},get_container:function(){return this.element},get_container_ul:function(){return this.element.children(".jstree-children").first()},get_string:function(t){var n=this.settings.core.strings;return e.isFunction(n)?n.call(this,t):n&&n[t]?n[t]:t},_firstChild:function(e){for(e=e?e.firstChild:null;null!==e&&1!==e.nodeType;)e=e.nextSibling;return e},_nextSibling:function(e){for(e=e?e.nextSibling:null;null!==e&&1!==e.nodeType;)e=e.nextSibling;return e},_previousSibling:function(e){for(e=e?e.previousSibling:null;null!==e&&1!==e.nodeType;)e=e.previousSibling;return e},get_node:function(t,n){t&&t.id&&(t=t.id);var i;try{if(this._model.data[t])t=this._model.data[t];else if("string"==typeof t&&this._model.data[t.replace(/^#/,"")])t=this._model.data[t.replace(/^#/,"")];else if("string"==typeof t&&(i=e("#"+t.replace(e.jstree.idregex,"\\$&"),this.element)).length&&this._model.data[i.closest(".jstree-node").attr("id")])t=this._model.data[i.closest(".jstree-node").attr("id")];else if((i=e(t,this.element)).length&&this._model.data[i.closest(".jstree-node").attr("id")])t=this._model.data[i.closest(".jstree-node").attr("id")];else{if(!(i=e(t,this.element)).length||!i.hasClass("jstree"))return!1;t=this._model.data[e.jstree.root]}return n&&(t=t.id===e.jstree.root?this.element:e("#"+t.id.replace(e.jstree.idregex,"\\$&"),this.element)),t}catch(e){return!1}},get_path:function(t,n,i){if(t=t.parents?t:this.get_node(t),!t||t.id===e.jstree.root||!t.parents)return!1;var r,s,a=[];for(a.push(i?t.id:t.name),r=0,s=t.parents.length;r<s;r++)a.push(i?t.parents[r]:this.get_text(t.parents[r]));return a=a.reverse().slice(1),n?a.join(n):a},get_next_dom:function(t,n){var i;if(t=this.get_node(t,!0),t[0]===this.element[0]){for(i=this._firstChild(this.get_container_ul()[0]);i&&0===i.offsetHeight;)i=this._nextSibling(i);return!!i&&e(i)}if(!t||!t.length)return!1;if(n){i=t[0];do i=this._nextSibling(i);while(i&&0===i.offsetHeight);return!!i&&e(i)}if(t.hasClass("jstree-open")){for(i=this._firstChild(t.children(".jstree-children")[0]);i&&0===i.offsetHeight;)i=this._nextSibling(i);if(null!==i)return e(i)}i=t[0];do i=this._nextSibling(i);while(i&&0===i.offsetHeight);return null!==i?e(i):t.parentsUntil(".jstree",".jstree-node").nextAll(".jstree-node:visible").first()},get_prev_dom:function(t,n){var i;if(t=this.get_node(t,!0),t[0]===this.element[0]){for(i=this.get_container_ul()[0].lastChild;i&&0===i.offsetHeight;)i=this._previousSibling(i);return!!i&&e(i)}if(!t||!t.length)return!1;if(n){i=t[0];do i=this._previousSibling(i);while(i&&0===i.offsetHeight);return!!i&&e(i)}i=t[0];do i=this._previousSibling(i);while(i&&0===i.offsetHeight);if(null!==i){for(t=e(i);t.hasClass("jstree-open");)t=t.children(".jstree-children").first().children(".jstree-node:visible:last");return t}return i=t[0].parentNode.parentNode,!(!i||!i.className||i.className.indexOf("jstree-node")===-1)&&e(i)},get_parent:function(t){return t=this.get_node(t),!(!t||t.id===e.jstree.root)&&t.parent},get_children_dom:function(e){return e=this.get_node(e,!0),e[0]===this.element[0]?this.get_container_ul().children(".jstree-node"):!(!e||!e.length)&&e.children(".jstree-children").children(".jstree-node")},is_parent:function(e){return e=this.get_node(e),e&&(e.state.loaded===!1||e.children.length>0)},is_loaded:function(e){return e=this.get_node(e),e&&e.state.loaded},is_loading:function(e){return e=this.get_node(e),e&&e.state&&e.state.loading},is_open:function(e){return e=this.get_node(e),e&&e.state.opened},is_closed:function(e){return e=this.get_node(e),e&&this.is_parent(e)&&!e.state.opened},is_leaf:function(e){return!this.is_parent(e)},load_node:function(t,n){var i,r,s,a,o;if(e.isArray(t))return this._load_nodes(t.slice(),n),!0;if(t=this.get_node(t),!t)return n&&n.call(this,t,!1),!1;if(t.state.loaded){for(t.state.loaded=!1,s=0,a=t.parents.length;s<a;s++)this._model.data[t.parents[s]].children_d=e.vakata.array_filter(this._model.data[t.parents[s]].children_d,function(n){return e.inArray(n,t.children_d)===-1});for(i=0,r=t.children_d.length;i<r;i++)this._model.data[t.children_d[i]].state.selected&&(o=!0),delete this._model.data[t.children_d[i]];o&&(this._data.core.selected=e.vakata.array_filter(this._data.core.selected,function(n){return e.inArray(n,t.children_d)===-1})),t.children=[],t.children_d=[],o&&this.trigger("changed",{action:"load_node",node:t,selected:this._data.core.selected})}return t.state.failed=!1,t.state.loading=!0,this.get_node(t,!0).addClass("jstree-loading").attr("aria-busy",!0),this._load_node(t,e.proxy(function(e){t=this._model.data[t.id],t.state.loading=!1,t.state.loaded=e,t.state.failed=!t.state.loaded;var i=this.get_node(t,!0),r=0,s=0,a=this._model.data,o=!1;for(r=0,s=t.children.length;r<s;r++)if(a[t.children[r]]&&!a[t.children[r]].state.hidden){o=!0;break}t.state.loaded&&i&&i.length&&(i.removeClass("jstree-closed jstree-open jstree-leaf"),o?"#"!==t.id&&i.addClass(t.state.opened?"jstree-open":"jstree-closed"):i.addClass("jstree-leaf")),i.removeClass("jstree-loading").attr("aria-busy",!1),this.trigger("load_node",{node:t,status:e}),n&&n.call(this,t,e)},this)),!0},_load_nodes:function(e,t,n,i){var r,s,a=!0,o=function(){this._load_nodes(e,t,!0)},l=this._model.data,d=[];for(r=0,s=e.length;r<s;r++)l[e[r]]&&(!l[e[r]].state.loaded&&!l[e[r]].state.failed||!n&&i)&&(this.is_loading(e[r])||this.load_node(e[r],o),a=!1);if(a){for(r=0,s=e.length;r<s;r++)l[e[r]]&&l[e[r]].state.loaded&&d.push(e[r]);t&&!t.done&&(t.call(this,d),t.done=!0)}},load_all:function(t,n){if(t||(t=e.jstree.root),t=this.get_node(t),!t)return!1;var i,r,s=[],a=this._model.data,o=a[t.id].children_d;for(t.state&&!t.state.loaded&&s.push(t.id),i=0,r=o.length;i<r;i++)a[o[i]]&&a[o[i]].state&&!a[o[i]].state.loaded&&s.push(o[i]);s.length?this._load_nodes(s,function(){this.load_all(t,n)}):(n&&n.call(this,t),this.trigger("load_all",{node:t}))},_load_node:function(t,n){var i,r=this.settings.core.data,s=function(){return 3!==this.nodeType&&8!==this.nodeType};return r?e.isFunction(r)?r.call(this,t,e.proxy(function(i){i===!1?n.call(this,!1):this["string"==typeof i?"_append_html_data":"_append_json_data"](t,"string"==typeof i?e(e.parseHTML(i)).filter(s):i,function(e){n.call(this,e)})},this)):"object"==typeof r?r.url?(r=e.extend(!0,{},r),e.isFunction(r.url)&&(r.url=r.url.call(this,t)),e.isFunction(r.data)&&(r.data=r.data.call(this,t)),e.ajax(r).done(e.proxy(function(i,r,a){var o=a.getResponseHeader("Content-Type");return o&&o.indexOf("json")!==-1||"object"==typeof i?this._append_json_data(t,i,function(e){n.call(this,e)}):o&&o.indexOf("html")!==-1||"string"==typeof i?this._append_html_data(t,e(e.parseHTML(i)).filter(s),function(e){n.call(this,e)}):(this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:t.id,xhr:a})},this.settings.core.error.call(this,this._data.core.last_error),n.call(this,!1))},this)).fail(e.proxy(function(e){n.call(this,!1),this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:t.id,xhr:e})},this.settings.core.error.call(this,this._data.core.last_error)},this))):(i=e.isArray(r)||e.isPlainObject(r)?JSON.parse(JSON.stringify(r)):r,t.id===e.jstree.root?this._append_json_data(t,i,function(e){n.call(this,e)}):(this._data.core.last_error={error:"nodata",plugin:"core",id:"core_05",reason:"Could not load node",data:JSON.stringify({id:t.id})},this.settings.core.error.call(this,this._data.core.last_error),n.call(this,!1))):"string"==typeof r?t.id===e.jstree.root?this._append_html_data(t,e(e.parseHTML(r)).filter(s),function(e){n.call(this,e)}):(this._data.core.last_error={error:"nodata",plugin:"core",id:"core_06",reason:"Could not load node",data:JSON.stringify({id:t.id})},this.settings.core.error.call(this,this._data.core.last_error),n.call(this,!1)):n.call(this,!1):t.id===e.jstree.root?this._append_html_data(t,this._data.core.original_container_html.clone(!0),function(e){n.call(this,e)}):n.call(this,!1)},_node_changed:function(e){e=this.get_node(e),e&&this._model.changed.push(e.id)},_append_html_data:function(t,n,i){t=this.get_node(t),t.children=[],t.children_d=[];var r,s,a,o=n.is("ul")?n.children():n,l=t.id,d=[],c=[],h=this._model.data,u=h[l],f=this._data.core.selected.length;for(o.each(e.proxy(function(t,n){r=this._parse_model_from_html(e(n),l,u.parents.concat()),r&&(d.push(r),c.push(r),h[r].children_d.length&&(c=c.concat(h[r].children_d)))},this)),u.children=d,u.children_d=c,s=0,a=u.parents.length;s<a;s++)h[u.parents[s]].children_d=h[u.parents[s]].children_d.concat(c);this.trigger("model",{nodes:c,parent:l}),l!==e.jstree.root?(this._node_changed(l),this.redraw()):(this.get_container_ul().children(".jstree-initial-node").remove(),
this.redraw(!0)),this._data.core.selected.length!==f&&this.trigger("changed",{action:"model",selected:this._data.core.selected}),i.call(this,!0)},_append_json_data:function(t,n,i,r){if(null!==this.element){t=this.get_node(t),t.children=[],t.children_d=[],n.d&&(n=n.d,"string"==typeof n&&(n=JSON.parse(n))),e.isArray(n)||(n=[n]);var s=null,a={df:this._model.default_state,dat:n,par:t.id,m:this._model.data,t_id:this._id,t_cnt:this._cnt,sel:this._data.core.selected},o=function(e,t){e.data&&(e=e.data);var n,i,r,s,a=e.dat,o=e.par,l=[],d=[],c=[],h=e.df,u=e.t_id,f=e.t_cnt,p=e.m,g=p[o],_=e.sel,m=function(e,n,i){i=i?i.concat():[],n&&i.unshift(n);var r,s,a,o,l=e.id.toString(),d={id:l,name:e.name||"",icon:e.icon===t||e.icon,parent:n,parents:i,children:e.children||[],children_d:e.children_d||[],data:e.data,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(r in h)h.hasOwnProperty(r)&&(d.state[r]=h[r]);if(e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(d.icon=e.data.jstree.icon),d.icon!==t&&null!==d.icon&&""!==d.icon||(d.icon=!0),e&&e.data&&(d.data=e.data,e.data.jstree))for(r in e.data.jstree)e.data.jstree.hasOwnProperty(r)&&(d.state[r]=e.data.jstree[r]);if(e&&"object"==typeof e.state)for(r in e.state)e.state.hasOwnProperty(r)&&(d.state[r]=e.state[r]);if(e&&"object"==typeof e.li_attr)for(r in e.li_attr)e.li_attr.hasOwnProperty(r)&&(d.li_attr[r]=e.li_attr[r]);if(d.li_attr.id||(d.li_attr.id=l),e&&"object"==typeof e.a_attr)for(r in e.a_attr)e.a_attr.hasOwnProperty(r)&&(d.a_attr[r]=e.a_attr[r]);for(e&&e.children&&e.children===!0&&(d.state.loaded=!1,d.children=[],d.children_d=[]),p[d.id]=d,r=0,s=d.children.length;r<s;r++)a=m(p[d.children[r]],d.id,i),o=p[a],d.children_d.push(a),o.children_d.length&&(d.children_d=d.children_d.concat(o.children_d));return delete e.data,delete e.children,p[d.id].original=e,d.state.selected&&c.push(d.id),d.id},y=function(e,n,i){i=i?i.concat():[],n&&i.unshift(n);var r,s,a,o,l,d=!1;do d="j"+u+"_"+ ++f;while(p[d]);l={id:!1,name:"string"==typeof e?e:"",icon:"object"!=typeof e||e.icon===t||e.icon,parent:n,parents:i,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(r in h)h.hasOwnProperty(r)&&(l.state[r]=h[r]);if(e&&e.id&&(l.id=e.id.toString()),e&&e.name&&(l.name=e.name),e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(l.icon=e.data.jstree.icon),l.icon!==t&&null!==l.icon&&""!==l.icon||(l.icon=!0),e&&e.data&&(l.data=e.data,e.data.jstree))for(r in e.data.jstree)e.data.jstree.hasOwnProperty(r)&&(l.state[r]=e.data.jstree[r]);if(e&&"object"==typeof e.state)for(r in e.state)e.state.hasOwnProperty(r)&&(l.state[r]=e.state[r]);if(e&&"object"==typeof e.li_attr)for(r in e.li_attr)e.li_attr.hasOwnProperty(r)&&(l.li_attr[r]=e.li_attr[r]);if(l.li_attr.id&&!l.id&&(l.id=l.li_attr.id.toString()),l.id||(l.id=d),l.li_attr.id||(l.li_attr.id=l.id),e&&"object"==typeof e.a_attr)for(r in e.a_attr)e.a_attr.hasOwnProperty(r)&&(l.a_attr[r]=e.a_attr[r]);if(e&&e.children&&e.children.length){for(r=0,s=e.children.length;r<s;r++)a=y(e.children[r],l.id,i),o=p[a],l.children.push(a),o.children_d.length&&(l.children_d=l.children_d.concat(o.children_d));l.children_d=l.children_d.concat(l.children)}return e&&e.children&&e.children===!0&&(l.state.loaded=!1,l.children=[],l.children_d=[]),delete e.data,delete e.children,l.original=e,p[l.id]=l,l.state.selected&&c.push(l.id),l.id};if(a.length&&a[0].id!==t&&a[0].parent!==t){for(i=0,r=a.length;i<r;i++)a[i].children||(a[i].children=[]),p[a[i].id.toString()]=a[i];for(i=0,r=a.length;i<r;i++)p[a[i].parent.toString()].children.push(a[i].id.toString()),g.children_d.push(a[i].id.toString());for(i=0,r=g.children.length;i<r;i++)n=m(p[g.children[i]],o,g.parents.concat()),d.push(n),p[n].children_d.length&&(d=d.concat(p[n].children_d));for(i=0,r=g.parents.length;i<r;i++)p[g.parents[i]].children_d=p[g.parents[i]].children_d.concat(d);s={cnt:f,mod:p,sel:_,par:o,dpc:d,add:c}}else{for(i=0,r=a.length;i<r;i++)n=y(a[i],o,g.parents.concat()),n&&(l.push(n),d.push(n),p[n].children_d.length&&(d=d.concat(p[n].children_d)));for(g.children=l,g.children_d=d,i=0,r=g.parents.length;i<r;i++)p[g.parents[i]].children_d=p[g.parents[i]].children_d.concat(d);s={cnt:f,mod:p,sel:_,par:o,dpc:d,add:c}}return"undefined"!=typeof window&&"undefined"!=typeof window.document?s:void postMessage(s)},l=function(t,n){if(null!==this.element){this._cnt=t.cnt;var r,s=this._model.data;for(r in s)s.hasOwnProperty(r)&&s[r].state&&s[r].state.loading&&t.mod[r]&&(t.mod[r].state.loading=!0);if(this._model.data=t.mod,n){var a,o=t.add,l=t.sel,d=this._data.core.selected.slice();if(s=this._model.data,l.length!==d.length||e.vakata.array_unique(l.concat(d)).length!==l.length){for(r=0,a=l.length;r<a;r++)e.inArray(l[r],o)===-1&&e.inArray(l[r],d)===-1&&(s[l[r]].state.selected=!1);for(r=0,a=d.length;r<a;r++)e.inArray(d[r],l)===-1&&(s[d[r]].state.selected=!0)}}t.add.length&&(this._data.core.selected=this._data.core.selected.concat(t.add)),this.trigger("model",{nodes:t.dpc,parent:t.par}),t.par!==e.jstree.root?(this._node_changed(t.par),this.redraw()):this.redraw(!0),t.add.length&&this.trigger("changed",{action:"model",selected:this._data.core.selected}),i.call(this,!0)}};if(this.settings.core.worker&&window.Blob&&window.URL&&window.Worker)try{null===this._wrk&&(this._wrk=window.URL.createObjectURL(new window.Blob(["self.onmessage = "+o.toString()],{type:"name/javascript"}))),!this._data.core.working||r?(this._data.core.working=!0,s=new window.Worker(this._wrk),s.onmessage=e.proxy(function(e){l.call(this,e.data,!0);try{s.terminate(),s=null}catch(e){}this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1},this),a.par?s.postMessage(a):this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1):this._data.core.worker_queue.push([t,n,i,!0])}catch(e){l.call(this,o(a),!1),this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1}else l.call(this,o(a),!1)}},_parse_model_from_html:function(n,i,r){r=r?[].concat(r):[],i&&r.unshift(i);var s,a,o,l,d,c=this._model.data,h={id:!1,name:!1,icon:!0,parent:i,parents:r,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(o in this._model.default_state)this._model.default_state.hasOwnProperty(o)&&(h.state[o]=this._model.default_state[o]);if(l=e.vakata.attributes(n,!0),e.each(l,function(t,n){return n=e.trim(n),!n.length||(h.li_attr[t]=n,void("id"===t&&(h.id=n.toString())))}),l=n.children("a").first(),l.length&&(l=e.vakata.attributes(l,!0),e.each(l,function(t,n){n=e.trim(n),n.length&&(h.a_attr[t]=n)})),l=n.children("a").first().length?n.children("a").first().clone():n.clone(),l.children("ins, i, ul").remove(),l=l.html(),l=e("<div />").html(l),h.name=this.settings.core.force_text?l.name():l.html(),l=n.data(),h.data=l?e.extend(!0,{},l):null,h.state.opened=n.hasClass("jstree-open"),h.state.selected=n.children("a").hasClass("jstree-clicked"),h.state.disabled=n.children("a").hasClass("jstree-disabled"),h.data&&h.data.jstree)for(o in h.data.jstree)h.data.jstree.hasOwnProperty(o)&&(h.state[o]=h.data.jstree[o]);l=n.children("a").children(".jstree-themeicon"),l.length&&(h.icon=!l.hasClass("jstree-themeicon-hidden")&&l.attr("rel")),h.state.icon!==t&&(h.icon=h.state.icon),h.icon!==t&&null!==h.icon&&""!==h.icon||(h.icon=!0),l=n.children("ul").children("li");do d="j"+this._id+"_"+ ++this._cnt;while(c[d]);return h.id=h.li_attr.id?h.li_attr.id.toString():d,l.length?(l.each(e.proxy(function(t,n){s=this._parse_model_from_html(e(n),h.id,r),a=this._model.data[s],h.children.push(s),a.children_d.length&&(h.children_d=h.children_d.concat(a.children_d))},this)),h.children_d=h.children_d.concat(h.children)):n.hasClass("jstree-closed")&&(h.state.loaded=!1),h.li_attr["class"]&&(h.li_attr["class"]=h.li_attr["class"].replace("jstree-closed","").replace("jstree-open","")),h.a_attr["class"]&&(h.a_attr["class"]=h.a_attr["class"].replace("jstree-clicked","").replace("jstree-disabled","")),c[h.id]=h,h.state.selected&&this._data.core.selected.push(h.id),h.id},_parse_model_from_flat_json:function(e,n,i){i=i?i.concat():[],n&&i.unshift(n);var r,s,a,o,l=e.id.toString(),d=this._model.data,c=this._model.default_state,h={id:l,name:e.name||"",icon:e.icon===t||e.icon,parent:n,parents:i,children:e.children||[],children_d:e.children_d||[],data:e.data,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(r in c)c.hasOwnProperty(r)&&(h.state[r]=c[r]);if(e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(h.icon=e.data.jstree.icon),h.icon!==t&&null!==h.icon&&""!==h.icon||(h.icon=!0),e&&e.data&&(h.data=e.data,e.data.jstree))for(r in e.data.jstree)e.data.jstree.hasOwnProperty(r)&&(h.state[r]=e.data.jstree[r]);if(e&&"object"==typeof e.state)for(r in e.state)e.state.hasOwnProperty(r)&&(h.state[r]=e.state[r]);if(e&&"object"==typeof e.li_attr)for(r in e.li_attr)e.li_attr.hasOwnProperty(r)&&(h.li_attr[r]=e.li_attr[r]);if(h.li_attr.id||(h.li_attr.id=l),e&&"object"==typeof e.a_attr)for(r in e.a_attr)e.a_attr.hasOwnProperty(r)&&(h.a_attr[r]=e.a_attr[r]);for(e&&e.children&&e.children===!0&&(h.state.loaded=!1,h.children=[],h.children_d=[]),d[h.id]=h,r=0,s=h.children.length;r<s;r++)a=this._parse_model_from_flat_json(d[h.children[r]],h.id,i),o=d[a],h.children_d.push(a),o.children_d.length&&(h.children_d=h.children_d.concat(o.children_d));return delete e.data,delete e.children,d[h.id].original=e,h.state.selected&&this._data.core.selected.push(h.id),h.id},_parse_model_from_json:function(e,n,i){i=i?i.concat():[],n&&i.unshift(n);var r,s,a,o,l,d=!1,c=this._model.data,h=this._model.default_state;do d="j"+this._id+"_"+ ++this._cnt;while(c[d]);l={id:!1,name:"string"==typeof e?e:"",icon:"object"!=typeof e||e.icon===t||e.icon,parent:n,parents:i,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(r in h)h.hasOwnProperty(r)&&(l.state[r]=h[r]);if(e&&e.id&&(l.id=e.id.toString()),e&&e.name&&(l.name=e.name),e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(l.icon=e.data.jstree.icon),l.icon!==t&&null!==l.icon&&""!==l.icon||(l.icon=!0),e&&e.data&&(l.data=e.data,e.data.jstree))for(r in e.data.jstree)e.data.jstree.hasOwnProperty(r)&&(l.state[r]=e.data.jstree[r]);if(e&&"object"==typeof e.state)for(r in e.state)e.state.hasOwnProperty(r)&&(l.state[r]=e.state[r]);if(e&&"object"==typeof e.li_attr)for(r in e.li_attr)e.li_attr.hasOwnProperty(r)&&(l.li_attr[r]=e.li_attr[r]);if(l.li_attr.id&&!l.id&&(l.id=l.li_attr.id.toString()),l.id||(l.id=d),l.li_attr.id||(l.li_attr.id=l.id),e&&"object"==typeof e.a_attr)for(r in e.a_attr)e.a_attr.hasOwnProperty(r)&&(l.a_attr[r]=e.a_attr[r]);if(e&&e.children&&e.children.length){for(r=0,s=e.children.length;r<s;r++)a=this._parse_model_from_json(e.children[r],l.id,i),o=c[a],l.children.push(a),o.children_d.length&&(l.children_d=l.children_d.concat(o.children_d));l.children_d=l.children_d.concat(l.children)}return e&&e.children&&e.children===!0&&(l.state.loaded=!1,l.children=[],l.children_d=[]),delete e.data,delete e.children,l.original=e,c[l.id]=l,l.state.selected&&this._data.core.selected.push(l.id),l.id},_redraw:function(){var t,n,i,r=this._model.force_full_redraw?this._model.data[e.jstree.root].children.concat([]):this._model.changed.concat([]),s=c.createElement("UL"),a=this._data.core.focused;for(n=0,i=r.length;n<i;n++)t=this.redraw_node(r[n],!0,this._model.force_full_redraw),t&&this._model.force_full_redraw&&s.appendChild(t);this._model.force_full_redraw&&(s.className=this.get_container_ul()[0].className,s.setAttribute("role","group"),this.element.empty().append(s)),null!==a&&(t=this.get_node(a,!0),t&&t.length&&t.children(".jstree-anchor")[0]!==c.activeElement?t.children(".jstree-anchor").focus():this._data.core.focused=null),this._model.force_full_redraw=!1,this._model.changed=[],this.trigger("redraw",{nodes:r})},redraw:function(e){e&&(this._model.force_full_redraw=!0),this._redraw()},draw_children:function(t){var n=this.get_node(t),i=!1,r=!1,s=!1,a=c;if(!n)return!1;if(n.id===e.jstree.root)return this.redraw(!0);if(t=this.get_node(t,!0),!t||!t.length)return!1;if(t.children(".jstree-children").remove(),t=t[0],n.children.length&&n.state.loaded){for(s=a.createElement("UL"),s.setAttribute("role","group"),s.className="jstree-children",i=0,r=n.children.length;i<r;i++)s.appendChild(this.redraw_node(n.children[i],!0,!0));t.appendChild(s)}},redraw_node:function(t,n,i,r){var s=this.get_node(t),a=!1,o=!1,l=!1,d=!1,u=!1,f=!1,p="",g=c,_=this._model.data,m=!1,y=null,v=0,x=0,b=!1,k=!1;if(!s)return!1;if(s.id===e.jstree.root)return this.redraw(!0);if(n=n||0===s.children.length,t=c.querySelector?this.element[0].querySelector("#"+("0123456789".indexOf(s.id[0])!==-1?"\\3"+s.id[0]+" "+s.id.substr(1).replace(e.jstree.idregex,"\\$&"):s.id.replace(e.jstree.idregex,"\\$&"))):c.getElementById(s.id))t=e(t),i||(a=t.parent().parent()[0],a===this.element[0]&&(a=null),o=t.index()),n||!s.children.length||t.children(".jstree-children").length||(n=!0),n||(l=t.children(".jstree-children")[0]),m=t.children(".jstree-anchor")[0]===c.activeElement,t.remove();else if(n=!0,!i){if(a=s.parent!==e.jstree.root?e("#"+s.parent.replace(e.jstree.idregex,"\\$&"),this.element)[0]:null,!(null===a||a&&_[s.parent].state.opened))return!1;o=e.inArray(s.id,null===a?_[e.jstree.root].children:_[s.parent].children)}t=h.cloneNode(!0),p="jstree-node ";for(d in s.li_attr)if(s.li_attr.hasOwnProperty(d)){if("id"===d)continue;"class"!==d?t.setAttribute(d,s.li_attr[d]):p+=s.li_attr[d]}for(s.a_attr.id||(s.a_attr.id=s.id+"_anchor"),t.setAttribute("aria-selected",!!s.state.selected),t.setAttribute("aria-level",s.parents.length),t.setAttribute("aria-labelledby",s.a_attr.id),s.state.disabled&&t.setAttribute("aria-disabled",!0),d=0,u=s.children.length;d<u;d++)if(!_[s.children[d]].state.hidden){b=!0;break}if(null!==s.parent&&_[s.parent]&&!s.state.hidden&&(d=e.inArray(s.id,_[s.parent].children),k=s.id,d!==-1))for(d++,u=_[s.parent].children.length;d<u&&(_[_[s.parent].children[d]].state.hidden||(k=_[s.parent].children[d]),k===s.id);d++);s.state.hidden&&(p+=" jstree-hidden"),s.state.loaded&&!b?p+=" jstree-leaf":(p+=s.state.opened&&s.state.loaded?" jstree-open":" jstree-closed",t.setAttribute("aria-expanded",s.state.opened&&s.state.loaded)),k===s.id&&(p+=" jstree-last"),t.id=s.id,t.className=p,p=(s.state.selected?" jstree-clicked":"")+(s.state.disabled?" jstree-disabled":"");for(u in s.a_attr)if(s.a_attr.hasOwnProperty(u)){if("href"===u&&"#"===s.a_attr[u])continue;"class"!==u?t.childNodes[1].setAttribute(u,s.a_attr[u]):p+=" "+s.a_attr[u]}if(p.length&&(t.childNodes[1].className="jstree-anchor "+p),(s.icon&&s.icon!==!0||s.icon===!1)&&(s.icon===!1?t.childNodes[1].childNodes[0].className+=" jstree-themeicon-hidden":s.icon.indexOf("/")===-1&&s.icon.indexOf(".")===-1?t.childNodes[1].childNodes[0].className+=" "+s.icon+" jstree-themeicon-custom":(t.childNodes[1].childNodes[0].style.backgroundImage='url("'+s.icon+'")',t.childNodes[1].childNodes[0].style.backgroundPosition="center center",t.childNodes[1].childNodes[0].style.backgroundSize="auto",t.childNodes[1].childNodes[0].className+=" jstree-themeicon-custom")),this.settings.core.force_text?t.childNodes[1].appendChild(g.createTextNode(s.name)):t.childNodes[1].innerHTML+=s.name,n&&s.children.length&&(s.state.opened||r)&&s.state.loaded){for(f=g.createElement("UL"),f.setAttribute("role","group"),f.className="jstree-children",d=0,u=s.children.length;d<u;d++)f.appendChild(this.redraw_node(s.children[d],n,!0));t.appendChild(f)}if(l&&t.appendChild(l),!i){for(a||(a=this.element[0]),d=0,u=a.childNodes.length;d<u;d++)if(a.childNodes[d]&&a.childNodes[d].className&&a.childNodes[d].className.indexOf("jstree-children")!==-1){y=a.childNodes[d];break}y||(y=g.createElement("UL"),y.setAttribute("role","group"),y.className="jstree-children",a.appendChild(y)),a=y,o<a.childNodes.length?a.insertBefore(t,a.childNodes[o]):a.appendChild(t),m&&(v=this.element[0].scrollTop,x=this.element[0].scrollLeft,t.childNodes[1].focus(),this.element[0].scrollTop=v,this.element[0].scrollLeft=x)}return s.state.opened&&!s.state.loaded&&(s.state.opened=!1,setTimeout(e.proxy(function(){this.open_node(s.id,!1,0)},this),0)),t},open_node:function(n,i,r){var s,a,o,l;if(e.isArray(n)){for(n=n.slice(),s=0,a=n.length;s<a;s++)this.open_node(n[s],i,r);return!0}return n=this.get_node(n),!(!n||n.id===e.jstree.root)&&(r=r===t?this.settings.core.animation:r,this.is_closed(n)?this.is_loaded(n)?(o=this.get_node(n,!0),l=this,o.length&&(r&&o.children(".jstree-children").length&&o.children(".jstree-children").stop(!0,!0),n.children.length&&!this._firstChild(o.children(".jstree-children")[0])&&this.draw_children(n),r?(this.trigger("before_open",{node:n}),o.children(".jstree-children").css("display","none").end().removeClass("jstree-closed").addClass("jstree-open").attr("aria-expanded",!0).children(".jstree-children").stop(!0,!0).slideDown(r,function(){this.style.display="",l.element&&l.trigger("after_open",{node:n})})):(this.trigger("before_open",{node:n}),o[0].className=o[0].className.replace("jstree-closed","jstree-open"),o[0].setAttribute("aria-expanded",!0))),n.state.opened=!0,i&&i.call(this,n,!0),o.length||this.trigger("before_open",{node:n}),this.trigger("open_node",{node:n}),r&&o.length||this.trigger("after_open",{node:n}),!0):this.is_loading(n)?setTimeout(e.proxy(function(){this.open_node(n,i,r)},this),500):void this.load_node(n,function(e,t){return t?this.open_node(e,i,r):!!i&&i.call(this,e,!1)}):(i&&i.call(this,n,!1),!1))},_open_to:function(t){if(t=this.get_node(t),!t||t.id===e.jstree.root)return!1;var n,i,r=t.parents;for(n=0,i=r.length;n<i;n+=1)n!==e.jstree.root&&this.open_node(r[n],!1,0);return e("#"+t.id.replace(e.jstree.idregex,"\\$&"),this.element)},close_node:function(n,i){var r,s,a,o;if(e.isArray(n)){for(n=n.slice(),r=0,s=n.length;r<s;r++)this.close_node(n[r],i);return!0}return n=this.get_node(n),!(!n||n.id===e.jstree.root)&&(!this.is_closed(n)&&(i=i===t?this.settings.core.animation:i,a=this,o=this.get_node(n,!0),n.state.opened=!1,this.trigger("close_node",{node:n}),void(o.length?i?o.children(".jstree-children").attr("style","display:block !important").end().removeClass("jstree-open").addClass("jstree-closed").attr("aria-expanded",!1).children(".jstree-children").stop(!0,!0).slideUp(i,function(){this.style.display="",o.children(".jstree-children").remove(),a.element&&a.trigger("after_close",{node:n})}):(o[0].className=o[0].className.replace("jstree-open","jstree-closed"),o.attr("aria-expanded",!1).children(".jstree-children").remove(),this.trigger("after_close",{node:n})):this.trigger("after_close",{node:n}))))},toggle_node:function(t){var n,i;if(e.isArray(t)){for(t=t.slice(),n=0,i=t.length;n<i;n++)this.toggle_node(t[n]);return!0}return this.is_closed(t)?this.open_node(t):this.is_open(t)?this.close_node(t):void 0},open_all:function(t,n,i){if(t||(t=e.jstree.root),t=this.get_node(t),!t)return!1;var r,s,a,o=t.id===e.jstree.root?this.get_container_ul():this.get_node(t,!0);if(!o.length){for(r=0,s=t.children_d.length;r<s;r++)this.is_closed(this._model.data[t.children_d[r]])&&(this._model.data[t.children_d[r]].state.opened=!0);return this.trigger("open_all",{node:t})}i=i||o,a=this,o=this.is_closed(t)?o.find(".jstree-closed").addBack():o.find(".jstree-closed"),o.each(function(){a.open_node(this,function(e,t){t&&this.is_parent(e)&&this.open_all(e,n,i)},n||0)}),0===i.find(".jstree-closed").length&&this.trigger("open_all",{node:this.get_node(i)})},close_all:function(t,n){if(t||(t=e.jstree.root),t=this.get_node(t),!t)return!1;var i,r,s=t.id===e.jstree.root?this.get_container_ul():this.get_node(t,!0),a=this;for(s.length&&(s=this.is_open(t)?s.find(".jstree-open").addBack():s.find(".jstree-open"),e(s.get().reverse()).each(function(){a.close_node(this,n||0)})),i=0,r=t.children_d.length;i<r;i++)this._model.data[t.children_d[i]].state.opened=!1;this.trigger("close_all",{node:t})},is_disabled:function(e){return e=this.get_node(e),e&&e.state&&e.state.disabled},enable_node:function(t){var n,i;if(e.isArray(t)){for(t=t.slice(),n=0,i=t.length;n<i;n++)this.enable_node(t[n]);return!0}return t=this.get_node(t),!(!t||t.id===e.jstree.root)&&(t.state.disabled=!1,this.get_node(t,!0).children(".jstree-anchor").removeClass("jstree-disabled").attr("aria-disabled",!1),void this.trigger("enable_node",{node:t}))},disable_node:function(t){var n,i;if(e.isArray(t)){for(t=t.slice(),n=0,i=t.length;n<i;n++)this.disable_node(t[n]);return!0}return t=this.get_node(t),!(!t||t.id===e.jstree.root)&&(t.state.disabled=!0,this.get_node(t,!0).children(".jstree-anchor").addClass("jstree-disabled").attr("aria-disabled",!0),void this.trigger("disable_node",{node:t}))},is_hidden:function(e){return e=this.get_node(e),e.state.hidden===!0},hide_node:function(t,n){var i,r;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;i<r;i++)this.hide_node(t[i],!0);return n||this.redraw(),!0}return t=this.get_node(t),!(!t||t.id===e.jstree.root)&&void(t.state.hidden||(t.state.hidden=!0,this._node_changed(t.parent),n||this.redraw(),this.trigger("hide_node",{node:t})))},show_node:function(t,n){var i,r;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;i<r;i++)this.show_node(t[i],!0);return n||this.redraw(),!0}return t=this.get_node(t),!(!t||t.id===e.jstree.root)&&void(t.state.hidden&&(t.state.hidden=!1,this._node_changed(t.parent),n||this.redraw(),this.trigger("show_node",{node:t})))},hide_all:function(t){var n,i=this._model.data,r=[];for(n in i)i.hasOwnProperty(n)&&n!==e.jstree.root&&!i[n].state.hidden&&(i[n].state.hidden=!0,r.push(n));return this._model.force_full_redraw=!0,t||this.redraw(),this.trigger("hide_all",{nodes:r}),r},show_all:function(t){var n,i=this._model.data,r=[];for(n in i)i.hasOwnProperty(n)&&n!==e.jstree.root&&i[n].state.hidden&&(i[n].state.hidden=!1,r.push(n));return this._model.force_full_redraw=!0,t||this.redraw(),this.trigger("show_all",{nodes:r}),r},activate_node:function(e,n){if(this.is_disabled(e))return!1;if(n&&"object"==typeof n||(n={}),this._data.core.last_clicked=this._data.core.last_clicked&&this._data.core.last_clicked.id!==t?this.get_node(this._data.core.last_clicked.id):null,this._data.core.last_clicked&&!this._data.core.last_clicked.state.selected&&(this._data.core.last_clicked=null),!this._data.core.last_clicked&&this._data.core.selected.length&&(this._data.core.last_clicked=this.get_node(this._data.core.selected[this._data.core.selected.length-1])),this.settings.core.multiple&&(n.metaKey||n.ctrlKey||n.shiftKey)&&(!n.shiftKey||this._data.core.last_clicked&&this.get_parent(e)&&this.get_parent(e)===this._data.core.last_clicked.parent))if(n.shiftKey){var i,r,s=this.get_node(e).id,a=this._data.core.last_clicked.id,o=this.get_node(this._data.core.last_clicked.parent).children,l=!1;for(i=0,r=o.length;i<r;i+=1)o[i]===s&&(l=!l),o[i]===a&&(l=!l),this.is_disabled(o[i])||!l&&o[i]!==s&&o[i]!==a?this.deselect_node(o[i],!0,n):this.is_hidden(o[i])||this.select_node(o[i],!0,!1,n);this.trigger("changed",{action:"select_node",node:this.get_node(e),selected:this._data.core.selected,event:n})}else this.is_selected(e)?this.deselect_node(e,!1,n):this.select_node(e,!1,!1,n);else!this.settings.core.multiple&&(n.metaKey||n.ctrlKey||n.shiftKey)&&this.is_selected(e)?this.deselect_node(e,!1,n):(this.deselect_all(!0),this.select_node(e,!1,!1,n),this._data.core.last_clicked=this.get_node(e));this.trigger("activate_node",{node:this.get_node(e),event:n})},hover_node:function(e){if(e=this.get_node(e,!0),!e||!e.length||e.children(".jstree-hovered").length)return!1;var t=this.element.find(".jstree-hovered"),n=this.element;t&&t.length&&this.dehover_node(t),e.children(".jstree-anchor").addClass("jstree-hovered"),this.trigger("hover_node",{node:this.get_node(e)}),setTimeout(function(){n.attr("aria-activedescendant",e[0].id)},0)},dehover_node:function(e){return e=this.get_node(e,!0),!!(e&&e.length&&e.children(".jstree-hovered").length)&&(e.children(".jstree-anchor").removeClass("jstree-hovered"),void this.trigger("dehover_node",{node:this.get_node(e)}))},select_node:function(t,n,i,r){var s,a,o;if(e.isArray(t)){for(t=t.slice(),a=0,o=t.length;a<o;a++)this.select_node(t[a],n,i,r);return!0}return t=this.get_node(t),!(!t||t.id===e.jstree.root)&&(s=this.get_node(t,!0),void(t.state.selected||(t.state.selected=!0,this._data.core.selected.push(t.id),i||(s=this._open_to(t)),s&&s.length&&s.attr("aria-selected",!0).children(".jstree-anchor").addClass("jstree-clicked"),this.trigger("select_node",{node:t,selected:this._data.core.selected,event:r}),n||this.trigger("changed",{action:"select_node",node:t,selected:this._data.core.selected,event:r}))))},deselect_node:function(t,n,i){var r,s,a;if(e.isArray(t)){for(t=t.slice(),r=0,s=t.length;r<s;r++)this.deselect_node(t[r],n,i);return!0}return t=this.get_node(t),!(!t||t.id===e.jstree.root)&&(a=this.get_node(t,!0),void(t.state.selected&&(t.state.selected=!1,this._data.core.selected=e.vakata.array_remove_item(this._data.core.selected,t.id),a.length&&a.attr("aria-selected",!1).children(".jstree-anchor").removeClass("jstree-clicked"),this.trigger("deselect_node",{node:t,selected:this._data.core.selected,event:i}),n||this.trigger("changed",{action:"deselect_node",node:t,selected:this._data.core.selected,event:i}))))},select_all:function(t){var n,i,r=this._data.core.selected.concat([]);for(this._data.core.selected=this._model.data[e.jstree.root].children_d.concat(),n=0,i=this._data.core.selected.length;n<i;n++)this._model.data[this._data.core.selected[n]]&&(this._model.data[this._data.core.selected[n]].state.selected=!0);this.redraw(!0),this.trigger("select_all",{selected:this._data.core.selected}),t||this.trigger("changed",{action:"select_all",selected:this._data.core.selected,old_selection:r})},deselect_all:function(e){var t,n,i=this._data.core.selected.concat([]);for(t=0,n=this._data.core.selected.length;t<n;t++)this._model.data[this._data.core.selected[t]]&&(this._model.data[this._data.core.selected[t]].state.selected=!1);this._data.core.selected=[],this.element.find(".jstree-clicked").removeClass("jstree-clicked").parent().attr("aria-selected",!1),this.trigger("deselect_all",{selected:this._data.core.selected,node:i}),e||this.trigger("changed",{action:"deselect_all",selected:this._data.core.selected,old_selection:i})},is_selected:function(t){return t=this.get_node(t),!(!t||t.id===e.jstree.root)&&t.state.selected},get_selected:function(t){return t?e.map(this._data.core.selected,e.proxy(function(e){return this.get_node(e)},this)):this._data.core.selected.slice()},get_top_selected:function(t){var n,i,r,s,a=this.get_selected(!0),o={};for(n=0,i=a.length;n<i;n++)o[a[n].id]=a[n];for(n=0,i=a.length;n<i;n++)for(r=0,s=a[n].children_d.length;r<s;r++)o[a[n].children_d[r]]&&delete o[a[n].children_d[r]];a=[];for(n in o)o.hasOwnProperty(n)&&a.push(n);return t?e.map(a,e.proxy(function(e){return this.get_node(e)},this)):a},get_bottom_selected:function(t){var n,i,r=this.get_selected(!0),s=[];for(n=0,i=r.length;n<i;n++)r[n].children.length||s.push(r[n].id);return t?e.map(s,e.proxy(function(e){return this.get_node(e)},this)):s},get_state:function(){var t,n={core:{open:[],scroll:{left:this.element.scrollLeft(),top:this.element.scrollTop()},selected:[]}};for(t in this._model.data)this._model.data.hasOwnProperty(t)&&t!==e.jstree.root&&(this._model.data[t].state.opened&&n.core.open.push(t),this._model.data[t].state.selected&&n.core.selected.push(t));return n},set_state:function(n,i){if(n){if(n.core){var r,s;if(n.core.open)return e.isArray(n.core.open)&&n.core.open.length?this._load_nodes(n.core.open,function(e){this.open_node(e,!1,0),delete n.core.open,this.set_state(n,i)}):(delete n.core.open,this.set_state(n,i)),!1;if(n.core.scroll)return n.core.scroll&&n.core.scroll.left!==t&&this.element.scrollLeft(n.core.scroll.left),n.core.scroll&&n.core.scroll.top!==t&&this.element.scrollTop(n.core.scroll.top),delete n.core.scroll,this.set_state(n,i),!1;if(n.core.selected)return r=this,this.deselect_all(),e.each(n.core.selected,function(e,t){r.select_node(t,!1,!0)}),delete n.core.selected,this.set_state(n,i),!1;for(s in n)n.hasOwnProperty(s)&&"core"!==s&&e.inArray(s,this.settings.plugins)===-1&&delete n[s];if(e.isEmptyObject(n.core))return delete n.core,this.set_state(n,i),!1}return!e.isEmptyObject(n)||(n=null,i&&i.call(this),this.trigger("set_state"),!1)}return!1},refresh:function(t,n){this._data.core.state=n===!0?{}:this.get_state(),n&&e.isFunction(n)&&(this._data.core.state=n.call(this,this._data.core.state)),this._cnt=0,this._model.data={},this._model.data[e.jstree.root]={id:e.jstree.root,parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}},this._data.core.selected=[],this._data.core.last_clicked=null,this._data.core.focused=null;var i=this.get_container_ul()[0].className;t||(this.element.html("<ul class='"+i+"' role='group'><li class='jstree-initial-node jstree-loading jstree-leaf jstree-last' role='treeitem' id='j"+this._id+"_loading'><i class='jstree-icon jstree-ocl'></i><a class='jstree-anchor' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+this.get_string("Loading ...")+"</a></li></ul>"),this.element.attr("aria-activedescendant","j"+this._id+"_loading")),this.load_node(e.jstree.root,function(t,n){n&&(this.get_container_ul()[0].className=i,this._firstChild(this.get_container_ul()[0])&&this.element.attr("aria-activedescendant",this._firstChild(this.get_container_ul()[0]).id),this.set_state(e.extend(!0,{},this._data.core.state),function(){this.trigger("refresh")})),this._data.core.state=null})},refresh_node:function(t){if(t=this.get_node(t),!t||t.id===e.jstree.root)return!1;var n=[],i=[],r=this._data.core.selected.concat([]);i.push(t.id),t.state.opened===!0&&n.push(t.id),this.get_node(t,!0).find(".jstree-open").each(function(){i.push(this.id),n.push(this.id)}),this._load_nodes(i,e.proxy(function(e){this.open_node(n,!1,0),this.select_node(r),this.trigger("refresh_node",{node:t,nodes:e})},this),!1,!0)},set_id:function(t,n){if(t=this.get_node(t),!t||t.id===e.jstree.root)return!1;var i,r,s=this._model.data,a=t.id;for(n=n.toString(),s[t.parent].children[e.inArray(t.id,s[t.parent].children)]=n,i=0,r=t.parents.length;i<r;i++)s[t.parents[i]].children_d[e.inArray(t.id,s[t.parents[i]].children_d)]=n;for(i=0,r=t.children.length;i<r;i++)s[t.children[i]].parent=n;for(i=0,r=t.children_d.length;i<r;i++)s[t.children_d[i]].parents[e.inArray(t.id,s[t.children_d[i]].parents)]=n;return i=e.inArray(t.id,this._data.core.selected),i!==-1&&(this._data.core.selected[i]=n),i=this.get_node(t.id,!0),i&&(i.attr("id",n),this.element.attr("aria-activedescendant")===t.id&&this.element.attr("aria-activedescendant",n)),delete s[t.id],t.id=n,t.li_attr.id=n,s[n]=t,this.trigger("set_id",{node:t,"new":t.id,old:a}),!0},get_text:function(t){return t=this.get_node(t),!(!t||t.id===e.jstree.root)&&t.name},set_text:function(t,n){var i,r;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;i<r;i++)this.set_text(t[i],n);return!0}return t=this.get_node(t),!(!t||t.id===e.jstree.root)&&(t.name=n,this.get_node(t,!0).length&&this.redraw_node(t.id),this.trigger("set_text",{obj:t,name:n}),!0)},get_json:function(t,n,i){if(t=this.get_node(t||e.jstree.root),!t)return!1;n&&n.flat&&!i&&(i=[]);var r,s,a={id:t.id,name:t.name,icon:this.get_icon(t),li_attr:e.extend(!0,{},t.li_attr),a_attr:e.extend(!0,{},t.a_attr),state:{},data:(!n||!n.no_data)&&e.extend(!0,{},t.data)};if(n&&n.flat?a.parent=t.parent:a.children=[],n&&n.no_state)delete a.state;else for(r in t.state)t.state.hasOwnProperty(r)&&(a.state[r]=t.state[r]);if(n&&n.no_li_attr&&delete a.li_attr,n&&n.no_a_attr&&delete a.a_attr,n&&n.no_id&&(delete a.id,a.li_attr&&a.li_attr.id&&delete a.li_attr.id,a.a_attr&&a.a_attr.id&&delete a.a_attr.id),n&&n.flat&&t.id!==e.jstree.root&&i.push(a),!n||!n.no_children)for(r=0,s=t.children.length;r<s;r++)n&&n.flat?this.get_json(t.children[r],n,i):a.children.push(this.get_json(t.children[r],n));return n&&n.flat?i:t.id===e.jstree.root?a.children:a},create_node:function(n,i,r,s,a){if(null===n&&(n=e.jstree.root),n=this.get_node(n),!n)return!1;if(r=r===t?"last":r,!r.toString().match(/^(before|after)$/)&&!a&&!this.is_loaded(n))return this.load_node(n,function(){this.create_node(n,i,r,s,!0)});i||(i={name:this.get_string("New node")}),"string"==typeof i&&(i={name:i}),i.name===t&&(i.name=this.get_string("New node"));var o,l,d,c;switch(n.id===e.jstree.root&&("before"===r&&(r="first"),"after"===r&&(r="last")),r){case"before":o=this.get_node(n.parent),r=e.inArray(n.id,o.children),n=o;break;case"after":o=this.get_node(n.parent),r=e.inArray(n.id,o.children)+1,n=o;break;case"inside":case"first":r=0;break;case"last":r=n.children.length;break;default:r||(r=0)}if(r>n.children.length&&(r=n.children.length),i.id||(i.id=!0),!this.check("create_node",i,n,r))return this.settings.core.error.call(this,this._data.core.last_error),
!1;if(i.id===!0&&delete i.id,i=this._parse_model_from_json(i,n.id,n.parents.concat()),!i)return!1;for(o=this.get_node(i),l=[],l.push(i),l=l.concat(o.children_d),this.trigger("model",{nodes:l,parent:n.id}),n.children_d=n.children_d.concat(l),d=0,c=n.parents.length;d<c;d++)this._model.data[n.parents[d]].children_d=this._model.data[n.parents[d]].children_d.concat(l);for(i=o,o=[],d=0,c=n.children.length;d<c;d++)o[d>=r?d+1:d]=n.children[d];return o[r]=i.id,n.children=o,this.redraw_node(n,!0),s&&s.call(this,this.get_node(i)),this.trigger("create_node",{node:this.get_node(i),parent:n.id,position:r}),i.id},rename_node:function(t,n){var i,r,s;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;i<r;i++)this.rename_node(t[i],n);return!0}return t=this.get_node(t),!(!t||t.id===e.jstree.root)&&(s=t.name,this.check("rename_node",t,this.get_parent(t),n)?(this.set_text(t,n),this.trigger("rename_node",{node:t,name:n,old:s}),!0):(this.settings.core.error.call(this,this._data.core.last_error),!1))},delete_node:function(t){var n,i,r,s,a,o,l,d,c,h,u,f;if(e.isArray(t)){for(t=t.slice(),n=0,i=t.length;n<i;n++)this.delete_node(t[n]);return!0}if(t=this.get_node(t),!t||t.id===e.jstree.root)return!1;if(r=this.get_node(t.parent),s=e.inArray(t.id,r.children),h=!1,!this.check("delete_node",t,r,s))return this.settings.core.error.call(this,this._data.core.last_error),!1;for(s!==-1&&(r.children=e.vakata.array_remove(r.children,s)),a=t.children_d.concat([]),a.push(t.id),o=0,l=t.parents.length;o<l;o++)this._model.data[t.parents[o]].children_d=e.vakata.array_filter(this._model.data[t.parents[o]].children_d,function(t){return e.inArray(t,a)===-1});for(d=0,c=a.length;d<c;d++)if(this._model.data[a[d]].state.selected){h=!0;break}for(h&&(this._data.core.selected=e.vakata.array_filter(this._data.core.selected,function(t){return e.inArray(t,a)===-1})),this.trigger("delete_node",{node:t,parent:r.id}),h&&this.trigger("changed",{action:"delete_node",node:t,selected:this._data.core.selected,parent:r.id}),d=0,c=a.length;d<c;d++)delete this._model.data[a[d]];return e.inArray(this._data.core.focused,a)!==-1&&(this._data.core.focused=null,u=this.element[0].scrollTop,f=this.element[0].scrollLeft,r.id===e.jstree.root?this._model.data[e.jstree.root].children[0]&&this.get_node(this._model.data[e.jstree.root].children[0],!0).children(".jstree-anchor").focus():this.get_node(r,!0).children(".jstree-anchor").focus(),this.element[0].scrollTop=u,this.element[0].scrollLeft=f),this.redraw_node(r,!0),!0},check:function(t,n,i,r,s){n=n&&n.id?n:this.get_node(n),i=i&&i.id?i:this.get_node(i);var a=t.match(/^move_node|copy_node|create_node$/i)?i:n,o=this.settings.core.check_callback;return"move_node"!==t&&"copy_node"!==t||s&&s.is_multi||n.id!==i.id&&("move_node"!==t||e.inArray(n.id,i.children)!==r)&&e.inArray(i.id,n.children_d)===-1?(a&&a.data&&(a=a.data),a&&a.functions&&(a.functions[t]===!1||a.functions[t]===!0)?(a.functions[t]===!1&&(this._data.core.last_error={error:"check",plugin:"core",id:"core_02",reason:"Node data prevents function: "+t,data:JSON.stringify({chk:t,pos:r,obj:!(!n||!n.id)&&n.id,par:!(!i||!i.id)&&i.id})}),a.functions[t]):!(o===!1||e.isFunction(o)&&o.call(this,t,n,i,r,s)===!1||o&&o[t]===!1)||(this._data.core.last_error={error:"check",plugin:"core",id:"core_03",reason:"User config for core.check_callback prevents function: "+t,data:JSON.stringify({chk:t,pos:r,obj:!(!n||!n.id)&&n.id,par:!(!i||!i.id)&&i.id})},!1)):(this._data.core.last_error={error:"check",plugin:"core",id:"core_01",reason:"Moving parent inside child",data:JSON.stringify({chk:t,pos:r,obj:!(!n||!n.id)&&n.id,par:!(!i||!i.id)&&i.id})},!1)},last_error:function(){return this._data.core.last_error},move_node:function(n,i,r,s,a,o,l){var d,c,h,u,f,p,g,_,m,y,v,x,b,k;if(i=this.get_node(i),r=r===t?0:r,!i)return!1;if(!r.toString().match(/^(before|after)$/)&&!a&&!this.is_loaded(i))return this.load_node(i,function(){this.move_node(n,i,r,s,!0,!1,l)});if(e.isArray(n)){if(1!==n.length){for(d=0,c=n.length;d<c;d++)(m=this.move_node(n[d],i,r,s,a,!1,l))&&(i=m,r="after");return this.redraw(),!0}n=n[0]}if(n=n&&n.id?n:this.get_node(n),!n||n.id===e.jstree.root)return!1;if(h=(n.parent||e.jstree.root).toString(),f=r.toString().match(/^(before|after)$/)&&i.id!==e.jstree.root?this.get_node(i.parent):i,p=l?l:this._model.data[n.id]?this:e.jstree.reference(n.id),g=!p||!p._id||this._id!==p._id,u=p&&p._id&&h&&p._model.data[h]&&p._model.data[h].children?e.inArray(n.id,p._model.data[h].children):-1,p&&p._id&&(n=p._model.data[n.id]),g)return!!(m=this.copy_node(n,i,r,s,a,!1,l))&&(p&&p.delete_node(n),m);switch(i.id===e.jstree.root&&("before"===r&&(r="first"),"after"===r&&(r="last")),r){case"before":r=e.inArray(i.id,f.children);break;case"after":r=e.inArray(i.id,f.children)+1;break;case"inside":case"first":r=0;break;case"last":r=f.children.length;break;default:r||(r=0)}if(r>f.children.length&&(r=f.children.length),!this.check("move_node",n,f,r,{core:!0,origin:l,is_multi:p&&p._id&&p._id!==this._id,is_foreign:!p||!p._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(n.parent===f.id){for(_=f.children.concat(),m=e.inArray(n.id,_),m!==-1&&(_=e.vakata.array_remove(_,m),r>m&&r--),m=[],y=0,v=_.length;y<v;y++)m[y>=r?y+1:y]=_[y];m[r]=n.id,f.children=m,this._node_changed(f.id),this.redraw(f.id===e.jstree.root)}else{for(m=n.children_d.concat(),m.push(n.id),y=0,v=n.parents.length;y<v;y++){for(_=[],k=p._model.data[n.parents[y]].children_d,x=0,b=k.length;x<b;x++)e.inArray(k[x],m)===-1&&_.push(k[x]);p._model.data[n.parents[y]].children_d=_}for(p._model.data[h].children=e.vakata.array_remove_item(p._model.data[h].children,n.id),y=0,v=f.parents.length;y<v;y++)this._model.data[f.parents[y]].children_d=this._model.data[f.parents[y]].children_d.concat(m);for(_=[],y=0,v=f.children.length;y<v;y++)_[y>=r?y+1:y]=f.children[y];for(_[r]=n.id,f.children=_,f.children_d.push(n.id),f.children_d=f.children_d.concat(n.children_d),n.parent=f.id,m=f.parents.concat(),m.unshift(f.id),k=n.parents.length,n.parents=m,m=m.concat(),y=0,v=n.children_d.length;y<v;y++)this._model.data[n.children_d[y]].parents=this._model.data[n.children_d[y]].parents.slice(0,k*-1),Array.prototype.push.apply(this._model.data[n.children_d[y]].parents,m);h!==e.jstree.root&&f.id!==e.jstree.root||(this._model.force_full_redraw=!0),this._model.force_full_redraw||(this._node_changed(h),this._node_changed(f.id)),o||this.redraw()}return s&&s.call(this,n,f,r),this.trigger("move_node",{node:n,parent:f.id,position:r,old_parent:h,old_position:u,is_multi:p&&p._id&&p._id!==this._id,is_foreign:!p||!p._id,old_instance:p,new_instance:this}),n.id},copy_node:function(n,i,r,s,a,o,l){var d,c,h,u,f,p,g,_,m,y,v;if(i=this.get_node(i),r=r===t?0:r,!i)return!1;if(!r.toString().match(/^(before|after)$/)&&!a&&!this.is_loaded(i))return this.load_node(i,function(){this.copy_node(n,i,r,s,!0,!1,l)});if(e.isArray(n)){if(1!==n.length){for(d=0,c=n.length;d<c;d++)(u=this.copy_node(n[d],i,r,s,a,!0,l))&&(i=u,r="after");return this.redraw(),!0}n=n[0]}if(n=n&&n.id?n:this.get_node(n),!n||n.id===e.jstree.root)return!1;switch(_=(n.parent||e.jstree.root).toString(),m=r.toString().match(/^(before|after)$/)&&i.id!==e.jstree.root?this.get_node(i.parent):i,y=l?l:this._model.data[n.id]?this:e.jstree.reference(n.id),v=!y||!y._id||this._id!==y._id,y&&y._id&&(n=y._model.data[n.id]),i.id===e.jstree.root&&("before"===r&&(r="first"),"after"===r&&(r="last")),r){case"before":r=e.inArray(i.id,m.children);break;case"after":r=e.inArray(i.id,m.children)+1;break;case"inside":case"first":r=0;break;case"last":r=m.children.length;break;default:r||(r=0)}if(r>m.children.length&&(r=m.children.length),!this.check("copy_node",n,m,r,{core:!0,origin:l,is_multi:y&&y._id&&y._id!==this._id,is_foreign:!y||!y._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(g=y?y.get_json(n,{no_id:!0,no_data:!0,no_state:!0}):n,!g)return!1;if(g.id===!0&&delete g.id,g=this._parse_model_from_json(g,m.id,m.parents.concat()),!g)return!1;for(u=this.get_node(g),n&&n.state&&n.state.loaded===!1&&(u.state.loaded=!1),h=[],h.push(g),h=h.concat(u.children_d),this.trigger("model",{nodes:h,parent:m.id}),f=0,p=m.parents.length;f<p;f++)this._model.data[m.parents[f]].children_d=this._model.data[m.parents[f]].children_d.concat(h);for(h=[],f=0,p=m.children.length;f<p;f++)h[f>=r?f+1:f]=m.children[f];return h[r]=u.id,m.children=h,m.children_d.push(u.id),m.children_d=m.children_d.concat(u.children_d),m.id===e.jstree.root&&(this._model.force_full_redraw=!0),this._model.force_full_redraw||this._node_changed(m.id),o||this.redraw(m.id===e.jstree.root),s&&s.call(this,u,m,r),this.trigger("copy_node",{node:u,original:n,parent:m.id,position:r,old_parent:_,old_position:y&&y._id&&_&&y._model.data[_]&&y._model.data[_].children?e.inArray(n.id,y._model.data[_].children):-1,is_multi:y&&y._id&&y._id!==this._id,is_foreign:!y||!y._id,old_instance:y,new_instance:this}),u.id},cut:function(t){if(t||(t=this._data.core.selected.concat()),e.isArray(t)||(t=[t]),!t.length)return!1;var n,i,r,l=[];for(i=0,r=t.length;i<r;i++)n=this.get_node(t[i]),n&&n.id&&n.id!==e.jstree.root&&l.push(n);return!!l.length&&(s=l,o=this,a="move_node",void this.trigger("cut",{node:t}))},copy:function(t){if(t||(t=this._data.core.selected.concat()),e.isArray(t)||(t=[t]),!t.length)return!1;var n,i,r,l=[];for(i=0,r=t.length;i<r;i++)n=this.get_node(t[i]),n&&n.id&&n.id!==e.jstree.root&&l.push(n);return!!l.length&&(s=l,o=this,a="copy_node",void this.trigger("copy",{node:t}))},get_buffer:function(){return{mode:a,node:s,inst:o}},can_paste:function(){return a!==!1&&s!==!1},paste:function(e,t){return e=this.get_node(e),!!(e&&a&&a.match(/^(copy_node|move_node)$/)&&s)&&(this[a](s,e,t,!1,!1,!1,o)&&this.trigger("paste",{parent:e.id,node:s,mode:a}),s=!1,a=!1,void(o=!1))},clear_buffer:function(){s=!1,a=!1,o=!1,this.trigger("clear_buffer")},edit:function(t,n,i){var r,s,a,o,l,d,h,u,f,p=!1;return!!(t=this.get_node(t))&&(this.settings.core.check_callback===!1?(this._data.core.last_error={error:"check",plugin:"core",id:"core_07",reason:"Could not edit node because of check_callback"},this.settings.core.error.call(this,this._data.core.last_error),!1):(f=t,n="string"==typeof n?n:t.name,this.set_text(t,""),t=this._open_to(t),f.name=n,r=this._data.core.rtl,s=this.element.width(),this._data.core.focused=f.id,a=t.children(".jstree-anchor").focus(),o=e("<span>"),l=n,d=e("<div />",{css:{position:"absolute",top:"-200px",left:r?"0px":"-1000px",visibility:"hidden"}}).appendTo("body"),h=e("<input />",{value:l,"class":"jstree-rename-input",css:{padding:"0",border:"1px solid silver","box-sizing":"border-box",display:"inline-block",height:this._data.core.li_height+"px",lineHeight:this._data.core.li_height+"px",width:"150px"},blur:e.proxy(function(n){n.stopImmediatePropagation(),n.preventDefault();var r,s=o.children(".jstree-rename-input"),c=s.val(),u=this.settings.core.force_text;""===c&&(c=l),d.remove(),o.replaceWith(a),o.remove(),l=u?l:e("<div></div>").append(e.parseHTML(l)).html(),this.set_text(t,l),r=!!this.rename_node(t,u?e("<div></div>").name(c).name():e("<div></div>").append(e.parseHTML(c)).html()),r||this.set_text(t,l),this._data.core.focused=f.id,setTimeout(e.proxy(function(){var e=this.get_node(f.id,!0);e.length&&(this._data.core.focused=f.id,e.children(".jstree-anchor").focus())},this),0),i&&i.call(this,f,r,p),h=null},this),keydown:function(e){var t=e.which;27===t&&(p=!0,this.value=l),27!==t&&13!==t&&37!==t&&38!==t&&39!==t&&40!==t&&32!==t||e.stopImmediatePropagation(),27!==t&&13!==t||(e.preventDefault(),this.blur())},click:function(e){e.stopImmediatePropagation()},mousedown:function(e){e.stopImmediatePropagation()},keyup:function(){h.width(Math.min(d.name("pW"+this.value).width(),s))},keypress:function(e){if(13===e.which)return!1}}),u={fontFamily:a.css("fontFamily")||"",fontSize:a.css("fontSize")||"",fontWeight:a.css("fontWeight")||"",fontStyle:a.css("fontStyle")||"",fontStretch:a.css("fontStretch")||"",fontVariant:a.css("fontVariant")||"",letterSpacing:a.css("letterSpacing")||"",wordSpacing:a.css("wordSpacing")||""},o.attr("class",a.attr("class")).append(a.contents().clone()).append(h),a.replaceWith(o),d.css(u),h.css(u).width(Math.min(d.name("pW"+h[0].value).width(),s))[0].select(),void e(c).one("mousedown.jstree touchstart.jstree dnd_start.vakata",function(t){h&&t.target!==h&&e(h).blur()})))},set_theme:function(t,n){if(!t)return!1;if(n===!0){var i=this.settings.core.themes.dir;i||(i=e.jstree.path+"/themes"),n=i+"/"+t+"/style.css"}n&&e.inArray(n,l)===-1&&(e("head").append('<link rel="stylesheet" href="'+n+'" type="name/css" />'),l.push(n)),this._data.core.themes.name&&this.element.removeClass("jstree-"+this._data.core.themes.name),this._data.core.themes.name=t,this.element.addClass("jstree-"+t),this.element[this.settings.core.themes.responsive?"addClass":"removeClass"]("jstree-"+t+"-responsive"),this.trigger("set_theme",{theme:t})},get_theme:function(){return this._data.core.themes.name},set_theme_variant:function(e){this._data.core.themes.variant&&this.element.removeClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant),this._data.core.themes.variant=e,e&&this.element.addClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant)},get_theme_variant:function(){return this._data.core.themes.variant},show_stripes:function(){this._data.core.themes.stripes=!0,this.get_container_ul().addClass("jstree-striped")},hide_stripes:function(){this._data.core.themes.stripes=!1,this.get_container_ul().removeClass("jstree-striped")},toggle_stripes:function(){this._data.core.themes.stripes?this.hide_stripes():this.show_stripes()},show_dots:function(){this._data.core.themes.dots=!0,this.get_container_ul().removeClass("jstree-no-dots")},hide_dots:function(){this._data.core.themes.dots=!1,this.get_container_ul().addClass("jstree-no-dots")},toggle_dots:function(){this._data.core.themes.dots?this.hide_dots():this.show_dots()},show_icons:function(){this._data.core.themes.icons=!0,this.get_container_ul().removeClass("jstree-no-icons")},hide_icons:function(){this._data.core.themes.icons=!1,this.get_container_ul().addClass("jstree-no-icons")},toggle_icons:function(){this._data.core.themes.icons?this.hide_icons():this.show_icons()},set_icon:function(n,i){var r,s,a,o;if(e.isArray(n)){for(n=n.slice(),r=0,s=n.length;r<s;r++)this.set_icon(n[r],i);return!0}return n=this.get_node(n),!(!n||n.id===e.jstree.root)&&(o=n.icon,n.icon=i===!0||null===i||i===t||""===i||i,a=this.get_node(n,!0).children(".jstree-anchor").children(".jstree-themeicon"),i===!1?this.hide_icon(n):i===!0||null===i||i===t||""===i?(a.removeClass("jstree-themeicon-custom "+o).css("background","").removeAttr("rel"),o===!1&&this.show_icon(n)):i.indexOf("/")===-1&&i.indexOf(".")===-1?(a.removeClass(o).css("background",""),a.addClass(i+" jstree-themeicon-custom").attr("rel",i),o===!1&&this.show_icon(n)):(a.removeClass(o).css("background",""),a.addClass("jstree-themeicon-custom").css("background","url('"+i+"') center center no-repeat").attr("rel",i),o===!1&&this.show_icon(n)),!0)},get_icon:function(t){return t=this.get_node(t),!(!t||t.id===e.jstree.root)&&t.icon},hide_icon:function(t){var n,i;if(e.isArray(t)){for(t=t.slice(),n=0,i=t.length;n<i;n++)this.hide_icon(t[n]);return!0}return t=this.get_node(t),!(!t||t===e.jstree.root)&&(t.icon=!1,this.get_node(t,!0).children(".jstree-anchor").children(".jstree-themeicon").addClass("jstree-themeicon-hidden"),!0)},show_icon:function(t){var n,i,r;if(e.isArray(t)){for(t=t.slice(),n=0,i=t.length;n<i;n++)this.show_icon(t[n]);return!0}return t=this.get_node(t),!(!t||t===e.jstree.root)&&(r=this.get_node(t,!0),t.icon=!r.length||r.children(".jstree-anchor").children(".jstree-themeicon").attr("rel"),t.icon||(t.icon=!0),r.children(".jstree-anchor").children(".jstree-themeicon").removeClass("jstree-themeicon-hidden"),!0)}},e.vakata={},e.vakata.attributes=function(t,n){t=e(t)[0];var i=n?{}:[];return t&&t.attributes&&e.each(t.attributes,function(t,r){e.inArray(r.name.toLowerCase(),["style","contenteditable","hasfocus","tabindex"])===-1&&null!==r.value&&""!==e.trim(r.value)&&(n?i[r.name]=r.value:i.push(r.name))}),i},e.vakata.array_unique=function(e){var n,i,r=[],s={};for(n=0,i=e.length;n<i;n++)s[e[n]]===t&&(r.push(e[n]),s[e[n]]=!0);return r},e.vakata.array_remove=function(e,t){return e.splice(t,1),e},e.vakata.array_remove_item=function(t,n){var i=e.inArray(n,t);return i!==-1?e.vakata.array_remove(t,i):t},e.vakata.array_filter=function(e,t,n,i,r){if(e.filter)return e.filter(t,n);i=[];for(r in e)~~r+""==r+""&&r>=0&&t.call(n,e[r],+r,e)&&i.push(e[r]);return i},e.jstree.plugins.changed=function(e,t){var n=[];this.trigger=function(e,i){var r,s;if(i||(i={}),"changed"===e.replace(".jstree","")){i.changed={selected:[],deselected:[]};var a={};for(r=0,s=n.length;r<s;r++)a[n[r]]=1;for(r=0,s=i.selected.length;r<s;r++)a[i.selected[r]]?a[i.selected[r]]=2:i.changed.selected.push(i.selected[r]);for(r=0,s=n.length;r<s;r++)1===a[n[r]]&&i.changed.deselected.push(n[r]);n=i.selected.slice()}t.trigger.call(this,e,i)},this.refresh=function(){return n=[],t.refresh.apply(this,arguments)}};var u=c.createElement("I");u.className="jstree-icon jstree-checkbox",u.setAttribute("role","presentation"),e.jstree.defaults.checkbox={visible:!0,three_state:!0,whole_node:!0,keep_selected_style:!0,cascade:"",tie_selection:!0},e.jstree.plugins.checkbox=function(n,i){this.bind=function(){i.bind.call(this),this._data.checkbox.uto=!1,this._data.checkbox.selected=[],this.settings.checkbox.three_state&&(this.settings.checkbox.cascade="up+down+undetermined"),this.element.on("init.jstree",e.proxy(function(){this._data.checkbox.visible=this.settings.checkbox.visible,this.settings.checkbox.keep_selected_style||this.element.addClass("jstree-checkbox-no-clicked"),this.settings.checkbox.tie_selection&&this.element.addClass("jstree-checkbox-selection")},this)).on("loading.jstree",e.proxy(function(){this[this._data.checkbox.visible?"show_checkboxes":"hide_checkboxes"]()},this)),this.settings.checkbox.cascade.indexOf("undetermined")!==-1&&this.element.on("changed.jstree uncheck_node.jstree check_node.jstree uncheck_all.jstree check_all.jstree move_node.jstree copy_node.jstree redraw.jstree open_node.jstree",e.proxy(function(){this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto),this._data.checkbox.uto=setTimeout(e.proxy(this._undetermined,this),50)},this)),this.settings.checkbox.tie_selection||this.element.on("model.jstree",e.proxy(function(e,t){var n,i,r=this._model.data,s=(r[t.parent],t.nodes);for(n=0,i=s.length;n<i;n++)r[s[n]].state.checked=r[s[n]].state.checked||r[s[n]].original&&r[s[n]].original.state&&r[s[n]].original.state.checked,r[s[n]].state.checked&&this._data.checkbox.selected.push(s[n])},this)),this.settings.checkbox.cascade.indexOf("up")===-1&&this.settings.checkbox.cascade.indexOf("down")===-1||this.element.on("model.jstree",e.proxy(function(t,n){var i,r,s,a,o,l,d=this._model.data,c=d[n.parent],h=n.nodes,u=[],f=this.settings.checkbox.cascade,p=this.settings.checkbox.tie_selection;if(f.indexOf("down")!==-1)if(c.state[p?"selected":"checked"]){for(r=0,s=h.length;r<s;r++)d[h[r]].state[p?"selected":"checked"]=!0;this._data[p?"core":"checkbox"].selected=this._data[p?"core":"checkbox"].selected.concat(h)}else for(r=0,s=h.length;r<s;r++)if(d[h[r]].state[p?"selected":"checked"]){for(a=0,o=d[h[r]].children_d.length;a<o;a++)d[d[h[r]].children_d[a]].state[p?"selected":"checked"]=!0;this._data[p?"core":"checkbox"].selected=this._data[p?"core":"checkbox"].selected.concat(d[h[r]].children_d)}if(f.indexOf("up")!==-1){for(r=0,s=c.children_d.length;r<s;r++)d[c.children_d[r]].children.length||u.push(d[c.children_d[r]].parent);for(u=e.vakata.array_unique(u),a=0,o=u.length;a<o;a++)for(c=d[u[a]];c&&c.id!==e.jstree.root;){for(i=0,r=0,s=c.children.length;r<s;r++)i+=d[c.children[r]].state[p?"selected":"checked"];if(i!==s)break;c.state[p?"selected":"checked"]=!0,this._data[p?"core":"checkbox"].selected.push(c.id),l=this.get_node(c,!0),l&&l.length&&l.attr("aria-selected",!0).children(".jstree-anchor").addClass(p?"jstree-clicked":"jstree-checked"),c=this.get_node(c.parent)}}this._data[p?"core":"checkbox"].selected=e.vakata.array_unique(this._data[p?"core":"checkbox"].selected)},this)).on(this.settings.checkbox.tie_selection?"select_node.jstree":"check_node.jstree",e.proxy(function(t,n){var i,r,s,a,o=n.node,l=this._model.data,d=this.get_node(o.parent),c=this.get_node(o,!0),h=this.settings.checkbox.cascade,u=this.settings.checkbox.tie_selection,f={},p=this._data[u?"core":"checkbox"].selected;for(i=0,r=p.length;i<r;i++)f[p[i]]=!0;if(h.indexOf("down")!==-1)for(i=0,r=o.children_d.length;i<r;i++)f[o.children_d[i]]=!0,a=l[o.children_d[i]],a.state[u?"selected":"checked"]=!0,a&&a.original&&a.original.state&&a.original.state.undetermined&&(a.original.state.undetermined=!1);if(h.indexOf("up")!==-1)for(;d&&d.id!==e.jstree.root;){for(s=0,i=0,r=d.children.length;i<r;i++)s+=l[d.children[i]].state[u?"selected":"checked"];if(s!==r)break;d.state[u?"selected":"checked"]=!0,f[d.id]=!0,a=this.get_node(d,!0),a&&a.length&&a.attr("aria-selected",!0).children(".jstree-anchor").addClass(u?"jstree-clicked":"jstree-checked"),d=this.get_node(d.parent)}p=[];for(i in f)f.hasOwnProperty(i)&&p.push(i);this._data[u?"core":"checkbox"].selected=p,h.indexOf("down")!==-1&&c.length&&c.find(".jstree-anchor").addClass(u?"jstree-clicked":"jstree-checked").parent().attr("aria-selected",!0)},this)).on(this.settings.checkbox.tie_selection?"deselect_all.jstree":"uncheck_all.jstree",e.proxy(function(){var t,n,i,r=this.get_node(e.jstree.root),s=this._model.data;for(t=0,n=r.children_d.length;t<n;t++)i=s[r.children_d[t]],i&&i.original&&i.original.state&&i.original.state.undetermined&&(i.original.state.undetermined=!1)},this)).on(this.settings.checkbox.tie_selection?"deselect_node.jstree":"uncheck_node.jstree",e.proxy(function(t,n){var i,r,s,a=n.node,o=this.get_node(a,!0),l=this.settings.checkbox.cascade,d=this.settings.checkbox.tie_selection,c=this._data[d?"core":"checkbox"].selected,h={};if(a&&a.original&&a.original.state&&a.original.state.undetermined&&(a.original.state.undetermined=!1),l.indexOf("down")!==-1)for(i=0,r=a.children_d.length;i<r;i++)s=this._model.data[a.children_d[i]],s.state[d?"selected":"checked"]=!1,s&&s.original&&s.original.state&&s.original.state.undetermined&&(s.original.state.undetermined=!1);if(l.indexOf("up")!==-1)for(i=0,r=a.parents.length;i<r;i++)s=this._model.data[a.parents[i]],s.state[d?"selected":"checked"]=!1,s&&s.original&&s.original.state&&s.original.state.undetermined&&(s.original.state.undetermined=!1),s=this.get_node(a.parents[i],!0),s&&s.length&&s.attr("aria-selected",!1).children(".jstree-anchor").removeClass(d?"jstree-clicked":"jstree-checked");for(h={},i=0,r=c.length;i<r;i++)l.indexOf("down")!==-1&&e.inArray(c[i],a.children_d)!==-1||l.indexOf("up")!==-1&&e.inArray(c[i],a.parents)!==-1||(h[c[i]]=!0);c=[];for(i in h)h.hasOwnProperty(i)&&c.push(i);this._data[d?"core":"checkbox"].selected=c,l.indexOf("down")!==-1&&o.length&&o.find(".jstree-anchor").removeClass(d?"jstree-clicked":"jstree-checked").parent().attr("aria-selected",!1)},this)),this.settings.checkbox.cascade.indexOf("up")!==-1&&this.element.on("delete_node.jstree",e.proxy(function(t,n){for(var i,r,s,a,o=this.get_node(n.parent),l=this._model.data,d=this.settings.checkbox.tie_selection;o&&o.id!==e.jstree.root&&!o.state[d?"selected":"checked"];){for(s=0,i=0,r=o.children.length;i<r;i++)s+=l[o.children[i]].state[d?"selected":"checked"];if(!(r>0&&s===r))break;o.state[d?"selected":"checked"]=!0,this._data[d?"core":"checkbox"].selected.push(o.id),a=this.get_node(o,!0),a&&a.length&&a.attr("aria-selected",!0).children(".jstree-anchor").addClass(d?"jstree-clicked":"jstree-checked"),o=this.get_node(o.parent)}},this)).on("move_node.jstree",e.proxy(function(t,n){var i,r,s,a,o,l=n.is_multi,d=n.old_parent,c=this.get_node(n.parent),h=this._model.data,u=this.settings.checkbox.tie_selection;if(!l)for(i=this.get_node(d);i&&i.id!==e.jstree.root&&!i.state[u?"selected":"checked"];){for(r=0,s=0,a=i.children.length;s<a;s++)r+=h[i.children[s]].state[u?"selected":"checked"];if(!(a>0&&r===a))break;i.state[u?"selected":"checked"]=!0,this._data[u?"core":"checkbox"].selected.push(i.id),o=this.get_node(i,!0),o&&o.length&&o.attr("aria-selected",!0).children(".jstree-anchor").addClass(u?"jstree-clicked":"jstree-checked"),i=this.get_node(i.parent)}for(i=c;i&&i.id!==e.jstree.root;){for(r=0,s=0,a=i.children.length;s<a;s++)r+=h[i.children[s]].state[u?"selected":"checked"];if(r===a)i.state[u?"selected":"checked"]||(i.state[u?"selected":"checked"]=!0,this._data[u?"core":"checkbox"].selected.push(i.id),o=this.get_node(i,!0),o&&o.length&&o.attr("aria-selected",!0).children(".jstree-anchor").addClass(u?"jstree-clicked":"jstree-checked"));else{if(!i.state[u?"selected":"checked"])break;i.state[u?"selected":"checked"]=!1,this._data[u?"core":"checkbox"].selected=e.vakata.array_remove_item(this._data[u?"core":"checkbox"].selected,i.id),o=this.get_node(i,!0),o&&o.length&&o.attr("aria-selected",!1).children(".jstree-anchor").removeClass(u?"jstree-clicked":"jstree-checked")}i=this.get_node(i.parent)}},this))},this._undetermined=function(){if(null!==this.element){var n,i,r,s,a={},o=this._model.data,l=this.settings.checkbox.tie_selection,d=this._data[l?"core":"checkbox"].selected,c=[],h=this;for(n=0,i=d.length;n<i;n++)if(o[d[n]]&&o[d[n]].parents)for(r=0,s=o[d[n]].parents.length;r<s&&a[o[d[n]].parents[r]]===t;r++)o[d[n]].parents[r]!==e.jstree.root&&(a[o[d[n]].parents[r]]=!0,c.push(o[d[n]].parents[r]));for(this.element.find(".jstree-closed").not(":has(.jstree-children)").each(function(){var l,d=h.get_node(this);if(d.state.loaded){for(n=0,i=d.children_d.length;n<i;n++)if(l=o[d.children_d[n]],!l.state.loaded&&l.original&&l.original.state&&l.original.state.undetermined&&l.original.state.undetermined===!0)for(a[l.id]===t&&l.id!==e.jstree.root&&(a[l.id]=!0,c.push(l.id)),r=0,s=l.parents.length;r<s;r++)a[l.parents[r]]===t&&l.parents[r]!==e.jstree.root&&(a[l.parents[r]]=!0,c.push(l.parents[r]))}else if(d.original&&d.original.state&&d.original.state.undetermined&&d.original.state.undetermined===!0)for(a[d.id]===t&&d.id!==e.jstree.root&&(a[d.id]=!0,c.push(d.id)),r=0,s=d.parents.length;r<s;r++)a[d.parents[r]]===t&&d.parents[r]!==e.jstree.root&&(a[d.parents[r]]=!0,c.push(d.parents[r]))}),this.element.find(".jstree-undetermined").removeClass("jstree-undetermined"),n=0,i=c.length;n<i;n++)o[c[n]].state[l?"selected":"checked"]||(d=this.get_node(c[n],!0),d&&d.length&&d.children(".jstree-anchor").children(".jstree-checkbox").addClass("jstree-undetermined"))}},this.redraw_node=function(t,n,r){if(t=i.redraw_node.apply(this,arguments)){var s,a,o=null,l=null;for(s=0,a=t.childNodes.length;s<a;s++)if(t.childNodes[s]&&t.childNodes[s].className&&t.childNodes[s].className.indexOf("jstree-anchor")!==-1){o=t.childNodes[s];break}o&&(!this.settings.checkbox.tie_selection&&this._model.data[t.id].state.checked&&(o.className+=" jstree-checked"),l=u.cloneNode(!1),this._model.data[t.id].state.checkbox_disabled&&(l.className+=" jstree-checkbox-disabled"),o.insertBefore(l,o.childNodes[0]))}return r||this.settings.checkbox.cascade.indexOf("undetermined")===-1||(this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto),this._data.checkbox.uto=setTimeout(e.proxy(this._undetermined,this),50)),t},this.show_checkboxes=function(){this._data.core.themes.checkboxes=!0,this.get_container_ul().removeClass("jstree-no-checkboxes")},this.hide_checkboxes=function(){this._data.core.themes.checkboxes=!1,this.get_container_ul().addClass("jstree-no-checkboxes")},this.toggle_checkboxes=function(){this._data.core.themes.checkboxes?this.hide_checkboxes():this.show_checkboxes()},this.is_undetermined=function(t){t=this.get_node(t);var n,i,r=this.settings.checkbox.cascade,s=this.settings.checkbox.tie_selection,a=this._data[s?"core":"checkbox"].selected,o=this._model.data;if(!t||t.state[s?"selected":"checked"]===!0||r.indexOf("undetermined")===-1||r.indexOf("down")===-1&&r.indexOf("up")===-1)return!1;if(!t.state.loaded&&t.original.state.undetermined===!0)return!0;for(n=0,i=t.children_d.length;n<i;n++)if(e.inArray(t.children_d[n],a)!==-1||!o[t.children_d[n]].state.loaded&&o[t.children_d[n]].original.state.undetermined)return!0;return!1},this.disable_checkbox=function(t){var n,i,r;if(e.isArray(t)){for(t=t.slice(),n=0,i=t.length;n<i;n++)this.disable_checkbox(t[n]);return!0}return t=this.get_node(t),!(!t||t.id===e.jstree.root)&&(r=this.get_node(t,!0),void(t.state.checkbox_disabled||(t.state.checkbox_disabled=!0,r&&r.length&&r.children(".jstree-anchor").children(".jstree-checkbox").addClass("jstree-checkbox-disabled"),this.trigger("disable_checkbox",{node:t}))))},this.enable_checkbox=function(t){var n,i,r;if(e.isArray(t)){for(t=t.slice(),n=0,i=t.length;n<i;n++)this.enable_checkbox(t[n]);return!0}return t=this.get_node(t),!(!t||t.id===e.jstree.root)&&(r=this.get_node(t,!0),void(t.state.checkbox_disabled&&(t.state.checkbox_disabled=!1,r&&r.length&&r.children(".jstree-anchor").children(".jstree-checkbox").removeClass("jstree-checkbox-disabled"),this.trigger("enable_checkbox",{node:t}))))},this.activate_node=function(t,n){return!e(n.target).hasClass("jstree-checkbox-disabled")&&(this.settings.checkbox.tie_selection&&(this.settings.checkbox.whole_node||e(n.target).hasClass("jstree-checkbox"))&&(n.ctrlKey=!0),this.settings.checkbox.tie_selection||!this.settings.checkbox.whole_node&&!e(n.target).hasClass("jstree-checkbox")?i.activate_node.call(this,t,n):!this.is_disabled(t)&&(this.is_checked(t)?this.uncheck_node(t,n):this.check_node(t,n),void this.trigger("activate_node",{node:this.get_node(t)})))},this.check_node=function(t,n){if(this.settings.checkbox.tie_selection)return this.select_node(t,!1,!0,n);var i,r,s;if(e.isArray(t)){for(t=t.slice(),r=0,s=t.length;r<s;r++)this.check_node(t[r],n);return!0}return t=this.get_node(t),!(!t||t.id===e.jstree.root)&&(i=this.get_node(t,!0),void(t.state.checked||(t.state.checked=!0,this._data.checkbox.selected.push(t.id),i&&i.length&&i.children(".jstree-anchor").addClass("jstree-checked"),this.trigger("check_node",{node:t,selected:this._data.checkbox.selected,event:n}))))},this.uncheck_node=function(t,n){if(this.settings.checkbox.tie_selection)return this.deselect_node(t,!1,n);var i,r,s;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;i<r;i++)this.uncheck_node(t[i],n);return!0}return t=this.get_node(t),!(!t||t.id===e.jstree.root)&&(s=this.get_node(t,!0),void(t.state.checked&&(t.state.checked=!1,this._data.checkbox.selected=e.vakata.array_remove_item(this._data.checkbox.selected,t.id),s.length&&s.children(".jstree-anchor").removeClass("jstree-checked"),this.trigger("uncheck_node",{node:t,selected:this._data.checkbox.selected,event:n}))))},this.check_all=function(){if(this.settings.checkbox.tie_selection)return this.select_all();var t,n;this._data.checkbox.selected.concat([]);for(this._data.checkbox.selected=this._model.data[e.jstree.root].children_d.concat(),t=0,n=this._data.checkbox.selected.length;t<n;t++)this._model.data[this._data.checkbox.selected[t]]&&(this._model.data[this._data.checkbox.selected[t]].state.checked=!0);this.redraw(!0),this.trigger("check_all",{selected:this._data.checkbox.selected})},this.uncheck_all=function(){if(this.settings.checkbox.tie_selection)return this.deselect_all();var e,t,n=this._data.checkbox.selected.concat([]);for(e=0,t=this._data.checkbox.selected.length;e<t;e++)this._model.data[this._data.checkbox.selected[e]]&&(this._model.data[this._data.checkbox.selected[e]].state.checked=!1);this._data.checkbox.selected=[],this.element.find(".jstree-checked").removeClass("jstree-checked"),this.trigger("uncheck_all",{selected:this._data.checkbox.selected,node:n})},this.is_checked=function(t){return this.settings.checkbox.tie_selection?this.is_selected(t):(t=this.get_node(t),!(!t||t.id===e.jstree.root)&&t.state.checked)},this.get_checked=function(t){return this.settings.checkbox.tie_selection?this.get_selected(t):t?e.map(this._data.checkbox.selected,e.proxy(function(e){return this.get_node(e)},this)):this._data.checkbox.selected},this.get_top_checked=function(t){if(this.settings.checkbox.tie_selection)return this.get_top_selected(t);var n,i,r,s,a=this.get_checked(!0),o={};for(n=0,i=a.length;n<i;n++)o[a[n].id]=a[n];for(n=0,i=a.length;n<i;n++)for(r=0,s=a[n].children_d.length;r<s;r++)o[a[n].children_d[r]]&&delete o[a[n].children_d[r]];a=[];for(n in o)o.hasOwnProperty(n)&&a.push(n);return t?e.map(a,e.proxy(function(e){return this.get_node(e)},this)):a},this.get_bottom_checked=function(t){if(this.settings.checkbox.tie_selection)return this.get_bottom_selected(t);var n,i,r=this.get_checked(!0),s=[];for(n=0,i=r.length;n<i;n++)r[n].children.length||s.push(r[n].id);return t?e.map(s,e.proxy(function(e){return this.get_node(e)},this)):s},this.load_node=function(t){
var n,r,s,a;if(!e.isArray(t)&&!this.settings.checkbox.tie_selection&&(a=this.get_node(t),a&&a.state.loaded))for(n=0,r=a.children_d.length;n<r;n++)this._model.data[a.children_d[n]].state.checked&&(s=!0,this._data.checkbox.selected=e.vakata.array_remove_item(this._data.checkbox.selected,a.children_d[n]));return i.load_node.apply(this,arguments)},this.get_state=function(){var e=i.get_state.apply(this,arguments);return this.settings.checkbox.tie_selection?e:(e.checkbox=this._data.checkbox.selected.slice(),e)},this.set_state=function(t,n){var r=i.set_state.apply(this,arguments);if(r&&t.checkbox){if(!this.settings.checkbox.tie_selection){this.uncheck_all();var s=this;e.each(t.checkbox,function(e,t){s.check_node(t)})}return delete t.checkbox,this.set_state(t,n),!1}return r},this.refresh=function(){return this.settings.checkbox.tie_selection||(this._data.checkbox.selected=[]),i.refresh.apply(this,arguments)}},e.jstree.defaults.conditionalselect=function(){return!0},e.jstree.plugins.conditionalselect=function(e,t){this.activate_node=function(e,n){this.settings.conditionalselect.call(this,this.get_node(e),n)&&t.activate_node.call(this,e,n)}},e.jstree.defaults.contextmenu={select_node:!0,show_at_node:!0,items:function(){return{create:{separator_before:!1,separator_after:!0,_disabled:!1,label:"Create",action:function(t){var n=e.jstree.reference(t.reference),i=n.get_node(t.reference);n.create_node(i,{},"last",function(e){setTimeout(function(){n.edit(e)},0)})}},rename:{separator_before:!1,separator_after:!1,_disabled:!1,label:"Rename",action:function(t){var n=e.jstree.reference(t.reference),i=n.get_node(t.reference);n.edit(i)}},remove:{separator_before:!1,icon:!1,separator_after:!1,_disabled:!1,label:"Delete",action:function(t){var n=e.jstree.reference(t.reference),i=n.get_node(t.reference);n.is_selected(i)?n.delete_node(n.get_selected()):n.delete_node(i)}},ccp:{separator_before:!0,icon:!1,separator_after:!1,label:"Edit",action:!1,submenu:{cut:{separator_before:!1,separator_after:!1,label:"Cut",action:function(t){var n=e.jstree.reference(t.reference),i=n.get_node(t.reference);n.is_selected(i)?n.cut(n.get_top_selected()):n.cut(i)}},copy:{separator_before:!1,icon:!1,separator_after:!1,label:"Copy",action:function(t){var n=e.jstree.reference(t.reference),i=n.get_node(t.reference);n.is_selected(i)?n.copy(n.get_top_selected()):n.copy(i)}},paste:{separator_before:!1,icon:!1,_disabled:function(t){return!e.jstree.reference(t.reference).can_paste()},separator_after:!1,label:"Paste",action:function(t){var n=e.jstree.reference(t.reference),i=n.get_node(t.reference);n.paste(i)}}}}}}},e.jstree.plugins.contextmenu=function(n,i){this.bind=function(){i.bind.call(this);var t,n,r=0,s=null;this.element.on("contextmenu.jstree",".jstree-anchor",e.proxy(function(e,t){"input"!==e.target.tagName.toLowerCase()&&(e.preventDefault(),r=e.ctrlKey?+new Date:0,(t||s)&&(r=+new Date+1e4),s&&clearTimeout(s),this.is_loading(e.currentTarget)||this.show_contextmenu(e.currentTarget,e.pageX,e.pageY,e))},this)).on("click.jstree",".jstree-anchor",e.proxy(function(){this._data.contextmenu.visible&&(!r||+new Date-r>250)&&e.vakata.context.hide(),r=0},this)).on("touchstart.jstree",".jstree-anchor",function(i){i.originalEvent&&i.originalEvent.changedTouches&&i.originalEvent.changedTouches[0]&&(t=i.originalEvent.changedTouches[0].clientX,n=i.originalEvent.changedTouches[0].clientY,s=setTimeout(function(){e(i.currentTarget).trigger("contextmenu",!0)},750))}).on("touchmove.vakata.jstree",function(e){s&&e.originalEvent&&e.originalEvent.changedTouches&&e.originalEvent.changedTouches[0]&&(Math.abs(t-e.originalEvent.changedTouches[0].clientX)>50||Math.abs(n-e.originalEvent.changedTouches[0].clientY)>50)&&clearTimeout(s)}).on("touchend.vakata.jstree",function(){s&&clearTimeout(s)}),e(c).on("context_hide.vakata.jstree",e.proxy(function(t,n){this._data.contextmenu.visible=!1,e(n.reference).removeClass("jstree-context")},this))},this.teardown=function(){this._data.contextmenu.visible&&e.vakata.context.hide(),i.teardown.call(this)},this.show_contextmenu=function(n,i,r,s){if(n=this.get_node(n),!n||n.id===e.jstree.root)return!1;var a=this.settings.contextmenu,o=this.get_node(n,!0),l=o.children(".jstree-anchor"),d=!1,c=!1;(a.show_at_node||i===t||r===t)&&(d=l.offset(),i=d.left,r=d.top+this._data.core.li_height),this.settings.contextmenu.select_node&&!this.is_selected(n)&&this.activate_node(n,s),c=a.items,e.isFunction(c)&&(c=c.call(this,n,e.proxy(function(e){this._show_contextmenu(n,i,r,e)},this))),e.isPlainObject(c)&&this._show_contextmenu(n,i,r,c)},this._show_contextmenu=function(t,n,i,r){var s=this.get_node(t,!0),a=s.children(".jstree-anchor");e(c).one("context_show.vakata.jstree",e.proxy(function(t,n){var i="jstree-contextmenu jstree-"+this.get_theme()+"-contextmenu";e(n.element).addClass(i),a.addClass("jstree-context")},this)),this._data.contextmenu.visible=!0,e.vakata.context.show(a,{x:n,y:i},r),this.trigger("show_contextmenu",{node:t,x:n,y:i})}},function(e){var t=!1,n={element:!1,reference:!1,position_x:0,position_y:0,items:[],html:"",is_visible:!1};e.vakata.context={settings:{hide_onmouseleave:0,icons:!0},_trigger:function(t){e(c).triggerHandler("context_"+t+".vakata",{reference:n.reference,element:n.element,position:{x:n.position_x,y:n.position_y}})},_execute:function(t){return t=n.items[t],!(!t||t._disabled&&(!e.isFunction(t._disabled)||t._disabled({item:t,reference:n.reference,element:n.element}))||!t.action)&&t.action.call(null,{item:t,reference:n.reference,element:n.element,position:{x:n.position_x,y:n.position_y}})},_parse:function(t,i){if(!t)return!1;i||(n.html="",n.items=[]);var r,s="",a=!1;return i&&(s+="<ul>"),e.each(t,function(t,i){return!i||(n.items.push(i),!a&&i.separator_before&&(s+="<li class='vakata-context-separator'><a href='#' "+(e.vakata.context.settings.icons?"":'style="margin-left:0px;"')+">&#160;</a></li>"),a=!1,s+="<li class='"+(i._class||"")+(i._disabled===!0||e.isFunction(i._disabled)&&i._disabled({item:i,reference:n.reference,element:n.element})?" vakata-contextmenu-disabled ":"")+"' "+(i.shortcut?" data-shortcut='"+i.shortcut+"' ":"")+">",s+="<a href='#' rel='"+(n.items.length-1)+"' "+(i.title?"title='"+i.title+"'":"")+">",e.vakata.context.settings.icons&&(s+="<i ",i.icon&&(s+=i.icon.indexOf("/")!==-1||i.icon.indexOf(".")!==-1?" style='background:url(\""+i.icon+"\") center center no-repeat' ":" class='"+i.icon+"' "),s+="></i><span class='vakata-contextmenu-sep'>&#160;</span>"),s+=(e.isFunction(i.label)?i.label({item:t,reference:n.reference,element:n.element}):i.label)+(i.shortcut?' <span class="vakata-contextmenu-shortcut vakata-contextmenu-shortcut-'+i.shortcut+'">'+(i.shortcut_label||"")+"</span>":"")+"</a>",i.submenu&&(r=e.vakata.context._parse(i.submenu,!0),r&&(s+=r)),s+="</li>",void(i.separator_after&&(s+="<li class='vakata-context-separator'><a href='#' "+(e.vakata.context.settings.icons?"":'style="margin-left:0px;"')+">&#160;</a></li>",a=!0)))}),s=s.replace(/<li class\='vakata-context-separator'\><\/li\>$/,""),i&&(s+="</ul>"),i||(n.html=s,e.vakata.context._trigger("parse")),s.length>10&&s},_show_submenu:function(n){if(n=e(n),n.length&&n.children("ul").length){var i=n.children("ul"),r=n.offset().left,s=r+n.outerWidth(),a=n.offset().top,o=i.width(),l=i.height(),d=e(window).width()+e(window).scrollLeft(),c=e(window).height()+e(window).scrollTop();t?n[s-(o+10+n.outerWidth())<0?"addClass":"removeClass"]("vakata-context-left"):n[s+o>d&&r>d-s?"addClass":"removeClass"]("vakata-context-right"),a+l+10>c&&i.css("bottom","-1px"),n.hasClass("vakata-context-right")?r<o&&i.css("margin-right",r-o):d-s<o&&i.css("margin-left",d-s-o),i.show()}},show:function(i,r,s){var a,o,l,d,c,h,u,f,p=!0;switch(n.element&&n.element.length&&n.element.width(""),p){case!r&&!i:return!1;case!!r&&!!i:n.reference=i,n.position_x=r.x,n.position_y=r.y;break;case!r&&!!i:n.reference=i,a=i.offset(),n.position_x=a.left+i.outerHeight(),n.position_y=a.top;break;case!!r&&!i:n.position_x=r.x,n.position_y=r.y}i&&!s&&e(i).data("vakata_contextmenu")&&(s=e(i).data("vakata_contextmenu")),e.vakata.context._parse(s)&&n.element.html(n.html),n.items.length&&(n.element.appendTo("body"),o=n.element,l=n.position_x,d=n.position_y,c=o.width(),h=o.height(),u=e(window).width()+e(window).scrollLeft(),f=e(window).height()+e(window).scrollTop(),t&&(l-=o.outerWidth()-e(i).outerWidth(),l<e(window).scrollLeft()+20&&(l=e(window).scrollLeft()+20)),l+c+20>u&&(l=u-(c+20)),d+h+20>f&&(d=f-(h+20)),n.element.css({left:l,top:d}).show().find("a").first().focus().parent().addClass("vakata-context-hover"),n.is_visible=!0,e.vakata.context._trigger("show"))},hide:function(){n.is_visible&&(n.element.hide().find("ul").hide().end().find(":focus").blur().end().detach(),n.is_visible=!1,e.vakata.context._trigger("hide"))}},e(function(){t="rtl"===e("body").css("direction");var i=!1;n.element=e("<ul class='vakata-context'></ul>"),n.element.on("mouseenter","li",function(t){t.stopImmediatePropagation(),e.contains(this,t.relatedTarget)||(i&&clearTimeout(i),n.element.find(".vakata-context-hover").removeClass("vakata-context-hover").end(),e(this).siblings().find("ul").hide().end().end().parentsUntil(".vakata-context","li").addBack().addClass("vakata-context-hover"),e.vakata.context._show_submenu(this))}).on("mouseleave","li",function(t){e.contains(this,t.relatedTarget)||e(this).find(".vakata-context-hover").addBack().removeClass("vakata-context-hover")}).on("mouseleave",function(){e(this).find(".vakata-context-hover").removeClass("vakata-context-hover"),e.vakata.context.settings.hide_onmouseleave&&(i=setTimeout(function(){return function(){e.vakata.context.hide()}}(this),e.vakata.context.settings.hide_onmouseleave))}).on("click","a",function(t){t.preventDefault(),e(this).blur().parent().hasClass("vakata-context-disabled")||e.vakata.context._execute(e(this).attr("rel"))===!1||e.vakata.context.hide()}).on("keydown","a",function(t){var i=null;switch(t.which){case 13:case 32:t.type="mouseup",t.preventDefault(),e(t.currentTarget).trigger(t);break;case 37:n.is_visible&&(n.element.find(".vakata-context-hover").last().closest("li").first().find("ul").hide().find(".vakata-context-hover").removeClass("vakata-context-hover").end().end().children("a").focus(),t.stopImmediatePropagation(),t.preventDefault());break;case 38:n.is_visible&&(i=n.element.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").prevAll("li:not(.vakata-context-separator)").first(),i.length||(i=n.element.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").last()),i.addClass("vakata-context-hover").children("a").focus(),t.stopImmediatePropagation(),t.preventDefault());break;case 39:n.is_visible&&(n.element.find(".vakata-context-hover").last().children("ul").show().children("li:not(.vakata-context-separator)").removeClass("vakata-context-hover").first().addClass("vakata-context-hover").children("a").focus(),t.stopImmediatePropagation(),t.preventDefault());break;case 40:n.is_visible&&(i=n.element.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").nextAll("li:not(.vakata-context-separator)").first(),i.length||(i=n.element.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").first()),i.addClass("vakata-context-hover").children("a").focus(),t.stopImmediatePropagation(),t.preventDefault());break;case 27:e.vakata.context.hide(),t.preventDefault()}}).on("keydown",function(e){e.preventDefault();var t=n.element.find(".vakata-contextmenu-shortcut-"+e.which).parent();t.parent().not(".vakata-context-disabled")&&t.click()}),e(c).on("mousedown.vakata.jstree",function(t){n.is_visible&&!e.contains(n.element[0],t.target)&&e.vakata.context.hide()}).on("context_show.vakata.jstree",function(){n.element.find("li:has(ul)").children("a").addClass("vakata-context-parent"),t&&n.element.addClass("vakata-context-rtl").css("direction","rtl"),n.element.find("ul").hide().end()})})}(e),e.jstree.defaults.dnd={copy:!0,open_timeout:500,is_draggable:!0,check_while_dragging:!0,always_copy:!1,inside_pos:0,drag_selection:!0,touch:!0,large_drop_target:!1,large_drag_target:!1,use_html5:!1};var f,p;e.jstree.plugins.dnd=function(t,n){this.init=function(e,t){n.init.call(this,e,t),this.settings.dnd.use_html5=this.settings.dnd.use_html5&&"draggable"in c.createElement("span")},this.bind=function(){n.bind.call(this),this.element.on(this.settings.dnd.use_html5?"dragstart.jstree":"mousedown.jstree touchstart.jstree",this.settings.dnd.large_drag_target?".jstree-node":".jstree-anchor",e.proxy(function(t){if(this.settings.dnd.large_drag_target&&e(t.target).closest(".jstree-node")[0]!==t.currentTarget)return!0;if("touchstart"===t.type&&(!this.settings.dnd.touch||"selected"===this.settings.dnd.touch&&!e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor").hasClass("jstree-clicked")))return!0;var n=this.get_node(t.target),i=this.is_selected(n)&&this.settings.dnd.drag_selection?this.get_top_selected().length:1,r=i>1?i+" "+this.get_string("nodes"):this.get_text(t.currentTarget);if(this.settings.core.force_text&&(r=e.vakata.html.escape(r)),n&&n.id&&n.id!==e.jstree.root&&(1===t.which||"touchstart"===t.type||"dragstart"===t.type)&&(this.settings.dnd.is_draggable===!0||e.isFunction(this.settings.dnd.is_draggable)&&this.settings.dnd.is_draggable.call(this,i>1?this.get_top_selected(!0):[n],t))){if(f={jstree:!0,origin:this,obj:this.get_node(n,!0),nodes:i>1?this.get_top_selected():[n.id]},p=t.currentTarget,!this.settings.dnd.use_html5)return this.element.trigger("mousedown.jstree"),e.vakata.dnd.start(t,f,'<div id="jstree-dnd" class="jstree-'+this.get_theme()+" jstree-"+this.get_theme()+"-"+this.get_theme_variant()+" "+(this.settings.core.themes.responsive?" jstree-dnd-responsive":"")+'"><i class="jstree-icon jstree-er"></i>'+r+'<ins class="jstree-copy" style="display:none;">+</ins></div>');e.vakata.dnd._trigger("start",t,{helper:e(),element:p,data:f})}},this)),this.settings.dnd.use_html5&&this.element.on("dragover.jstree",function(t){return t.preventDefault(),e.vakata.dnd._trigger("move",t,{helper:e(),element:p,data:f}),!1}).on("drop.jstree",e.proxy(function(t){return t.preventDefault(),e.vakata.dnd._trigger("stop",t,{helper:e(),element:p,data:f}),!1},this))},this.redraw_node=function(e){if(e=n.redraw_node.apply(this,arguments),e&&this.settings.dnd.use_html5)if(this.settings.dnd.large_drag_target)e.setAttribute("draggable",!0);else{var t,i,r=null;for(t=0,i=e.childNodes.length;t<i;t++)if(e.childNodes[t]&&e.childNodes[t].className&&e.childNodes[t].className.indexOf("jstree-anchor")!==-1){r=e.childNodes[t];break}r&&r.setAttribute("draggable",!0)}return e}},e(function(){var n=!1,i=!1,r=!1,s=!1,a=e('<div id="jstree-marker">&#160;</div>').hide();e(c).on("dnd_start.vakata.jstree",function(e,t){n=!1,r=!1,t&&t.data&&t.data.jstree&&a.appendTo("body")}).on("dnd_move.vakata.jstree",function(o,l){if(s&&(l.event&&"dragover"===l.event.type&&l.event.target===r.target||clearTimeout(s)),l&&l.data&&l.data.jstree&&(!l.event.target.id||"jstree-marker"!==l.event.target.id)){r=l.event;var d,c,h,u,f,p,g,_,m,y,v,x,b,k,j,w,C=e.jstree.reference(l.event.target),S=!1,A=!1,T=!1;if(C&&C._data&&C._data.dnd)if(a.attr("class","jstree-"+C.get_theme()+(C.settings.core.themes.responsive?" jstree-dnd-responsive":"")),j=l.data.origin&&(l.data.origin.settings.dnd.always_copy||l.data.origin.settings.dnd.copy&&(l.event.metaKey||l.event.ctrlKey)),l.helper.children().attr("class","jstree-"+C.get_theme()+" jstree-"+C.get_theme()+"-"+C.get_theme_variant()+" "+(C.settings.core.themes.responsive?" jstree-dnd-responsive":"")).find(".jstree-copy").first()[j?"show":"hide"](),l.event.target!==C.element[0]&&l.event.target!==C.get_container_ul()[0]||0!==C.get_container_ul().children().length){if(S=C.settings.dnd.large_drop_target?e(l.event.target).closest(".jstree-node").children(".jstree-anchor"):e(l.event.target).closest(".jstree-anchor"),S&&S.length&&S.parent().is(".jstree-closed, .jstree-open, .jstree-leaf")&&(A=S.offset(),T=(l.event.pageY!==t?l.event.pageY:l.event.originalEvent.pageY)-A.top,h=S.outerHeight(),p=T<h/3?["b","i","a"]:T>h-h/3?["a","i","b"]:T>h/2?["i","a","b"]:["i","b","a"],e.each(p,function(t,r){switch(r){case"b":d=A.left-6,c=A.top,u=C.get_parent(S),f=S.parent().index();break;case"i":b=C.settings.dnd.inside_pos,k=C.get_node(S.parent()),d=A.left-2,c=A.top+h/2+1,u=k.id,f="first"===b?0:"last"===b?k.children.length:Math.min(b,k.children.length);break;case"a":d=A.left-6,c=A.top+h,u=C.get_parent(S),f=S.parent().index()+1}for(g=!0,_=0,m=l.data.nodes.length;_<m;_++)if(y=l.data.origin&&(l.data.origin.settings.dnd.always_copy||l.data.origin.settings.dnd.copy&&(l.event.metaKey||l.event.ctrlKey))?"copy_node":"move_node",v=f,"move_node"===y&&"a"===r&&l.data.origin&&l.data.origin===C&&u===C.get_parent(l.data.nodes[_])&&(x=C.get_node(u),v>e.inArray(l.data.nodes[_],x.children)&&(v-=1)),g=g&&(C&&C.settings&&C.settings.dnd&&C.settings.dnd.check_while_dragging===!1||C.check(y,l.data.origin&&l.data.origin!==C?l.data.origin.get_node(l.data.nodes[_]):l.data.nodes[_],u,v,{dnd:!0,ref:C.get_node(S.parent()),pos:r,origin:l.data.origin,is_multi:l.data.origin&&l.data.origin!==C,is_foreign:!l.data.origin})),!g){C&&C.last_error&&(i=C.last_error());break}if("i"===r&&S.parent().is(".jstree-closed")&&C.settings.dnd.open_timeout&&(s=setTimeout(function(e,t){return function(){e.open_node(t)}}(C,S),C.settings.dnd.open_timeout)),g)return w=C.get_node(u,!0),w.hasClass(".jstree-dnd-parent")||(e(".jstree-dnd-parent").removeClass("jstree-dnd-parent"),w.addClass("jstree-dnd-parent")),n={ins:C,par:u,pos:"i"!==r||"last"!==b||0!==f||C.is_loaded(k)?f:"last"},a.css({left:d+"px",top:c+"px"}).show(),l.helper.find(".jstree-icon").first().removeClass("jstree-er").addClass("jstree-ok"),l.event.originalEvent&&l.event.originalEvent.dataTransfer&&(l.event.originalEvent.dataTransfer.dropEffect=j?"copy":"move"),i={},p=!0,!1}),p===!0))return}else{for(g=!0,_=0,m=l.data.nodes.length;_<m&&(g=g&&C.check(l.data.origin&&(l.data.origin.settings.dnd.always_copy||l.data.origin.settings.dnd.copy&&(l.event.metaKey||l.event.ctrlKey))?"copy_node":"move_node",l.data.origin&&l.data.origin!==C?l.data.origin.get_node(l.data.nodes[_]):l.data.nodes[_],e.jstree.root,"last",{dnd:!0,ref:C.get_node(e.jstree.root),pos:"i",origin:l.data.origin,is_multi:l.data.origin&&l.data.origin!==C,is_foreign:!l.data.origin}),g);_++);if(g)return n={ins:C,par:e.jstree.root,pos:"last"},a.hide(),l.helper.find(".jstree-icon").first().removeClass("jstree-er").addClass("jstree-ok"),void(l.event.originalEvent&&l.event.originalEvent.dataTransfer&&(l.event.originalEvent.dataTransfer.dropEffect=j?"copy":"move"))}e(".jstree-dnd-parent").removeClass("jstree-dnd-parent"),n=!1,l.helper.find(".jstree-icon").removeClass("jstree-ok").addClass("jstree-er"),l.event.originalEvent&&l.event.originalEvent.dataTransfer&&(l.event.originalEvent.dataTransfer.dropEffect="none"),a.hide()}}).on("dnd_scroll.vakata.jstree",function(e,t){t&&t.data&&t.data.jstree&&(a.hide(),n=!1,r=!1,t.helper.find(".jstree-icon").first().removeClass("jstree-ok").addClass("jstree-er"))}).on("dnd_stop.vakata.jstree",function(t,o){if(e(".jstree-dnd-parent").removeClass("jstree-dnd-parent"),s&&clearTimeout(s),o&&o.data&&o.data.jstree){a.hide().detach();var l,d,c=[];if(n){for(l=0,d=o.data.nodes.length;l<d;l++)c[l]=o.data.origin?o.data.origin.get_node(o.data.nodes[l]):o.data.nodes[l];n.ins[o.data.origin&&(o.data.origin.settings.dnd.always_copy||o.data.origin.settings.dnd.copy&&(o.event.metaKey||o.event.ctrlKey))?"copy_node":"move_node"](c,n.par,n.pos,!1,!1,!1,o.data.origin)}else l=e(o.event.target).closest(".jstree"),l.length&&i&&i.error&&"check"===i.error&&(l=l.jstree(!0),l&&l.settings.core.error.call(this,i));r=!1,n=!1}}).on("keyup.jstree keydown.jstree",function(t,o){o=e.vakata.dnd._get(),o&&o.data&&o.data.jstree&&("keyup"===t.type&&27===t.which?(s&&clearTimeout(s),n=!1,i=!1,r=!1,s=!1,a.hide().detach(),e.vakata.dnd._clean()):(o.helper.find(".jstree-copy").first()[o.data.origin&&(o.data.origin.settings.dnd.always_copy||o.data.origin.settings.dnd.copy&&(t.metaKey||t.ctrlKey))?"show":"hide"](),r&&(r.metaKey=t.metaKey,r.ctrlKey=t.ctrlKey,e.vakata.dnd._trigger("move",r))))})}),function(e){e.vakata.html={div:e("<div />"),escape:function(t){return e.vakata.html.div.name(t).html()},strip:function(t){return e.vakata.html.div.empty().append(e.parseHTML(t)).name()}};var n={element:!1,target:!1,is_down:!1,is_drag:!1,helper:!1,helper_w:0,data:!1,init_x:0,init_y:0,scroll_l:0,scroll_t:0,scroll_e:!1,scroll_i:!1,is_touch:!1};e.vakata.dnd={settings:{scroll_speed:10,scroll_proximity:20,helper_left:5,helper_top:10,threshold:5,threshold_touch:50},_trigger:function(n,i,r){r===t&&(r=e.vakata.dnd._get()),r.event=i,e(c).triggerHandler("dnd_"+n+".vakata",r)},_get:function(){return{data:n.data,element:n.element,helper:n.helper}},_clean:function(){n.helper&&n.helper.remove(),n.scroll_i&&(clearInterval(n.scroll_i),n.scroll_i=!1),n={element:!1,target:!1,is_down:!1,is_drag:!1,helper:!1,helper_w:0,data:!1,init_x:0,init_y:0,scroll_l:0,scroll_t:0,scroll_e:!1,scroll_i:!1,is_touch:!1},e(c).off("mousemove.vakata.jstree touchmove.vakata.jstree",e.vakata.dnd.drag),e(c).off("mouseup.vakata.jstree touchend.vakata.jstree",e.vakata.dnd.stop)},_scroll:function(t){if(!n.scroll_e||!n.scroll_l&&!n.scroll_t)return n.scroll_i&&(clearInterval(n.scroll_i),n.scroll_i=!1),!1;if(!n.scroll_i)return n.scroll_i=setInterval(e.vakata.dnd._scroll,100),!1;if(t===!0)return!1;var i=n.scroll_e.scrollTop(),r=n.scroll_e.scrollLeft();n.scroll_e.scrollTop(i+n.scroll_t*e.vakata.dnd.settings.scroll_speed),n.scroll_e.scrollLeft(r+n.scroll_l*e.vakata.dnd.settings.scroll_speed),i===n.scroll_e.scrollTop()&&r===n.scroll_e.scrollLeft()||e.vakata.dnd._trigger("scroll",n.scroll_e)},start:function(t,i,r){"touchstart"===t.type&&t.originalEvent&&t.originalEvent.changedTouches&&t.originalEvent.changedTouches[0]&&(t.pageX=t.originalEvent.changedTouches[0].pageX,t.pageY=t.originalEvent.changedTouches[0].pageY,t.target=c.elementFromPoint(t.originalEvent.changedTouches[0].pageX-window.pageXOffset,t.originalEvent.changedTouches[0].pageY-window.pageYOffset)),n.is_drag&&e.vakata.dnd.stop({});try{t.currentTarget.unselectable="on",t.currentTarget.onselectstart=function(){return!1},t.currentTarget.style&&(t.currentTarget.style.touchAction="none",t.currentTarget.style.msTouchAction="none",t.currentTarget.style.MozUserSelect="none")}catch(e){}return n.init_x=t.pageX,n.init_y=t.pageY,n.data=i,n.is_down=!0,n.element=t.currentTarget,n.target=t.target,n.is_touch="touchstart"===t.type,r!==!1&&(n.helper=e("<div id='vakata-dnd'></div>").html(r).css({display:"block",margin:"0",padding:"0",position:"absolute",top:"-2000px",lineHeight:"16px",zIndex:"10000"})),e(c).on("mousemove.vakata.jstree touchmove.vakata.jstree",e.vakata.dnd.drag),e(c).on("mouseup.vakata.jstree touchend.vakata.jstree",e.vakata.dnd.stop),!1},drag:function(t){if("touchmove"===t.type&&t.originalEvent&&t.originalEvent.changedTouches&&t.originalEvent.changedTouches[0]&&(t.pageX=t.originalEvent.changedTouches[0].pageX,t.pageY=t.originalEvent.changedTouches[0].pageY,t.target=c.elementFromPoint(t.originalEvent.changedTouches[0].pageX-window.pageXOffset,t.originalEvent.changedTouches[0].pageY-window.pageYOffset)),n.is_down){if(!n.is_drag){if(!(Math.abs(t.pageX-n.init_x)>(n.is_touch?e.vakata.dnd.settings.threshold_touch:e.vakata.dnd.settings.threshold)||Math.abs(t.pageY-n.init_y)>(n.is_touch?e.vakata.dnd.settings.threshold_touch:e.vakata.dnd.settings.threshold)))return;n.helper&&(n.helper.appendTo("body"),n.helper_w=n.helper.outerWidth()),n.is_drag=!0,e(n.target).one("click.vakata",!1),e.vakata.dnd._trigger("start",t)}var i=!1,r=!1,s=!1,a=!1,o=!1,l=!1,d=!1,h=!1,u=!1,f=!1;return n.scroll_t=0,n.scroll_l=0,n.scroll_e=!1,e(e(t.target).parentsUntil("body").addBack().get().reverse()).filter(function(){return/^auto|scroll$/.test(e(this).css("overflow"))&&(this.scrollHeight>this.offsetHeight||this.scrollWidth>this.offsetWidth)}).each(function(){var i=e(this),r=i.offset();if(this.scrollHeight>this.offsetHeight&&(r.top+i.height()-t.pageY<e.vakata.dnd.settings.scroll_proximity&&(n.scroll_t=1),t.pageY-r.top<e.vakata.dnd.settings.scroll_proximity&&(n.scroll_t=-1)),this.scrollWidth>this.offsetWidth&&(r.left+i.width()-t.pageX<e.vakata.dnd.settings.scroll_proximity&&(n.scroll_l=1),t.pageX-r.left<e.vakata.dnd.settings.scroll_proximity&&(n.scroll_l=-1)),n.scroll_t||n.scroll_l)return n.scroll_e=e(this),!1}),n.scroll_e||(i=e(c),r=e(window),s=i.height(),a=r.height(),o=i.width(),l=r.width(),d=i.scrollTop(),h=i.scrollLeft(),s>a&&t.pageY-d<e.vakata.dnd.settings.scroll_proximity&&(n.scroll_t=-1),s>a&&a-(t.pageY-d)<e.vakata.dnd.settings.scroll_proximity&&(n.scroll_t=1),o>l&&t.pageX-h<e.vakata.dnd.settings.scroll_proximity&&(n.scroll_l=-1),o>l&&l-(t.pageX-h)<e.vakata.dnd.settings.scroll_proximity&&(n.scroll_l=1),(n.scroll_t||n.scroll_l)&&(n.scroll_e=i)),n.scroll_e&&e.vakata.dnd._scroll(!0),n.helper&&(u=parseInt(t.pageY+e.vakata.dnd.settings.helper_top,10),f=parseInt(t.pageX+e.vakata.dnd.settings.helper_left,10),s&&u+25>s&&(u=s-50),o&&f+n.helper_w>o&&(f=o-(n.helper_w+2)),n.helper.css({left:f+"px",top:u+"px"})),e.vakata.dnd._trigger("move",t),!1}},stop:function(t){if("touchend"===t.type&&t.originalEvent&&t.originalEvent.changedTouches&&t.originalEvent.changedTouches[0]&&(t.pageX=t.originalEvent.changedTouches[0].pageX,t.pageY=t.originalEvent.changedTouches[0].pageY,t.target=c.elementFromPoint(t.originalEvent.changedTouches[0].pageX-window.pageXOffset,t.originalEvent.changedTouches[0].pageY-window.pageYOffset)),n.is_drag)t.target!==n.target&&e(n.target).off("click.vakata"),e.vakata.dnd._trigger("stop",t);else if("touchend"===t.type&&t.target===n.target){var i=setTimeout(function(){e(t.target).click()},100);e(t.target).one("click",function(){i&&clearTimeout(i)})}return e.vakata.dnd._clean(),!1}}}(e),e.jstree.defaults.massload=null,e.jstree.plugins.massload=function(t,n){this.init=function(e,t){this._data.massload={},n.init.call(this,e,t)},this._load_nodes=function(t,i,r,s){var a,o,l,d=this.settings.massload,c=(JSON.stringify(t),[]),h=this._model.data;if(!r){for(a=0,o=t.length;a<o;a++)h[t[a]]&&(h[t[a]].state.loaded||h[t[a]].state.failed)&&!s||(c.push(t[a]),l=this.get_node(t[a],!0),l&&l.length&&l.addClass("jstree-loading").attr("aria-busy",!0));if(this._data.massload={},c.length){if(e.isFunction(d))return d.call(this,c,e.proxy(function(e){var a,o;if(e)for(a in e)e.hasOwnProperty(a)&&(this._data.massload[a]=e[a]);for(a=0,o=t.length;a<o;a++)l=this.get_node(t[a],!0),l&&l.length&&l.removeClass("jstree-loading").attr("aria-busy",!1);n._load_nodes.call(this,t,i,r,s)},this));if("object"==typeof d&&d&&d.url)return d=e.extend(!0,{},d),e.isFunction(d.url)&&(d.url=d.url.call(this,c)),e.isFunction(d.data)&&(d.data=d.data.call(this,c)),e.ajax(d).done(e.proxy(function(e){var a,o;if(e)for(a in e)e.hasOwnProperty(a)&&(this._data.massload[a]=e[a]);for(a=0,o=t.length;a<o;a++)l=this.get_node(t[a],!0),l&&l.length&&l.removeClass("jstree-loading").attr("aria-busy",!1);n._load_nodes.call(this,t,i,r,s)},this)).fail(e.proxy(function(){n._load_nodes.call(this,t,i,r,s)},this))}}return n._load_nodes.call(this,t,i,r,s)},this._load_node=function(t,i){var r,s=this._data.massload[t.id],a=null;return s?(a=this["string"==typeof s?"_append_html_data":"_append_json_data"](t,"string"==typeof s?e(e.parseHTML(s)).filter(function(){return 3!==this.nodeType}):s,function(e){i.call(this,e)}),r=this.get_node(t.id,!0),r&&r.length&&r.removeClass("jstree-loading").attr("aria-busy",!1),delete this._data.massload[t.id],a):n._load_node.call(this,t,i)}},e.jstree.defaults.search={ajax:!1,fuzzy:!1,case_sensitive:!1,show_only_matches:!1,show_only_matches_children:!1,close_opened_onclear:!0,search_leaves_only:!1,search_callback:!1},e.jstree.plugins.search=function(n,i){this.bind=function(){i.bind.call(this),this._data.search.str="",this._data.search.dom=e(),this._data.search.res=[],this._data.search.opn=[],this._data.search.som=!1,this._data.search.smc=!1,this._data.search.hdn=[],this.element.on("search.jstree",e.proxy(function(t,n){if(this._data.search.som&&n.res.length){var i,r,s,a,o=this._model.data,l=[];for(i=0,r=n.res.length;i<r;i++)if(o[n.res[i]]&&!o[n.res[i]].state.hidden&&(l.push(n.res[i]),l=l.concat(o[n.res[i]].parents),this._data.search.smc))for(s=0,a=o[n.res[i]].children_d.length;s<a;s++)o[o[n.res[i]].children_d[s]]&&!o[o[n.res[i]].children_d[s]].state.hidden&&l.push(o[n.res[i]].children_d[s]);l=e.vakata.array_remove_item(e.vakata.array_unique(l),e.jstree.root),this._data.search.hdn=this.hide_all(!0),this.show_node(l,!0),this.redraw(!0)}},this)).on("clear_search.jstree",e.proxy(function(e,t){this._data.search.som&&t.res.length&&(this.show_node(this._data.search.hdn,!0),this.redraw(!0))},this))},this.search=function(n,i,r,s,a,o){if(n===!1||""===e.trim(n.toString()))return this.clear_search();s=this.get_node(s),s=s&&s.id?s.id:null,n=n.toString();var l,d,c=this.settings.search,h=!!c.ajax&&c.ajax,u=this._model.data,f=null,p=[],g=[];if(this._data.search.res.length&&!a&&this.clear_search(),r===t&&(r=c.show_only_matches),o===t&&(o=c.show_only_matches_children),!i&&h!==!1)return e.isFunction(h)?h.call(this,n,e.proxy(function(t){t&&t.d&&(t=t.d),this._load_nodes(e.isArray(t)?e.vakata.array_unique(t):[],function(){this.search(n,!0,r,s,a)})},this),s):(h=e.extend({},h),h.data||(h.data={}),h.data.str=n,s&&(h.data.inside=s),e.ajax(h).fail(e.proxy(function(){this._data.core.last_error={error:"ajax",plugin:"search",id:"search_01",reason:"Could not load search parents",data:JSON.stringify(h)},this.settings.core.error.call(this,this._data.core.last_error)},this)).done(e.proxy(function(t){t&&t.d&&(t=t.d),this._load_nodes(e.isArray(t)?e.vakata.array_unique(t):[],function(){this.search(n,!0,r,s,a)})},this)));if(a||(this._data.search.str=n,this._data.search.dom=e(),this._data.search.res=[],this._data.search.opn=[],this._data.search.som=r,this._data.search.smc=o),f=new e.vakata.search(n,!0,{caseSensitive:c.case_sensitive,fuzzy:c.fuzzy}),e.each(u[s?s:e.jstree.root].children_d,function(e,t){var i=u[t];i.name&&!i.state.hidden&&(!c.search_leaves_only||i.state.loaded&&0===i.children.length)&&(c.search_callback&&c.search_callback.call(this,n,i)||!c.search_callback&&f.search(i.name).isMatch)&&(p.push(t),g=g.concat(i.parents))}),p.length){for(g=e.vakata.array_unique(g),l=0,d=g.length;l<d;l++)g[l]!==e.jstree.root&&u[g[l]]&&this.open_node(g[l],null,0)===!0&&this._data.search.opn.push(g[l]);a?(this._data.search.dom=this._data.search.dom.add(e(this.element[0].querySelectorAll("#"+e.map(p,function(t){return"0123456789".indexOf(t[0])!==-1?"\\3"+t[0]+" "+t.substr(1).replace(e.jstree.idregex,"\\$&"):t.replace(e.jstree.idregex,"\\$&")}).join(", #")))),this._data.search.res=e.vakata.array_unique(this._data.search.res.concat(p))):(this._data.search.dom=e(this.element[0].querySelectorAll("#"+e.map(p,function(t){return"0123456789".indexOf(t[0])!==-1?"\\3"+t[0]+" "+t.substr(1).replace(e.jstree.idregex,"\\$&"):t.replace(e.jstree.idregex,"\\$&")}).join(", #"))),this._data.search.res=p),this._data.search.dom.children(".jstree-anchor").addClass("jstree-search")}this.trigger("search",{nodes:this._data.search.dom,str:n,res:this._data.search.res,show_only_matches:r})},this.clear_search=function(){this.settings.search.close_opened_onclear&&this.close_node(this._data.search.opn,0),this.trigger("clear_search",{nodes:this._data.search.dom,str:this._data.search.str,res:this._data.search.res}),this._data.search.res.length&&(this._data.search.dom=e(this.element[0].querySelectorAll("#"+e.map(this._data.search.res,function(t){return"0123456789".indexOf(t[0])!==-1?"\\3"+t[0]+" "+t.substr(1).replace(e.jstree.idregex,"\\$&"):t.replace(e.jstree.idregex,"\\$&")}).join(", #"))),this._data.search.dom.children(".jstree-anchor").removeClass("jstree-search")),this._data.search.str="",this._data.search.res=[],this._data.search.opn=[],this._data.search.dom=e()},this.redraw_node=function(t){if(t=i.redraw_node.apply(this,arguments),t&&e.inArray(t.id,this._data.search.res)!==-1){var n,r,s=null;for(n=0,r=t.childNodes.length;n<r;n++)if(t.childNodes[n]&&t.childNodes[n].className&&t.childNodes[n].className.indexOf("jstree-anchor")!==-1){s=t.childNodes[n];break}s&&(s.className+=" jstree-search")}return t}},function(e){e.vakata.search=function(t,n,i){i=i||{},i=e.extend({},e.vakata.search.defaults,i),i.fuzzy!==!1&&(i.fuzzy=!0),t=i.caseSensitive?t:t.toLowerCase();var r,s,a,o,l=i.location,d=i.distance,c=i.threshold,h=t.length;return h>32&&(i.fuzzy=!1),i.fuzzy&&(r=1<<h-1,s=function(){var e={},n=0;for(n=0;n<h;n++)e[t.charAt(n)]=0;for(n=0;n<h;n++)e[t.charAt(n)]|=1<<h-n-1;return e}(),a=function(e,t){var n=e/h,i=Math.abs(l-t);return d?n+i/d:i?1:n}),o=function(e){if(e=i.caseSensitive?e:e.toLowerCase(),
t===e||e.indexOf(t)!==-1)return{isMatch:!0,score:0};if(!i.fuzzy)return{isMatch:!1,score:1};var n,o,d,u,f,p,g,_,m,y=e.length,v=c,x=e.indexOf(t,l),b=h+y,k=1,j=[];for(x!==-1&&(v=Math.min(a(0,x),v),x=e.lastIndexOf(t,l+h),x!==-1&&(v=Math.min(a(0,x),v))),x=-1,n=0;n<h;n++){for(d=0,u=b;d<u;)a(n,l+u)<=v?d=u:b=u,u=Math.floor((b-d)/2+d);for(b=u,p=Math.max(1,l-u+1),g=Math.min(l+u,y)+h,_=new Array(g+2),_[g+1]=(1<<n)-1,o=g;o>=p;o--)if(m=s[e.charAt(o-1)],0===n?_[o]=(_[o+1]<<1|1)&m:_[o]=(_[o+1]<<1|1)&m|((f[o+1]|f[o])<<1|1)|f[o+1],_[o]&r&&(k=a(n,o-1),k<=v)){if(v=k,x=o-1,j.push(x),!(x>l))break;p=Math.max(1,2*l-x)}if(a(n+1,l)>v)break;f=_}return{isMatch:x>=0,score:k}},n===!0?{search:o}:o(n)},e.vakata.search.defaults={location:0,distance:100,threshold:.6,fuzzy:!1,caseSensitive:!1}}(e),e.jstree.defaults.sort=function(e,t){return this.get_text(e)>this.get_text(t)?1:-1},e.jstree.plugins.sort=function(t,n){this.bind=function(){n.bind.call(this),this.element.on("model.jstree",e.proxy(function(e,t){this.sort(t.parent,!0)},this)).on("rename_node.jstree create_node.jstree",e.proxy(function(e,t){this.sort(t.parent||t.node.parent,!1),this.redraw_node(t.parent||t.node.parent,!0)},this)).on("move_node.jstree copy_node.jstree",e.proxy(function(e,t){this.sort(t.parent,!1),this.redraw_node(t.parent,!0)},this))},this.sort=function(t,n){var i,r;if(t=this.get_node(t),t&&t.children&&t.children.length&&(t.children.sort(e.proxy(this.settings.sort,this)),n))for(i=0,r=t.children_d.length;i<r;i++)this.sort(t.children_d[i],!1)}};var g=!1;e.jstree.defaults.state={key:"jstree",events:"changed.jstree open_node.jstree close_node.jstree check_node.jstree uncheck_node.jstree",ttl:!1,filter:!1},e.jstree.plugins.state=function(t,n){this.bind=function(){n.bind.call(this);var t=e.proxy(function(){this.element.on(this.settings.state.events,e.proxy(function(){g&&clearTimeout(g),g=setTimeout(e.proxy(function(){this.save_state()},this),100)},this)),this.trigger("state_ready")},this);this.element.on("ready.jstree",e.proxy(function(){this.element.one("restore_state.jstree",t),this.restore_state()||t()},this))},this.save_state=function(){var t={state:this.get_state(),ttl:this.settings.state.ttl,sec:+new Date};e.vakata.storage.set(this.settings.state.key,JSON.stringify(t))},this.restore_state=function(){var t=e.vakata.storage.get(this.settings.state.key);if(t)try{t=JSON.parse(t)}catch(e){return!1}return!(t&&t.ttl&&t.sec&&+new Date-t.sec>t.ttl)&&(t&&t.state&&(t=t.state),t&&e.isFunction(this.settings.state.filter)&&(t=this.settings.state.filter.call(this,t)),!!t&&(this.element.one("set_state.jstree",function(n,i){i.instance.trigger("restore_state",{state:e.extend(!0,{},t)})}),this.set_state(t),!0))},this.clear_state=function(){return e.vakata.storage.del(this.settings.state.key)}},function(e){e.vakata.storage={set:function(e,t){return window.localStorage.setItem(e,t)},get:function(e){return window.localStorage.getItem(e)},del:function(e){return window.localStorage.removeItem(e)}}}(e),e.jstree.defaults.types={"default":{}},e.jstree.defaults.types[e.jstree.root]={},e.jstree.plugins.types=function(n,i){this.init=function(n,r){var s,a;if(r&&r.types&&r.types["default"])for(s in r.types)if("default"!==s&&s!==e.jstree.root&&r.types.hasOwnProperty(s))for(a in r.types["default"])r.types["default"].hasOwnProperty(a)&&r.types[s][a]===t&&(r.types[s][a]=r.types["default"][a]);i.init.call(this,n,r),this._model.data[e.jstree.root].type=e.jstree.root},this.refresh=function(t,n){i.refresh.call(this,t,n),this._model.data[e.jstree.root].type=e.jstree.root},this.bind=function(){this.element.on("model.jstree",e.proxy(function(n,i){var r,s,a,o=this._model.data,l=i.nodes,d=this.settings.types,c="default";for(r=0,s=l.length;r<s;r++){if(c="default",o[l[r]].original&&o[l[r]].original.type&&d[o[l[r]].original.type]&&(c=o[l[r]].original.type),o[l[r]].data&&o[l[r]].data.jstree&&o[l[r]].data.jstree.type&&d[o[l[r]].data.jstree.type]&&(c=o[l[r]].data.jstree.type),o[l[r]].type=c,o[l[r]].icon===!0&&d[c].icon!==t&&(o[l[r]].icon=d[c].icon),d[c].li_attr!==t&&"object"==typeof d[c].li_attr)for(a in d[c].li_attr)if(d[c].li_attr.hasOwnProperty(a)){if("id"===a)continue;o[l[r]].li_attr[a]===t?o[l[r]].li_attr[a]=d[c].li_attr[a]:"class"===a&&(o[l[r]].li_attr["class"]=d[c].li_attr["class"]+" "+o[l[r]].li_attr["class"])}if(d[c].a_attr!==t&&"object"==typeof d[c].a_attr)for(a in d[c].a_attr)if(d[c].a_attr.hasOwnProperty(a)){if("id"===a)continue;o[l[r]].a_attr[a]===t?o[l[r]].a_attr[a]=d[c].a_attr[a]:"href"===a&&"#"===o[l[r]].a_attr[a]?o[l[r]].a_attr.href=d[c].a_attr.href:"class"===a&&(o[l[r]].a_attr["class"]=d[c].a_attr["class"]+" "+o[l[r]].a_attr["class"])}}o[e.jstree.root].type=e.jstree.root},this)),i.bind.call(this)},this.get_json=function(t,n,r){var s,a,o=this._model.data,l=n?e.extend(!0,{},n,{no_id:!1}):{},d=i.get_json.call(this,t,l,r);if(d===!1)return!1;if(e.isArray(d))for(s=0,a=d.length;s<a;s++)d[s].type=d[s].id&&o[d[s].id]&&o[d[s].id].type?o[d[s].id].type:"default",n&&n.no_id&&(delete d[s].id,d[s].li_attr&&d[s].li_attr.id&&delete d[s].li_attr.id,d[s].a_attr&&d[s].a_attr.id&&delete d[s].a_attr.id);else d.type=d.id&&o[d.id]&&o[d.id].type?o[d.id].type:"default",n&&n.no_id&&(d=this._delete_ids(d));return d},this._delete_ids=function(t){if(e.isArray(t)){for(var n=0,i=t.length;n<i;n++)t[n]=this._delete_ids(t[n]);return t}return delete t.id,t.li_attr&&t.li_attr.id&&delete t.li_attr.id,t.a_attr&&t.a_attr.id&&delete t.a_attr.id,t.children&&e.isArray(t.children)&&(t.children=this._delete_ids(t.children)),t},this.check=function(n,r,s,a,o){if(i.check.call(this,n,r,s,a,o)===!1)return!1;r=r&&r.id?r:this.get_node(r),s=s&&s.id?s:this.get_node(s);var l,d,c,h,u=r&&r.id?o&&o.origin?o.origin:e.jstree.reference(r.id):null;switch(u=u&&u._model&&u._model.data?u._model.data:null,n){case"create_node":case"move_node":case"copy_node":if("move_node"!==n||e.inArray(r.id,s.children)===-1){if(l=this.get_rules(s),l.max_children!==t&&l.max_children!==-1&&l.max_children===s.children.length)return this._data.core.last_error={error:"check",plugin:"types",id:"types_01",reason:"max_children prevents function: "+n,data:JSON.stringify({chk:n,pos:a,obj:!(!r||!r.id)&&r.id,par:!(!s||!s.id)&&s.id})},!1;if(l.valid_children!==t&&l.valid_children!==-1&&e.inArray(r.type||"default",l.valid_children)===-1)return this._data.core.last_error={error:"check",plugin:"types",id:"types_02",reason:"valid_children prevents function: "+n,data:JSON.stringify({chk:n,pos:a,obj:!(!r||!r.id)&&r.id,par:!(!s||!s.id)&&s.id})},!1;if(u&&r.children_d&&r.parents){for(d=0,c=0,h=r.children_d.length;c<h;c++)d=Math.max(d,u[r.children_d[c]].parents.length);d=d-r.parents.length+1}(d<=0||d===t)&&(d=1);do{if(l.max_depth!==t&&l.max_depth!==-1&&l.max_depth<d)return this._data.core.last_error={error:"check",plugin:"types",id:"types_03",reason:"max_depth prevents function: "+n,data:JSON.stringify({chk:n,pos:a,obj:!(!r||!r.id)&&r.id,par:!(!s||!s.id)&&s.id})},!1;s=this.get_node(s.parent),l=this.get_rules(s),d++}while(s)}}return!0},this.get_rules=function(e){if(e=this.get_node(e),!e)return!1;var n=this.get_type(e,!0);return n.max_depth===t&&(n.max_depth=-1),n.max_children===t&&(n.max_children=-1),n.valid_children===t&&(n.valid_children=-1),n},this.get_type=function(t,n){return t=this.get_node(t),!!t&&(n?e.extend({type:t.type},this.settings.types[t.type]):t.type)},this.set_type=function(n,i){var r,s,a,o,l,d,c,h,u=this._model.data;if(e.isArray(n)){for(n=n.slice(),s=0,a=n.length;s<a;s++)this.set_type(n[s],i);return!0}if(r=this.settings.types,n=this.get_node(n),!r[i]||!n)return!1;if(c=this.get_node(n,!0),c&&c.length&&(h=c.children(".jstree-anchor")),o=n.type,l=this.get_icon(n),n.type=i,(l===!0||r[o]&&r[o].icon!==t&&l===r[o].icon)&&this.set_icon(n,r[i].icon===t||r[i].icon),r[o].li_attr!==t&&"object"==typeof r[o].li_attr)for(d in r[o].li_attr)if(r[o].li_attr.hasOwnProperty(d)){if("id"===d)continue;"class"===d?(u[n.id].li_attr["class"]=(u[n.id].li_attr["class"]||"").replace(r[o].li_attr[d],""),c&&c.removeClass(r[o].li_attr[d])):u[n.id].li_attr[d]===r[o].li_attr[d]&&(u[n.id].li_attr[d]=null,c&&c.removeAttr(d))}if(r[o].a_attr!==t&&"object"==typeof r[o].a_attr)for(d in r[o].a_attr)if(r[o].a_attr.hasOwnProperty(d)){if("id"===d)continue;"class"===d?(u[n.id].a_attr["class"]=(u[n.id].a_attr["class"]||"").replace(r[o].a_attr[d],""),h&&h.removeClass(r[o].a_attr[d])):u[n.id].a_attr[d]===r[o].a_attr[d]&&("href"===d?(u[n.id].a_attr[d]="#",h&&h.attr("href","#")):(delete u[n.id].a_attr[d],h&&h.removeAttr(d)))}if(r[i].li_attr!==t&&"object"==typeof r[i].li_attr)for(d in r[i].li_attr)if(r[i].li_attr.hasOwnProperty(d)){if("id"===d)continue;u[n.id].li_attr[d]===t?(u[n.id].li_attr[d]=r[i].li_attr[d],c&&("class"===d?c.addClass(r[i].li_attr[d]):c.attr(d,r[i].li_attr[d]))):"class"===d&&(u[n.id].li_attr["class"]=r[i].li_attr[d]+" "+u[n.id].li_attr["class"],c&&c.addClass(r[i].li_attr[d]))}if(r[i].a_attr!==t&&"object"==typeof r[i].a_attr)for(d in r[i].a_attr)if(r[i].a_attr.hasOwnProperty(d)){if("id"===d)continue;u[n.id].a_attr[d]===t?(u[n.id].a_attr[d]=r[i].a_attr[d],h&&("class"===d?h.addClass(r[i].a_attr[d]):h.attr(d,r[i].a_attr[d]))):"href"===d&&"#"===u[n.id].a_attr[d]?(u[n.id].a_attr.href=r[i].a_attr.href,h&&h.attr("href",r[i].a_attr.href)):"class"===d&&(u[n.id].a_attr["class"]=r[i].a_attr["class"]+" "+u[n.id].a_attr["class"],h&&h.addClass(r[i].a_attr[d]))}return!0}},e.jstree.defaults.unique={case_sensitive:!1,duplicate:function(e,t){return e+" ("+t+")"}},e.jstree.plugins.unique=function(n,i){this.check=function(t,n,r,s,a){if(i.check.call(this,t,n,r,s,a)===!1)return!1;if(n=n&&n.id?n:this.get_node(n),r=r&&r.id?r:this.get_node(r),!r||!r.children)return!0;var o,l,d="rename_node"===t?s:n.name,c=[],h=this.settings.unique.case_sensitive,u=this._model.data;for(o=0,l=r.children.length;o<l;o++)c.push(h?u[r.children[o]].name:u[r.children[o]].name.toLowerCase());switch(h||(d=d.toLowerCase()),t){case"delete_node":return!0;case"rename_node":return o=e.inArray(d,c)===-1||n.name&&n.name[h?"toString":"toLowerCase"]()===d,o||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_01",reason:"Child with name "+d+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:s,obj:!(!n||!n.id)&&n.id,par:!(!r||!r.id)&&r.id})}),o;case"create_node":return o=e.inArray(d,c)===-1,o||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_04",reason:"Child with name "+d+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:s,obj:!(!n||!n.id)&&n.id,par:!(!r||!r.id)&&r.id})}),o;case"copy_node":return o=e.inArray(d,c)===-1,o||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_02",reason:"Child with name "+d+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:s,obj:!(!n||!n.id)&&n.id,par:!(!r||!r.id)&&r.id})}),o;case"move_node":return o=n.parent===r.id&&(!a||!a.is_multi)||e.inArray(d,c)===-1,o||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_03",reason:"Child with name "+d+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:s,obj:!(!n||!n.id)&&n.id,par:!(!r||!r.id)&&r.id})}),o}return!0},this.create_node=function(n,r,s,a,o){if(!r||r.name===t){if(null===n&&(n=e.jstree.root),n=this.get_node(n),!n)return i.create_node.call(this,n,r,s,a,o);if(s=s===t?"last":s,!s.toString().match(/^(before|after)$/)&&!o&&!this.is_loaded(n))return i.create_node.call(this,n,r,s,a,o);r||(r={});var l,d,c,h,u,f=this._model.data,p=this.settings.unique.case_sensitive,g=this.settings.unique.duplicate;for(d=l=this.get_string("New node"),c=[],h=0,u=n.children.length;h<u;h++)c.push(p?f[n.children[h]].name:f[n.children[h]].name.toLowerCase());for(h=1;e.inArray(p?d:d.toLowerCase(),c)!==-1;)d=g.call(this,l,++h).toString();r.name=d}return i.create_node.call(this,n,r,s,a,o)}};var _=c.createElement("DIV");if(_.setAttribute("unselectable","on"),_.setAttribute("role","presentation"),_.className="jstree-wholerow",_.innerHTML="&#160;",e.jstree.plugins.wholerow=function(t,n){this.bind=function(){n.bind.call(this),this.element.on("ready.jstree set_state.jstree",e.proxy(function(){this.hide_dots()},this)).on("init.jstree loading.jstree ready.jstree",e.proxy(function(){this.get_container_ul().addClass("jstree-wholerow-ul")},this)).on("deselect_all.jstree",e.proxy(function(){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked")},this)).on("changed.jstree",e.proxy(function(e,t){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked");var n,i,r=!1;for(n=0,i=t.selected.length;n<i;n++)r=this.get_node(t.selected[n],!0),r&&r.length&&r.children(".jstree-wholerow").addClass("jstree-wholerow-clicked")},this)).on("open_node.jstree",e.proxy(function(e,t){this.get_node(t.node,!0).find(".jstree-clicked").parent().children(".jstree-wholerow").addClass("jstree-wholerow-clicked")},this)).on("hover_node.jstree dehover_node.jstree",e.proxy(function(e,t){"hover_node"===e.type&&this.is_disabled(t.node)||this.get_node(t.node,!0).children(".jstree-wholerow")["hover_node"===e.type?"addClass":"removeClass"]("jstree-wholerow-hovered")},this)).on("contextmenu.jstree",".jstree-wholerow",e.proxy(function(t){if(this._data.contextmenu){t.preventDefault();var n=e.Event("contextmenu",{metaKey:t.metaKey,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey,pageX:t.pageX,pageY:t.pageY});e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(n)}},this)).on("click.jstree",".jstree-wholerow",function(t){t.stopImmediatePropagation();var n=e.Event("click",{metaKey:t.metaKey,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey});e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(n).focus()}).on("click.jstree",".jstree-leaf > .jstree-ocl",e.proxy(function(t){t.stopImmediatePropagation();var n=e.Event("click",{metaKey:t.metaKey,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey});e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(n).focus()},this)).on("mouseover.jstree",".jstree-wholerow, .jstree-icon",e.proxy(function(e){return e.stopImmediatePropagation(),this.is_disabled(e.currentTarget)||this.hover_node(e.currentTarget),!1},this)).on("mouseleave.jstree",".jstree-node",e.proxy(function(e){this.dehover_node(e.currentTarget)},this))},this.teardown=function(){this.settings.wholerow&&this.element.find(".jstree-wholerow").remove(),n.teardown.call(this)},this.redraw_node=function(t){if(t=n.redraw_node.apply(this,arguments)){var i=_.cloneNode(!0);e.inArray(t.id,this._data.core.selected)!==-1&&(i.className+=" jstree-wholerow-clicked"),this._data.core.focused&&this._data.core.focused===t.id&&(i.className+=" jstree-wholerow-hovered"),t.insertBefore(i,t.childNodes[0])}return t}},c.registerElement&&Object&&Object.create){var m=Object.create(HTMLElement.prototype);m.createdCallback=function(){var t,n={core:{},plugins:[]};for(t in e.jstree.plugins)e.jstree.plugins.hasOwnProperty(t)&&this.attributes[t]&&(n.plugins.push(t),this.getAttribute(t)&&JSON.parse(this.getAttribute(t))&&(n[t]=JSON.parse(this.getAttribute(t))));for(t in e.jstree.defaults.core)e.jstree.defaults.core.hasOwnProperty(t)&&this.attributes[t]&&(n.core[t]=JSON.parse(this.getAttribute(t))||this.getAttribute(t));e(this).jstree(n)};try{c.registerElement("vakata-jstree",{prototype:m})}catch(e){}}}});