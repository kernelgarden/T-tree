<%= stylesheet_link_tag    'application', team: 'all', 'data-turbolinks-track': 'reload' %>
<%= javascript_tag do %>
window.teamID = "<%= @team_id%>";
<% end %>
<div class="team_info">
  <div class="team_wrapper">
    <div class="team_name">
      <h1 style="margin-top:40px;"><%=@team.name%></h1>
    </div>
  </div>
</div>
<div class="wrapper">
  <ul class="tabs clearfix" data-tabgroup="first-tab-group">
    <li><a href="#tab1" class="tab_1 active">Works</a></li>
    <li><a href="#tab2" class="tab_2">Members</a></li>
  </ul>
  <section id="first-tab-group" class="tabgroup">
    <div id="tab1" class="tab1">
      <div class="team_work_wrap">
      </div>
    </div>
    <div id="tab2" class="tab2">
      <div style="display:inline-block;">
        <div class="member_left">
          <div class="title">Add Members</div>
          <div class="line"></div>
          <form id="team_form">
            <input type="text" id="team_search"name="search" class="add_member" value="" placeholder="Find members by email">
          </form>
        </div>
        <div class="member_right">
          <div class="title">Team Members</div>
          <div class="line"></div>
          <div class="member_list">
            <div class="member">
              <div class="content_1">
                <div class="member_name">김시훈</div>
              </div>
              <div class="content_2">
                <div class="member_email">shuni93@naver.com</div>
              </div>
            </div>
            <div class="line"></div>
          </div>
        </div>
      </div>
    </div>
  </section>
</div>
<script>
var getWorkFromTeam=function(){
  $(".team_work_wrap").hide
  $.getJSON("/api/team/"+teamID, function(response){
    $.each(response.work_ids, function (i,id){
      if(i!=response.work_ids.length){
        $(".team_work_wrap").append('<div class="team_work team_work'+i+'"></div>').show('slow');
      }
      $.getJSON("/api/work/"+id, function(response){
        $(".team_work"+i).append('<div class="team_work_name team_work_name'+i+'">'+response.name+'</div>').show('slow');
      })
    })
  })
  $(".team_work_wrap").append('<div class="create_team_work"></div>').show('slow');
  $(".create_team_work").append('<div class="create_team_work_content">Create Team Work</div>').show('slow');
}
$('.tabgroup > div').hide();
$('.tabgroup > div:first-of-type').show();
$('.tabs a').click(function(e){
  e.preventDefault();
  var $this = $(this),
  tabgroup = '#'+$this.parents('.tabs').data('tabgroup'),
  others = $this.closest('li').siblings().children('a'),
  target = $this.attr('href');
  others.removeClass('active');
  $this.addClass('active');
  $(tabgroup).children('div').hide();
  $(target).show();
});
$(document).ready(function(){
  $.ajaxSetup({ //Json 비동기>>>동기
    async:false
  });
  getWorkFromTeam();

  var team_search = {
    url: "/search",
    categories: [{
      listLocation: "users",
      maxNumberOfElements: 3,
      header: "Users"
    }],
    getValue: function(element) {
      return element.name;
    },
    template: {
      type: "description",
      fields: {
        description: "description"
      }
    },
    list: {
      maxNumberOfElements: 12,
      match: {
        enabled: true
      },
      sort: {
        enabled: true
      },
      onClickEvent: function() {
        var countForm=0;
        var model = $("#team_search").getSelectedItemData().attr;
        var id = $("#team_search").getSelectedItemData().id;
          jQuery.fn.mySerialize = function(){
            var returning = '';
            $('input, select, textarea',this).each(function(){
              if (this.value!=="") // check this to avoid && in returning string
              returning +='&'+this.value;
            })
            return returning.substring(1);
          }
          var formData1=$("#team_form").mySerialize();
          //값이 하나라도 안들어오면 알림창을 표시하고 리턴하여 함수빠져나감
          if(formData1==''){
            //alert("빈칸!");
            //window.location = '/'
            return;
          }
          else{
            var inputData={"team_id":teamID,"user_id":id}
            window.location = '/main/team/'+teamID;
          }
          countForm++;
          if(countForm==1){
            $.ajax({
              type:"POST",
              url:"/api/post/team_member/",
              contentType:"application/x-www-form-urlencoded; charset=UTF-8",
              cache:false,
              data: inputData,
              success:function(data){
                //alert("팀이 생성되었습니다");
              }
            })
          }
      },
      onChooseEvent: function() {
        var model = $("#team_search").getSelectedItemData().attr;
        var id = $("#team_search").getSelectedItemData().id;
        jQuery.fn.mySerialize = function(){
          var returning = '';
          $('input, select, textarea',this).each(function(){
            if (this.value!=="") // check this to avoid && in returning string
            returning +='&'+this.value;
          })
          return returning.substring(1);
        }
        var formData1=$("#team_form").mySerialize();
        //값이 하나라도 안들어오면 알림창을 표시하고 리턴하여 함수빠져나감
        if(formData1==''){
          //alert("빈칸!");
          //window.location = '/'
          return;
        }
        else{
          var inputData={"team_id":teamID,"user_id":id}
          window.location = '/main/team/'+teamID;
        }
        countForm++;
        if(countForm==1){
          $.ajax({
            type:"POST",
            url:"/api/post/team_member/",
            contentType:"application/x-www-form-urlencoded; charset=UTF-8",
            cache:false,
            data: inputData,
            success:function(data){
              //alert("팀이 생성되었습니다");
            }
          })
        }
      }
    },
    theme: "team"
  };
  $("#team_search").easyAutocomplete(team_search);
});
</script>
