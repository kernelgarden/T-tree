<%= javascript_tag do %>
  window.userID = "<%= current_user.id%>";
  window.userName ="<%= current_user.name %>";
  window.workLength ="<%= current_user.work_ids.length %>";
  window.createWork ='<%=  link_to "<div class='+'create_personal_work'+'></div>".html_safe%>';
  window.addWork ='<%=  link_to "<div class='+'personal_work_content'+'></div>".html_safe%>';
<% end %>

<div id='side_bar'>
	<div id='page_alert'>
		<div id='page_alert_num'>

    </div>
	</div>

</div>
<div id='unPageBox'>
</div>

<script>

var width =window.screen.availWidth||window.innerWidth||document.body.clientWidth;
var height =window.screen.availHeight||document.body.clientHeigh;
var widthPosition =window.innerWidth||window.innerWidth||document.body.clientWidth;
var heightPosition =window.innerHeight||document.body.clientHeigh;
var pagesClickCnt=0;
var flag=100;

var setSize=function(){ //사이즈 세팅해주는 함수
  var width =window.screen.availWidth||window.innerWidth||document.body.clientWidth;
  var height =window.screen.availHeight||document.body.clientHeigh;
  var widthPosition =window.innerWidth||window.innerWidth||document.body.clientWidth;
  var heightPosition =window.innerHeight||document.body.clientHeigh;
  $('#side_bar').width(width*15/100)
  $('#side_bar').height(height*2/3)
  $('#side_bar').offset({right:width*4/100});

  //사이드바 원 높이를 가로와 맞게
  $('#page_alert').height($('#page_alert').width())
  $('#page_alert_num').height($('#page_alert_num').width()*4/5)
}

$('#page_alert').draggable({
	revert: false,
	start: function(event, ui) {
		ui.helper.data('droppedAt', -1); // 원에 드랍시 0 > 의 상수 기타 <= 0
		ui.helper.data('draggablePos', $(this).position());
	},
	stop: function(event, ui) {
      alert(ui.helper.data('droppedAt'));
			if (ui.helper.data('droppedAt') != -1)
				$(this).css({
					left: ui.helper.data('draggablePos').left,
					top: ui.helper.data('draggablePos').top
				});
      // Check value of ui.helper.data('dropped') and handle accordingly...
  }
});

var checkPageAlerNum=function(){  //branch에 포함되지 않은 페이지들의 개수를 체크해 할당
  $.getJSON("/api/user/"+userID, function(response) {
    //alert(response.unclassifiedpage_ids.length)
    $('#page_alert_num').empty().append(response.unclassifiedpage_ids.length)
    $.each(response.unclassifiedpage_ids, function (i,first) {

    });
  }, 1900);
}
var pagesInform=function(){
  var unPages = $('<div class="unPages"></div>').appendTo('#unPageBox');
  var unPage=$('<ol class="unPage"></ol>').appendTo('.unPages');
  var unPages = $('<div class="unPages"></div>').appendTo('#unPageBox');
        var unPage=$('<ol class="unPage"></ol>').appendTo('.unPages');
        $('.unPages').transition({ x:+(widthPosition*1.4/5)+'px',y:0+'px',duration: 0, scale: 1.0});
        $('.unPages').width(width*2.1/5)
        $('.unPages').height(height*7/10)
        $('.unPages').css({top:height*1.5/10})
        $('.unPages').attr("data-id",0)
}

var showPages=function(){  //페이지 화면 띄워즈는 함수
  $(document).on("click","#page_alert",function() {
      if($('#unPageBox').empty()){
        var unPages = $('<div class="unPages"></div>').appendTo('#unPageBox');
        var unPage=$('<ol class="unPage"></ol>').appendTo('.unPages');
        $('.unPages').transition({ x:+(widthPosition*2.5/5)+'px',y:0+'px',duration: 0, scale: 1.0});
        $('.unPages').width(width*1.69/5)
        $('.unPages').height(height*7/10)
        $('.unPages').css({top:height*1.5/10})
        $('.unPages').hide();
        console.log(flag)
        if(flag==100){
          $('.unPages').attr("data-id",0)
          flag=$('.unPages').data("id");
        }
        else if(flag==0){
          $('.unPages').attr("data-id",1)
          flag=$('.unPages').data("id");
        }else if(flag==1){
          $('.unPages').attr("data-id",0)
          flag=$('.unPages').data("id");
        }
        //$('.unPages').show();
      }

      console.log($('.unPages').data("id"))

      if($('.unPages').data("id")==0){
        $('.unPages').show();
        $('.unPages').attr("data-id",1)

        /////////////////////////////Json/////////////////////////////
          setTimeout(function(){
            $.getJSON("/api/user/"+userID, function(response) {

              for(var i=0; i<response.unclassifiedpage_ids.length; i++){
                //한번만 박스 그려주도록
                if($('.pageli').eq(i).hasClass('pageli'+i)) break;

                else $('<li class="pageli pageli'+i+'"></li>').appendTo('.unPage');

              }//for

            }, 0);


            $.getJSON("/api/user/"+userID+"/unclassifiedpages", function(response) {
              $.each(response, function (i,first) {
                var temp=(i+1)

                  $('.pageli').eq(i).append('<img class="img" src="http://ryugarden.org/api/thumb?url='+first.url+'" />');
                  $('.pageli').eq(i).append('<div class="page_url_div"><a class="page_url">'+first.title+'</a></div>');
                  $('.pageli').eq(i).attr("data-url",first.url )

              });
            }, 1900);

          //////////////////////////////////////////////////////////////


        });//setTimeout

      }else{
        $('.unPages').hide();
        $('.unPages').attr("data-id",0)
      }

  })
  $('div:not(#page_alert)').click(function(){

  })
  $(document).on("click",".pageli",function() {
      window.open($(this).data("url"),'_blank');
    })
}

$(document).ready(function(){
	var width =window.screen.availWidth||window.innerWidth||document.body.clientWidth;
  var height =window.screen.availHeight||document.body.clientHeigh;
  var widthPosition =window.innerWidth||window.innerWidth||document.body.clientWidth;
  var heightPosition =window.innerHeight||document.body.clientHeigh;
  if(height<500){
	   width=1366;
	   height=768;
  }//if

  //사이즈 세팅
  setSize();
  //branch에 포함되지 않은 페이지들의 개수를 체크해 할당
  setInterval( checkPageAlerNum, 1000 );
  //pagesInform();
  showPages();
});


$(window).resize(function(){
	width =window.screen.availWidth||window.innerWidth||document.body.clientWidth;
	height =window.screen.availHeight||document.body.clientHeigh;
 	widthPosition =window.innerWㄴidth||window.innerWidth||document.body.clientWidth;
 	heightPosition =window.innerHeight||document.body.clientHeigh;
 	if(height<500){
    width=1366;
    height=768;
 	}//if

  //사이즈 세팅
  setSize();
  checkPageAlerNum();
  showPages();
});
</script>
